<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LINE å¼•æµåœ–ç‰‡åº§æ¨™ç”¢ç”Ÿå™¨ (v3.0 æ——è‰¦ç‰ˆ)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { font-family: "Microsoft JhengHei", "Heiti TC", sans-serif; }
        /* ç•«å¸ƒæ¨£å¼ */
        .canvas-container { 
            position: relative; 
            overflow: hidden; 
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1); 
            border: 2px dashed #cbd5e1; 
            background-color: white;
            transition: all 0.3s;
            background-image: radial-gradient(#e2e8f0 1px, transparent 1px);
            background-size: 20px 20px;
        }
        .canvas-container:hover { border-color: #3b82f6; }
        
        /* ç´…æ¡†æ¨£å¼ */
        .area-box { 
            position: absolute; 
            border: 2px solid rgba(239, 68, 68, 0.9); 
            background: rgba(239, 68, 68, 0.2); 
            cursor: move; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            color: white; 
            font-weight: bold; 
            font-size: 16px; 
            text-shadow: 1px 1px 2px black; 
            z-index: 10;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            user-select: none;
        }
        .area-box:hover { background: rgba(239, 68, 68, 0.4); border-color: #ef4444; }
        .area-box.selected { 
            border-color: #f59e0b; 
            background: rgba(245, 158, 11, 0.3); 
            z-index: 20; 
            box-shadow: 0 0 0 2px white, 0 0 0 4px #f59e0b;
        }

        /* æ²è»¸ç¾åŒ– */
        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: #f1f5f9; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #94a3b8; }
    </style>
</head>
<body class="bg-slate-100 h-screen flex flex-col overflow-hidden text-slate-800">

    <header class="bg-white border-b border-slate-200 shadow-sm flex-shrink-0 z-30">
        <div class="max-w-7xl mx-auto px-4 h-16 flex justify-between items-center">
            <div class="flex items-center gap-3">
                <div class="w-10 h-10 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-lg flex items-center justify-center text-white text-xl shadow-lg">ğŸ¦</div>
                <div>
                    <h1 class="font-bold text-lg tracking-wide text-slate-800">LINE åº§æ¨™ç”¢ç”Ÿå™¨ <span class="text-xs bg-amber-100 text-amber-700 px-2 py-0.5 rounded-full border border-amber-200">v3.0 Pro</span></h1>
                    <p class="text-xs text-slate-500">å¤§å¿ƒå®¶æ—å°ˆç”¨ | è‡ªå‹•è¨˜æ†¶ + å…§å»ºæ•™å­¸</p>
                </div>
            </div>
            <div class="flex gap-3">
                <button onclick="document.getElementById('tutorialModal').classList.remove('hidden')" class="text-slate-600 hover:text-blue-600 px-4 py-2 rounded-lg font-medium transition flex items-center gap-2 text-sm border border-slate-200 hover:border-blue-200 hover:bg-blue-50">
                    ğŸ“š å¦‚ä½•ç¶å®šæ•™å­¸
                </button>
                <button onclick="downloadJSON()" class="bg-emerald-500 hover:bg-emerald-600 text-white px-5 py-2 rounded-lg font-bold shadow-md transform transition active:scale-95 flex items-center gap-2 text-sm">
                    ğŸ’¾ ä¸‹è¼‰ JSON
                </button>
            </div>
        </div>
    </header>

    <div class="flex flex-1 overflow-hidden max-w-7xl mx-auto w-full">
        
        <aside class="w-[400px] bg-white border-r border-slate-200 flex flex-col shadow-[4px_0_24px_rgba(0,0,0,0.02)] z-20">
            <div class="flex-1 overflow-y-auto custom-scrollbar p-6 space-y-8">
                
                <div class="bg-blue-50 rounded-xl p-4 border border-blue-100 space-y-3">
                    <h3 class="font-bold text-blue-800 flex items-center gap-2">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                        åœ–ç‰‡è¦æ ¼å°æ•™å®¤
                    </h3>
                    <div class="text-xs space-y-2 text-blue-900">
                        <div class="flex justify-between border-b border-blue-200 pb-1">
                            <span>å¯¬åº¦ (å¿…å®ˆéµå¾‹)</span>
                            <span class="font-bold">1040 px</span>
                        </div>
                        <div class="flex justify-between border-b border-blue-200 pb-1">
                            <span>é«˜åº¦ (å¼•æµé•·åœ–)</span>
                            <span>å»ºè­° 1850 px (ä¸é™)</span>
                        </div>
                        <div class="flex justify-between">
                            <span>é«˜åº¦ (æ»‘å‹•å¡ç‰‡)</span>
                            <span>676 px (æ¨™æº–) / 1040 px (æ­£æ–¹)</span>
                        </div>
                    </div>
                </div>

                <div class="space-y-4">
                    <div class="space-y-2">
                        <label class="block font-bold text-slate-700 text-sm">1. ä¸Šå‚³åº•åœ– (é è¦½ç”¨)</label>
                        <input type="file" id="imageInput" accept="image/*" class="block w-full text-xs text-slate-500 file:mr-3 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-xs file:font-bold file:bg-slate-100 file:text-slate-700 hover:file:bg-slate-200 transition cursor-pointer border border-slate-200 rounded-lg p-1"/>
                        <div id="statusMsg" class="hidden rounded-lg p-3 text-xs flex items-center gap-2"></div>
                    </div>

                    <div class="space-y-2">
                        <label class="block font-bold text-slate-700 text-sm flex justify-between">
                            2. åœ–ç‰‡å…¬é–‹ç¶²å€ (å¿…å¡«)
                            <span class="text-[10px] text-emerald-600 bg-emerald-50 px-2 rounded-full border border-emerald-100 self-center">å·²è‡ªå‹•è¨˜æ†¶</span>
                        </label>
                        <input type="text" id="imageUrl" placeholder="è«‹è²¼ä¸Š https://... çµå°¾æ˜¯ .jpg/.png çš„ç¶²å€" class="w-full p-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:outline-none text-sm shadow-sm transition font-mono text-slate-600" oninput="saveState()">
                        <p class="text-[10px] text-slate-400">ğŸ’¡ æç¤ºï¼šåœ–ç‰‡å¿…é ˆå…ˆä¸Šå‚³åˆ°ç¶²è·¯ (å¦‚ GitHub/Imgur) LINE æ‰è®€å¾—åˆ°ã€‚</p>
                    </div>
                </div>

                <div class="flex-1 flex flex-col min-h-[300px]">
                    <div class="flex justify-between items-end mb-3 pb-2 border-b border-slate-100">
                        <label class="block font-bold text-slate-700 text-sm">3. é—œéµå­—è¨­å®šå€</label>
                        <span class="text-xs text-slate-400">ç›®å‰è¨­å®š: <span id="areaCount" class="font-bold text-blue-600">0</span> çµ„</span>
                    </div>
                    <div id="actionList" class="flex-1 space-y-2 overflow-y-auto pr-1">
                        <div class="text-center text-slate-400 text-sm py-12 border-2 border-dashed border-slate-200 rounded-xl bg-slate-50/50">
                            ğŸ‘† è«‹åœ¨å³å´åœ–ç‰‡ä¸Š<br>æ‹–æ›³æ»‘é¼ ç•«å‡ºæ¡†æ¡†
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="p-4 bg-slate-50 border-t border-slate-200 text-center text-xs text-slate-400">
                ç³»çµ±å°‡è‡ªå‹•å„²å­˜æ‚¨çš„ç·¨è¼¯é€²åº¦ ğŸ’¾
            </div>
        </aside>

        <main class="flex-1 bg-slate-100/50 p-8 overflow-auto flex justify-center items-start relative select-none" id="mainArea">
            <div id="canvasWrapper" class="relative shadow-2xl rounded-sm transition-all duration-300">
                <div id="canvasContainer" class="canvas-container">
                    <div id="placeholder" class="flex flex-col items-center justify-center h-96 w-96 text-slate-300">
                        <svg class="w-20 h-20 mb-4 opacity-50" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path></svg>
                        <span class="text-lg font-medium">è«‹å…ˆåœ¨å·¦å´ä¸Šå‚³åº•åœ–</span>
                    </div>
                    
                    <img id="previewImage" class="hidden max-w-full block pointer-events-none select-none" style="max-height: 85vh;" />
                    <div id="drawLayer" class="absolute inset-0 cursor-crosshair hidden"></div>
                </div>
                
                <div id="dimLabel" class="absolute -top-10 left-0 bg-slate-800 text-white text-xs px-3 py-1.5 rounded-lg opacity-0 transition shadow-lg flex items-center gap-2">
                    <span class="w-2 h-2 rounded-full bg-green-400"></span>
                    <span id="dimText">0 x 0</span>
                </div>
            </div>
        </main>
    </div>

    <div id="tutorialModal" class="hidden fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4 backdrop-blur-sm">
        <div class="bg-white rounded-2xl shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto">
            <div class="p-6 border-b border-slate-100 flex justify-between items-center sticky top-0 bg-white z-10">
                <h2 class="text-xl font-bold text-slate-800">ğŸ“š å¦‚ä½•ç¶å®š LINE å®˜æ–¹å¸³è™Ÿï¼Ÿ</h2>
                <button onclick="document.getElementById('tutorialModal').classList.add('hidden')" class="text-slate-400 hover:text-slate-600 p-2 hover:bg-slate-100 rounded-full transition">âœ•</button>
            </div>
            <div class="p-8 space-y-8">
                <div class="flex gap-4">
                    <div class="flex-shrink-0 w-8 h-8 bg-blue-100 text-blue-600 rounded-full flex items-center justify-center font-bold">1</div>
                    <div class="space-y-2">
                        <h3 class="font-bold text-lg">éƒ¨ç½² Google ç¨‹å¼ç¢¼</h3>
                        <p class="text-sm text-slate-600 leading-relaxed">åœ¨ Google Apps Script å¯«å¥½ç¨‹å¼ç¢¼å¾Œï¼š<br>é»æ“Šå³ä¸Šè§’ <span class="bg-slate-100 px-1 rounded border">éƒ¨ç½²</span> > <span class="bg-slate-100 px-1 rounded border">æ–°å¢éƒ¨ç½²</span> > æ¬Šé™é¸ã€Œæ‰€æœ‰äººã€ > æŒ‰ä¸‹éƒ¨ç½²ã€‚<br><span class="text-red-500 font-bold">è¤‡è£½é‚£å€‹ä»¥ /exec çµå°¾çš„ç¶²å€ã€‚</span></p>
                    </div>
                </div>
                <div class="flex gap-4">
                    <div class="flex-shrink-0 w-8 h-8 bg-blue-100 text-blue-600 rounded-full flex items-center justify-center font-bold">2</div>
                    <div class="space-y-2">
                        <h3 class="font-bold text-lg">è¨­å®š Webhook</h3>
                        <p class="text-sm text-slate-600 leading-relaxed">å‰å¾€ <a href="https://manager.line.biz/" target="_blank" class="text-blue-500 hover:underline">LINE å®˜æ–¹å¸³è™Ÿå¾Œå°</a> æˆ– Developers Consoleã€‚<br>æ‰¾åˆ° <b>Webhook URL</b> æ¬„ä½ï¼Œè²¼ä¸Šå‰›å‰›çš„ç¶²å€ï¼Œä¸¦é–‹å•Ÿ <b>Use Webhook</b> é–‹é—œã€‚</p>
                    </div>
                </div>
                <div class="flex gap-4">
                    <div class="flex-shrink-0 w-8 h-8 bg-blue-100 text-blue-600 rounded-full flex items-center justify-center font-bold">3</div>
                    <div class="space-y-2">
                        <h3 class="font-bold text-lg">ä½¿ç”¨æœ¬å·¥å…·ç”¢ç”Ÿ JSON</h3>
                        <p class="text-sm text-slate-600 leading-relaxed">ä¸Šå‚³ä½ çš„åœ–ç‰‡ï¼Œç•«å¥½æ¡†æ¡†ï¼Œé»æ“Šå³ä¸Šè§’ <b>ä¸‹è¼‰ JSON</b>ã€‚<br>å°‡ä¸‹è¼‰çš„å…§å®¹è²¼åˆ°ä½ çš„ Google Apps Script ç¨‹å¼ç¢¼ä¸­ (æ›¿æ›åŸæœ¬çš„ Imagemap è¨­å®š)ã€‚</p>
                    </div>
                </div>
            </div>
            <div class="p-6 bg-slate-50 border-t border-slate-200 text-right">
                <button onclick="document.getElementById('tutorialModal').classList.add('hidden')" class="bg-slate-800 text-white px-6 py-2 rounded-lg hover:bg-slate-700 transition font-medium">æˆ‘çŸ¥é“äº†</button>
            </div>
        </div>
    </div>

    <script>
        const imageInput = document.getElementById('imageInput');
        const imageUrlInput = document.getElementById('imageUrl');
        const previewImage = document.getElementById('previewImage');
        const drawLayer = document.getElementById('drawLayer');
        const actionList = document.getElementById('actionList');
        const statusMsg = document.getElementById('statusMsg');
        const placeholder = document.getElementById('placeholder');
        const areaCountSpan = document.getElementById('areaCount');
        const dimLabel = document.getElementById('dimLabel');
        const dimText = document.getElementById('dimText');
        
        let areas = [];
        let isDrawing = false;
        let startX, startY;
        let currentBox = null;
        let naturalWidth = 0;
        let naturalHeight = 0;
        let scaleFactor = 1; 

        // å•Ÿå‹•æ™‚è®€å–è¨˜æ†¶
        window.addEventListener('DOMContentLoaded', () => {
            const savedUrl = localStorage.getItem('line_tool_url');
            if(savedUrl) imageUrlInput.value = savedUrl;
            
            // å˜—è©¦è®€å–ä¸Šæ¬¡çš„å€åŸŸè¨­å®š (å¦‚æœæœ‰)
            const savedAreas = localStorage.getItem('line_tool_areas');
            if(savedAreas) {
                // æ³¨æ„ï¼šé€™è£¡åªè®€å–æ•¸æ“šï¼Œä½†å› ç‚ºæ²’æœ‰åœ–ç‰‡è¼‰å…¥ï¼Œç„¡æ³•æ¸²æŸ“æ¡†æ¡†
                // å¯¦éš›æ‡‰ç”¨éœ€ç­‰å¾…åœ–ç‰‡ä¸Šå‚³å¾Œå†å˜—è©¦åŒ¹é…ï¼Œé€™è£¡ç°¡åŒ–è™•ç†åƒ…ä¿ç•™ URL
            }
        });

        // å„²å­˜ç‹€æ…‹
        function saveState() {
            localStorage.setItem('line_tool_url', imageUrlInput.value);
            // localStorage.setItem('line_tool_areas', JSON.stringify(areas)); // é€²éšï¼šå¯å„²å­˜æ¡†æ¡†æ•¸æ“š
        }

        // åœ–ç‰‡ä¸Šå‚³èˆ‡æª¢æ¸¬
        imageInput.addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(event) {
                previewImage.src = event.target.result;
                previewImage.onload = function() {
                    naturalWidth = this.naturalWidth;
                    naturalHeight = this.naturalHeight;
                    
                    // UI åˆ‡æ›
                    placeholder.classList.add('hidden');
                    previewImage.classList.remove('hidden');
                    drawLayer.classList.remove('hidden');
                    dimText.innerText = `${naturalWidth} x ${naturalHeight} px`;
                    dimLabel.classList.remove('opacity-0');

                    // é˜²å‘†æª¢æ¸¬
                    statusMsg.classList.remove('hidden', 'bg-red-50', 'text-red-700', 'bg-emerald-50', 'text-emerald-700');
                    if (naturalWidth !== 1040) {
                        statusMsg.classList.add('bg-red-50', 'text-red-700', 'border', 'border-red-100');
                        statusMsg.innerHTML = `<svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" /></svg><span><b>å°ºå¯¸æ³¨æ„ï¼</b> å¯¬åº¦ ${naturalWidth}px (æ¨™æº–: 1040px)</span>`;
                    } else {
                        statusMsg.classList.add('bg-emerald-50', 'text-emerald-700', 'border', 'border-emerald-100');
                        statusMsg.innerHTML = `<svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" /></svg><span><b>å®Œç¾ï¼</b> ç¬¦åˆ LINE å®˜æ–¹æ¨™æº–</span>`;
                    }

                    areas = [];
                    renderAreas();
                    renderList();
                    updateScale();
                }
            }
            reader.readAsDataURL(file);
        });

        window.addEventListener('resize', updateScale);
        function updateScale() {
            if(naturalWidth > 0) {
                scaleFactor = previewImage.width / naturalWidth;
            }
        }

        // ç•«æ¡†é‚è¼¯
        drawLayer.addEventListener('mousedown', (e) => {
            if(!previewImage.src) return;
            updateScale();
            isDrawing = true;
            const rect = drawLayer.getBoundingClientRect();
            startX = (e.clientX - rect.left) / scaleFactor;
            startY = (e.clientY - rect.top) / scaleFactor;
            
            currentBox = document.createElement('div');
            currentBox.className = 'area-box border-dashed opacity-50';
            currentBox.style.left = (startX * scaleFactor) + 'px';
            currentBox.style.top = (startY * scaleFactor) + 'px';
            drawLayer.appendChild(currentBox);
        });

        drawLayer.addEventListener('mousemove', (e) => {
            if (!isDrawing) return;
            const rect = drawLayer.getBoundingClientRect();
            const currentX = (e.clientX - rect.left) / scaleFactor;
            const currentY = (e.clientY - rect.top) / scaleFactor;

            const width = Math.abs(currentX - startX);
            const height = Math.abs(currentY - startY);
            const left = Math.min(startX, currentX);
            const top = Math.min(startY, currentY);

            currentBox.style.width = (width * scaleFactor) + 'px';
            currentBox.style.height = (height * scaleFactor) + 'px';
            currentBox.style.left = (left * scaleFactor) + 'px';
            currentBox.style.top = (top * scaleFactor) + 'px';
        });

        drawLayer.addEventListener('mouseup', (e) => {
            if (!isDrawing) return;
            isDrawing = false;
            
            const rect = drawLayer.getBoundingClientRect();
            const endX = (e.clientX - rect.left) / scaleFactor;
            const endY = (e.clientY - rect.top) / scaleFactor;
            
            const x = Math.round(Math.min(startX, endX));
            const y = Math.round(Math.min(startY, endY));
            const w = Math.round(Math.abs(endX - startX));
            const h = Math.round(Math.abs(endY - startY));

            if(currentBox) currentBox.remove();
            if (w > 20 && h > 20) {
                areas.push({ x, y, width: w, height: h, text: `é—œéµå­—${areas.length + 1}` });
                renderAreas();
                renderList();
                saveState();
            }
        });

        function renderAreas() {
            drawLayer.innerHTML = '';
            areas.forEach((area, index) => {
                const box = document.createElement('div');
                box.className = 'area-box';
                box.style.left = (area.x * scaleFactor) + 'px';
                box.style.top = (area.y * scaleFactor) + 'px';
                box.style.width = (area.width * scaleFactor) + 'px';
                box.style.height = (area.height * scaleFactor) + 'px';
                box.innerText = index + 1;
                box.onclick = (e) => { e.stopPropagation(); highlightArea(index); };
                drawLayer.appendChild(box);
            });
            areaCountSpan.innerText = areas.length;
        }

        function renderList() {
            actionList.innerHTML = '';
            if(areas.length === 0) {
                actionList.innerHTML = '<div class="text-center text-slate-400 text-sm py-12 border-2 border-dashed border-slate-200 rounded-xl bg-slate-50/50">ğŸ‘† è«‹åœ¨å³å´åœ–ç‰‡ä¸Š<br>æ‹–æ›³æ»‘é¼ ç•«å‡ºæ¡†æ¡†</div>';
                return;
            }

            areas.forEach((area, index) => {
                const item = document.createElement('div');
                item.className = 'bg-white p-3 rounded-xl border border-slate-200 text-sm flex gap-3 items-center shadow-sm hover:shadow-md transition group animate-fade-in';
                item.innerHTML = `
                    <span class="bg-slate-800 text-white w-6 h-6 flex items-center justify-center rounded-md text-xs font-bold shrink-0 shadow-sm">${index + 1}</span>
                    <input type="text" value="${area.text}" onchange="updateText(${index}, this.value)" class="flex-1 border border-slate-200 p-2 rounded-lg focus:outline-none focus:border-blue-500 focus:ring-1 focus:ring-blue-500 bg-slate-50 text-slate-700 font-medium" placeholder="è§¸ç™¼é—œéµå­—">
                    <button onclick="deleteArea(${index})" class="text-slate-300 hover:text-red-500 p-1.5 rounded-lg transition hover:bg-red-50">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" /></svg>
                    </button>
                `;
                item.onclick = () => highlightArea(index);
                actionList.appendChild(item);
            });
        }

        function updateText(index, val) {
            areas[index].text = val;
            saveState();
        }

        function deleteArea(index) {
            areas.splice(index, 1);
            renderAreas();
            renderList();
            saveState();
        }

        function highlightArea(index) {
            document.querySelectorAll('.area-box').forEach((el, i) => {
                if (i === index) el.classList.add('selected');
                else el.classList.remove('selected');
            });
            // æ²å‹•åˆ°å°æ‡‰çš„è¼¸å…¥æ¡†
            const listItems = actionList.children;
            if(listItems[index]) listItems[index].scrollIntoView({ behavior: 'smooth', block: 'center' });
        }

        function downloadJSON() {
            const url = imageUrlInput.value;
            if (!url) { alert("âš ï¸ è«‹å…ˆåœ¨æ­¥é©Ÿ 2 å¡«å¯«ã€Œåœ–ç‰‡ç¶²å€ã€ï¼"); document.getElementById('imageUrl').focus(); return; }
            if (areas.length === 0) { alert("âš ï¸ é€™è£¡ç©ºç©ºçš„ï¼è«‹å…ˆç•«å¹¾å€‹æ¡†æ¡†ã€‚"); return; }

            const output = {
                "type": "imagemap",
                "baseUrl": url,
                "altText": "è«‹é¸æ“‡åŠŸèƒ½",
                "baseSize": {
                    "width": naturalWidth || 1040,
                    "height": naturalHeight || 1040
                },
                "actions": areas.map(area => ({
                    "type": "message",
                    "text": area.text,
                    "area": {
                        "x": area.x,
                        "y": area.y,
                        "width": area.width,
                        "height": area.height
                    }
                }))
            };

            const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(output, null, 2));
            const downloadAnchorNode = document.createElement('a');
            downloadAnchorNode.setAttribute("href", dataStr);
            downloadAnchorNode.setAttribute("download", "imagemap_settings.json");
            document.body.appendChild(downloadAnchorNode);
            downloadAnchorNode.click();
            downloadAnchorNode.remove();
        }
    </script>
</body>
</html>
