<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>å¤§å¿ƒå¤¥ä¼´è²¡å¯Œå°èˆª (Luxury) ğŸ’</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        /* åŸºç¤é…è‰²ï¼šé«˜å°æ¯”ã€ä¹¾æ·¨ã€è­·çœ¼ */
        body { background-color: #f0f2f5; font-family: "Microsoft JhengHei", sans-serif; padding-bottom: 120px; color: #333; }
        .card { border: none; border-radius: 16px; box-shadow: 0 2px 12px rgba(0,0,0,0.06); margin-bottom: 20px; background: white; }
        
        /* å°èˆªåˆ— */
        .navbar { background: #fff; border-bottom: 1px solid #eee; }
        .navbar-brand { color: #d35400 !important; font-weight: 800; letter-spacing: 1px; }

        /* å„€è¡¨æ¿èƒŒæ™¯ - æ¸…çˆ½äº®è‰² */
        .bg-dashboard { 
            background: #ffffff; 
            border-top: 5px solid #f1c40f; /* é ‚éƒ¨é‡‘æ¢è£é£¾ */
            color: #333; 
        }

        /* çµ±è¨ˆæ–¹å¡Š */
        .stat-box { 
            background: #f8f9fa; 
            padding: 12px; 
            border-radius: 12px; 
            text-align: center; 
            height: 100%; 
            border: 1px solid #e9ecef;
        }
        .stat-value { font-size: 1.3rem; font-weight: 800; color: #2c3e50; }
        .stat-label { font-size: 0.85rem; color: #7f8c8d; margin-bottom: 5px; font-weight: bold; }
        
        /* é¡è‰²å®šç¾© */
        .text-income { color: #198754 !important; font-weight: bold; }
        .text-expense { color: #c0392b !important; font-weight: bold; }
        .text-asset { color: #2980b9 !important; font-weight: bold; }
        .text-gap { color: #e67e22 !important; font-weight: 800; }

        /* è˜ä½åœ–å¡ - è¯éº—ç‰ˆé€²åŒ– */
        .pin-card {
            background: linear-gradient(to right, #fff, #fffbf0);
            border-radius: 16px;
            padding: 20px 15px;
            display: flex;
            align-items: center;
            margin-top: 15px;
            border: 2px solid #f1c40f; /* é‡‘æ¡† */
            box-shadow: 0 8px 20px rgba(241, 196, 15, 0.2); /* æ›´å¼·çš„é‡‘è‰²å…‰æšˆ */
            position: relative;
            overflow: hidden;
        }
        /* èƒŒæ™¯å…‰æšˆè£é£¾ */
        .pin-card::after {
            content: ''; position: absolute; top: -50%; left: -50%; width: 200%; height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.8) 0%, rgba(255,255,255,0) 70%);
            opacity: 0.5; pointer-events: none;
        }

        /* æ–°ç‰ˆè¯éº—åœ–ç¤ºæ¨£å¼ */
        .pin-img-new {
            width: 80px;
            height: 80px;
            object-fit: contain;
            margin-right: 20px;
            /* é«˜ç´šç«‹é«”æŠ•å½±èˆ‡è‰²å½©å¢å¼· */
            filter: drop-shadow(0 4px 6px rgba(0,0,0,0.25)) contrast(1.1) saturate(1.1);
            transition: transform 0.3s ease;
            z-index: 2;
        }
        .pin-card:hover .pin-img-new {
            transform: scale(1.08) rotate(-2deg); /* æ»‘é¼ ç§»éæ™‚çš„å°Šæ¦®å‹•æ…‹æ„Ÿ */
        }

        .pin-info { text-align: left; color: #333; flex-grow: 1; z-index: 2; }
        .pin-title { font-size: 1.5rem; font-weight: 900; color: #2c3e50; margin-bottom: 4px; }
        .pin-income-show { font-size: 1.1rem; color: #d35400; font-weight: 800; display: block; }
        .pin-desc { font-size: 0.9rem; color: #7f8c8d; font-weight: bold; }
        
        /* æ™‚é–“è»¸ */
        .timeline-box { position: relative; padding-left: 20px; margin-top: 10px; }
        .timeline-item { position: relative; padding-bottom: 20px; border-left: 2px solid #e0e0e0; padding-left: 20px; }
        .timeline-item:last-child { border-left: none; }
        .timeline-dot { position: absolute; left: -6px; top: 0; width: 10px; height: 10px; border-radius: 50%; background: #ccc; }
        .timeline-dot.loan-end { background: #27ae60; box-shadow: 0 0 0 3px rgba(39, 174, 96, 0.2); }
        .timeline-dot.retire { background: #f1c40f; box-shadow: 0 0 0 3px rgba(241, 196, 15, 0.2); }
        .timeline-age { font-weight: bold; font-size: 1.1rem; color: #2c3e50; }
        .timeline-year { font-size: 0.8rem; color: #95a5a6; margin-left: 5px; }
        .timeline-content { font-size: 0.95rem; background: #fff; padding: 8px 12px; border-radius: 8px; display: inline-block; margin-top: 5px; border: 1px solid #eee; box-shadow: 0 1px 3px rgba(0,0,0,0.05); color: #555; }

        /* å…¶ä»–UIå…ƒä»¶ */
        .prediction-text { font-size: 0.75rem; color: #7f8c8d; font-weight: bold; margin-top: 2px; display: block; text-align: right; }
        .wan-hint { font-size: 0.8rem; color: #555; background-color: #ecf0f1; min-width: 50px; text-align: center; font-weight: bold; }
        .form-check-input:checked { background-color: #f1c40f; border-color: #f1c40f; }
        .mode-label { font-size: 0.9rem; font-weight: bold; color: #555; margin-right: 8px; }
        .dynamic-row { background-color: #fff; border-radius: 8px; padding: 10px; margin-bottom: 10px; position: relative; border: 1px solid #eee; border-left-width: 5px; }
        .btn-remove { position: absolute; top: 5px; right: 5px; color: #aaa; background: none; border: none; font-size: 1.2rem; }
        .dream-item { border-left-color: #9b59b6 !important; }
        .loan-item { border-left-color: #e74c3c !important; }
        .ins-item { border-left-color: #2ecc71 !important; }
        .motivation-box { background-color: #fff9db; color: #856404; border-left: 4px solid #ffc107; padding: 10px; margin-top: 10px; font-weight: bold; text-align: center; font-size: 0.9rem; border-radius: 4px; }
        .unit-select { background-color: #f8f9fa; border: 1px solid #ced4da; font-weight: bold; color: #555; max-width: 65px; text-align: center; padding-right: 0; padding-left: 5px;}
    </style>
</head>
<body>

<nav class="navbar sticky-top shadow-sm py-2">
    <div class="container-fluid d-flex justify-content-between align-items-center">
        <span class="navbar-brand mb-0 h1"><i class="fas fa-gem me-2"></i>å¤§å¿ƒè²¡å¯Œå°èˆª</span>
        <div class="d-flex align-items-center">
            <div class="form-check form-switch d-flex align-items-center me-3">
                <label class="form-check-label mode-label" for="viewToggle" id="viewLabel">æœˆè¦–è§’</label>
                <input class="form-check-input" type="checkbox" id="viewToggle" style="width: 3em; height: 1.5em; cursor: pointer;">
            </div>
            <button class="btn btn-sm btn-outline-warning text-warning border-warning fw-bold" onclick="saveCurrentMonthRecord()">
                <i class="fas fa-save"></i>
            </button>
        </div>
    </div>
</nav>

<div class="container mt-3">

    <div class="card bg-dashboard">
        <div class="card-body pt-3 pb-4">
            <h5 class="card-title d-flex justify-content-between align-items-center mb-4">
                <span class="fw-bold text-dark"><i class="fas fa-tachometer-alt me-2 text-warning"></i>è²¡å‹™ç¸½è¦½ (<span id="view-mode-text">æœˆ</span>)</span>
                <span class="badge bg-dark text-warning shadow-sm px-3 py-2 rounded-pill" id="freedom-percent">è‡ªç”±åº¦ 0%</span>
            </h5>
            
            <div class="row g-2">
                <div class="col-6">
                    <div class="stat-box">
                        <div class="stat-label">è¢«å‹•æ”¶å…¥ç¼ºå£</div>
                        <div id="retirement-gap" class="stat-value text-gap">è¨ˆç®—ä¸­</div>
                    </div>
                </div>
                <div class="col-6">
                    <div class="stat-box">
                        <div class="stat-label">ç„¡å‚µä¸€èº«è¼• (é ä¼°)</div>
                        <div id="debt-free-age" class="stat-value text-success">-- æ­²</div>
                    </div>
                </div>
                
                <div class="col-6 mt-2">
                    <div class="stat-box">
                        <div class="stat-label">åœ‹å…§æ‰€å¾—ç¨…(é ä¼°)</div>
                        <div id="tax-domestic" class="stat-value">0 è¬</div>
                    </div>
                </div>
                <div class="col-6 mt-2">
                    <div class="stat-box">
                        <div class="stat-label">æµ·å¤–ç¨…(750è¬å…)</div>
                        <div id="tax-overseas" class="stat-value">0 è¬</div>
                    </div>
                </div>

                <div class="col-12">
                    <div id="target-pin-container" class="pin-card">
                        <img src="https://cdn-icons-png.flaticon.com/512/6570/6570259.png" class="pin-img-new" id="pin-img" alt="ç›®æ¨™">
                        <div class="pin-info">
                            <div class="pin-desc">å»ºè­°å®‰éº—ç›®æ¨™</div>
                            <div class="pin-title" id="target-pin-name">è¨­å®šç›®æ¨™ï¼Œå•Ÿèˆªï¼</div>
                            <span class="pin-income-show" id="target-pin-income"></span>
                        </div>
                    </div>
                    <div id="motivation-text" class="motivation-box d-none"></div>
                </div>
            </div>
        </div>
    </div>

    <div class="accordion mb-3 shadow-sm rounded-3 overflow-hidden" id="settingsAccordion">
        <div class="accordion-item border-0">
            <h2 class="accordion-header">
                <button class="accordion-button collapsed fw-bold text-primary" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSettings">
                    âš™ï¸ è¨­å®šç›®æ¨™ & å¤¢æƒ³
                </button>
            </h2>
            <div id="collapseSettings" class="accordion-collapse collapse" data-bs-parent="#settingsAccordion">
                <div class="accordion-body bg-light">
                    <div class="row g-2 mb-3">
                        <div class="col-6">
                            <label class="small text-muted fw-bold">ç›®å‰å¹´é½¡</label>
                            <input type="number" id="current-age" class="form-control save-input" placeholder="30">
                        </div>
                        <div class="col-6">
                            <label class="small text-muted fw-bold">é€€ä¼‘å¹´é½¡</label>
                            <input type="number" id="retire-age" class="form-control save-input" placeholder="60">
                        </div>
                        <div class="col-12">
                            <label class="small text-muted fw-bold text-primary">ğŸ¯ é€€ä¼‘å¾Œæƒ³èŠ±å¤šå°‘éŒ¢ (ç›®æ¨™)</label>
                            <div class="input-group">
                                <input type="number" id="target-monthly-expense" class="form-control save-input wan-target" placeholder="è¼¸å…¥æ•¸å­—">
                                <select class="form-select unit-select" id="target-unit" onchange="calculateAll();saveDataLocal()">
                                    <option value="month">æœˆ</option>
                                    <option value="year">å¹´</option>
                                </select>
                                <span class="input-group-text wan-hint" id="hint-target-monthly-expense">0 è¬</span>
                            </div>
                        </div>
                    </div>
                    <hr>
                    <div class="d-flex justify-content-between align-items-center mb-2">
                        <h6 class="fw-bold text-secondary m-0">ğŸŒˆ å¤¢æƒ³æ¸…å–®</h6>
                        <button class="btn btn-sm btn-outline-primary fw-bold" onclick="addDreamRow()"><i class="fas fa-plus"></i> æ–°å¢</button>
                    </div>
                    <div id="dream-container"></div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="card border-0 shadow-sm mb-3">
        <div class="card-body">
            <h6 class="fw-bold text-dark"><i class="fas fa-route me-2 text-info"></i>äººç”Ÿè²¡å‹™é‡Œç¨‹ç¢‘</h6>
            <div id="life-timeline" class="timeline-box">
                <div class="text-center text-muted small py-2">è«‹è¨­å®šå¹´é½¡èˆ‡è²¸æ¬¾...</div>
            </div>
        </div>
    </div>

    <div class="accordion shadow-sm rounded-3 overflow-hidden" id="financeAccordion">
        
        <div class="accordion-item border-0 border-bottom">
            <h2 class="accordion-header">
                <button class="accordion-button fw-bold text-success" type="button" data-bs-toggle="collapse" data-bs-target="#collapseIncome">
                    ğŸ’° æ”¶å…¥å¡«å¯« (å¯é¸å¹´/æœˆ)
                </button>
            </h2>
            <div id="collapseIncome" class="accordion-collapse collapse show" data-bs-parent="#financeAccordion">
                <div class="accordion-body">
                    <h6 class="small fw-bold text-muted mb-2">ğŸ’¼ ä¸»å‹•æ”¶å…¥</h6>
                    <div class="input-group mb-3">
                        <span class="input-group-text fw-bold">æœ¬æ¥­è–ªè³‡</span>
                        <input type="number" class="form-control save-input domestic-inc wan-target text-income" id="income-active" placeholder="è¼¸å…¥é‡‘é¡">
                        <select class="form-select unit-select" id="active-unit" onchange="calculateAll();saveDataLocal()">
                            <option value="month">æœˆ</option>
                            <option value="year">å¹´</option>
                        </select>
                        <span class="input-group-text wan-hint" id="hint-income-active">0 è¬</span>
                    </div>
                    
                    <hr>
                    <h6 class="small fw-bold text-success mb-2">ğŸš€ è¢«å‹•æ”¶å…¥</h6>
                    
                    <div class="input-group mb-2">
                        <span class="input-group-text bg-success text-white fw-bold">å®‰éº—æ”¶å…¥</span>
                        <input type="number" class="form-control save-input domestic-inc passive-source wan-target text-income" id="income-amway" placeholder="è¼¸å…¥é‡‘é¡">
                        <select class="form-select unit-select" id="amway-unit" onchange="calculateAll();saveDataLocal()">
                            <option value="month">æœˆ</option>
                            <option value="year">å¹´</option>
                        </select>
                        <span class="input-group-text wan-hint" id="hint-income-amway">0 è¬</span>
                    </div>

                    <div class="input-group mb-2">
                        <span class="input-group-text fw-bold">è‚¡æ¯(å°è‚¡)</span>
                        <input type="number" class="form-control save-input domestic-inc passive-source wan-target text-income" id="income-stock-div" placeholder="æœˆå¹³å‡">
                        <span class="input-group-text wan-hint" id="hint-income-stock-div">0 è¬</span>
                    </div>

                    <div class="input-group mb-2">
                        <span class="input-group-text fw-bold">åŸºé‡‘é…æ¯</span>
                        <input type="number" class="form-control save-input domestic-inc passive-source wan-target text-income" id="income-fund-div" placeholder="æœˆé…æ¯">
                        <span class="input-group-text wan-hint" id="hint-income-fund-div">0 è¬</span>
                    </div>

                    <div class="input-group mb-2">
                        <span class="input-group-text fw-bold">ğŸ  æˆ¿ç§Ÿ</span>
                        <input type="number" class="form-control save-input domestic-inc passive-source wan-target text-income" id="income-rent" placeholder="æœˆç§Ÿé‡‘">
                        <span class="input-group-text wan-hint" id="hint-income-rent">0 è¬</span>
                    </div>

                    <div class="input-group mb-3">
                        <span class="input-group-text fw-bold">â• å…¶ä»–</span>
                        <input type="number" class="form-control save-input domestic-inc passive-source wan-target text-income" id="income-other-passive" placeholder="å…¶ä»–">
                        <span class="input-group-text wan-hint" id="hint-income-other-passive">0 è¬</span>
                    </div>

                    <hr>
                    <h6 class="small fw-bold text-primary mb-2">ğŸ‡ºğŸ‡¸ æµ·å¤–æ‰€å¾— (750è¬å…ç¨…)</h6>
                    <div class="input-group mb-2">
                        <span class="input-group-text fw-bold">æµ·å¤–é…æ¯</span>
                        <input type="number" class="form-control save-input overseas-inc passive-source text-income" id="income-overseas-div" placeholder="é‡‘é¡">
                        <select class="form-select bg-light fw-bold" style="max-width: 90px;" id="currency-overseas-div">
                            <option value="TWD">TWD</option>
                            <option value="USD" selected>USD</option>
                        </select>
                    </div>
                    <div class="form-text text-end mt-0 mb-2 fw-bold text-secondary" id="hint-overseas-div">â‰ˆ NT$ 0</div>
                </div>
            </div>
        </div>

        <div class="accordion-item border-0 border-bottom">
            <h2 class="accordion-header">
                <button class="accordion-button collapsed fw-bold text-danger" type="button" data-bs-toggle="collapse" data-bs-target="#collapseDebt">
                    ğŸ’¸ æ”¯å‡ºèˆ‡è² å‚µ
                </button>
            </h2>
            <div id="collapseDebt" class="accordion-collapse collapse" data-bs-parent="#financeAccordion">
                <div class="accordion-body">
                    <div class="d-flex justify-content-between align-items-center mb-2">
                        <h6 class="fw-bold text-secondary m-0">ğŸ’³ è²¸æ¬¾åˆ—è¡¨</h6>
                        <button class="btn btn-sm btn-outline-danger fw-bold rounded-pill" onclick="addLoanRow()"><i class="fas fa-plus"></i> æ–°å¢</button>
                    </div>
                    <div id="loan-container"></div>
                    
                    <hr>
                    <div class="d-flex justify-content-between align-items-center mb-2">
                        <h6 class="fw-bold text-secondary m-0">ğŸ¥ ä¿éšªåˆ—è¡¨</h6>
                        <button class="btn btn-sm btn-outline-success fw-bold rounded-pill" onclick="addInsRow()"><i class="fas fa-plus"></i> æ–°å¢</button>
                    </div>
                    <div id="insurance-container"></div>
                    
                    <hr>
                    <div class="input-group mt-3">
                        <span class="input-group-text fw-bold">å…¶ä»–ç”Ÿæ´»è²»</span>
                        <input type="number" class="form-control save-input wan-target text-expense" id="expense-living" placeholder="ä¼™é£Ÿ/æ°´é›»ç­‰">
                        <span class="input-group-text wan-hint" id="hint-expense-living">0 è¬</span>
                    </div>
                </div>
            </div>
        </div>

        <div class="accordion-item border-0">
            <h2 class="accordion-header">
                <button class="accordion-button collapsed fw-bold text-primary" type="button" data-bs-toggle="collapse" data-bs-target="#collapseAsset">
                    ğŸ’ ç¸½è³‡ç”¢
                </button>
            </h2>
            <div id="collapseAsset" class="accordion-collapse collapse" data-bs-parent="#financeAccordion">
                <div class="accordion-body">
                    <div class="input-group mb-2">
                        <span class="input-group-text fw-bold">ğŸ‡¹ğŸ‡¼ å­˜æ¬¾</span>
                        <input type="number" class="form-control save-input asset-item wan-target text-asset" id="asset-cash" placeholder="NTD">
                        <span class="input-group-text wan-hint" id="hint-asset-cash">0 è¬</span>
                    </div>
                    <div class="input-group mb-2">
                        <span class="input-group-text fw-bold">ğŸ‡¹ğŸ‡¼ æˆ¿ç”¢</span>
                        <input type="number" class="form-control save-input asset-item wan-target text-asset" id="asset-house-val" placeholder="NTD">
                        <span class="input-group-text wan-hint" id="hint-asset-house-val">0 è¬</span>
                    </div>
                    <div class="input-group mb-2">
                        <span class="input-group-text fw-bold">ğŸ‡¹ğŸ‡¼ è‚¡ç¥¨</span>
                        <input type="number" class="form-control save-input asset-item wan-target text-asset" id="asset-tw-stock" placeholder="NTD">
                        <span class="input-group-text wan-hint" id="hint-asset-tw-stock">0 è¬</span>
                    </div>
                    
                    <div class="p-3 border rounded-3 bg-light mt-3">
                        <h6 class="small fw-bold text-primary mb-2">ğŸ‡ºğŸ‡¸ æµ·å¤–è³‡ç”¢ (åŒ¯ç‡æ›ç®—)</h6>
                        <div class="input-group mb-1">
                            <span class="input-group-text border-0 fw-bold">ç¾è‚¡/åŸºé‡‘</span>
                            <input type="number" class="form-control save-input border-0 text-asset" id="asset-us-stock" placeholder="USD">
                            <span class="input-group-text border-0 text-primary fw-bold">USD</span>
                        </div>
                        <div class="text-end text-muted small mb-2 fw-bold" id="hint-us-asset">â‰ˆ NT$ 0</div>
                        
                        <div class="input-group mb-1">
                            <span class="input-group-text border-0 fw-bold">æµ·å¤–ä¿å–®</span>
                            <input type="number" class="form-control save-input border-0 text-asset" id="asset-us-insurance" placeholder="USD">
                            <span class="input-group-text border-0 text-primary fw-bold">USD</span>
                        </div>
                        <div class="text-end text-muted small fw-bold" id="hint-us-insurance">â‰ˆ NT$ 0</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="card mt-4 mb-4 shadow-sm">
        <div class="card-header bg-white border-bottom-0 d-flex justify-content-between pt-3">
            <span class="fw-bold text-secondary">ğŸ“… æ­·å²ç´€éŒ„</span>
            <button class="btn btn-xs btn-light text-muted border" onclick="clearHistory()">æ¸…ç©º</button>
        </div>
        <div class="card-body p-0">
            <table class="table table-hover mb-0 text-center history-table" style="font-size:0.9rem">
                <thead class="bg-light text-muted"><tr><th>æ—¥æœŸ</th><th>è¢«å‹•æ”¶å…¥</th><th>ç¸½è³‡ç”¢</th><th></th></tr></thead>
                <tbody id="history-list"></tbody>
            </table>
            <div id="no-history" class="text-center p-3 text-muted small
