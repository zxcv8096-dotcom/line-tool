<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>è²¡å¯Œè‡ªç”±è¦åŠƒè¡¨ ğŸš€</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { background-color: #f0f2f5; font-family: "Microsoft JhengHei", sans-serif; padding-bottom: 80px; }
        .card { border: none; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.05); margin-bottom: 15px; }
        .card-header { font-weight: bold; border-radius: 12px 12px 0 0 !important; color: white; }
        
        /* è‰²å½©å®šç¾© */
        .bg-income { background: linear-gradient(45deg, #11998e, #38ef7d); }
        .bg-expense { background: linear-gradient(45deg, #ff5f6d, #ffc371); }
        .bg-asset { background: linear-gradient(45deg, #2193b0, #6dd5ed); }
        .bg-liability { background: linear-gradient(45deg, #f2994a, #f2c94c); }
        .bg-amway { background: linear-gradient(45deg, #4b6cb7, #182848); }

        .progress { height: 25px; border-radius: 15px; background-color: #e9ecef; }
        .stat-value { font-size: 1.2rem; font-weight: 800; }
        .stat-label { font-size: 0.8rem; color: #666; }
        
        /* åˆ‡æ›é–‹é—œæ¨£å¼ */
        .mode-switch { position: fixed; top: 15px; right: 15px; z-index: 1000; }
        
        .result-box {
            background: #fff;
            border-left: 5px solid #0d6efd;
            padding: 15px;
            margin-top: 10px;
            border-radius: 5px;
        }
        
        /* é‡é»å¼·èª¿æ–‡å­— */
        .highlight-red { color: #dc3545; font-weight: bold; }
        .highlight-green { color: #198754; font-weight: bold; }
    </style>
</head>
<body>

<div class="d-flex justify-content-between align-items-center p-3 bg-white shadow-sm sticky-top">
    <h5 class="m-0 fw-bold">ğŸ’ è²¡å¯Œè‡ªç”±è¦åŠƒ</h5>
    <div class="form-check form-switch">
        <input class="form-check-input" type="checkbox" id="yearModeToggle">
        <label class="form-check-label fw-bold" for="yearModeToggle">åˆ‡æ›å¹´è¦–è§’</label>
    </div>
</div>

<div class="container py-3">

    <div class="card">
        <div class="card-body text-center">
            <h6 class="text-muted mb-3">æ‚¨çš„è²¡å‹™å¥åº·å ±å‘Š</h6>
            
            <label class="d-flex justify-content-between fw-bold mb-1">
                <span>è²¡å¯Œè‡ªç”±åº¦ (è¢«å‹•æ”¶å…¥/ç¸½æ”¯å‡º)</span>
                <span id="freedom-rate">0%</span>
            </label>
            <div class="progress mb-3">
                <div id="freedom-bar" class="progress-bar progress-bar-striped progress-bar-animated bg-success" role="progressbar" style="width: 0%"></div>
            </div>

            <label class="d-flex justify-content-between fw-bold mb-1">
                <span>è³‡ç”¢è² å‚µæ¯” (ç¸½è² å‚µ/ç¸½è³‡ç”¢)</span>
                <span id="debt-ratio">0%</span>
            </label>
            <div class="progress">
                <div id="debt-bar" class="progress-bar bg-warning" role="progressbar" style="width: 0%"></div>
            </div>
            <small class="text-muted d-block mt-1">*å»ºè­°è³‡ç”¢è² å‚µæ¯”ä½æ–¼ 50%</small>
        </div>
    </div>

    <div class="card border-primary border-2">
        <div class="card-header bg-amway text-white">
            ğŸ† å®‰éº—è˜ä½ç›®æ¨™æ¨¡æ“¬
        </div>
        <div class="card-body">
            <p class="small text-muted mb-2">é¸æ“‡ä¸€å€‹ç›®æ¨™è˜ä½ï¼Œçœ‹çœ‹èƒ½å¦è®“ä½ é”æˆè²¡å¯Œè‡ªç”±ï¼Ÿ</p>
            <select class="form-select mb-3 fw-bold text-primary" id="pin-selector">
                <option value="0" selected>-- è«‹é¸æ“‡ç›®å‰æˆ–ç›®æ¨™è˜ä½ --</option>
                <option value="1000000">ç™½é‡‘ (å¹´è–ªç´„ 100è¬)</option>
                <option value="1800000">è—å¯¶çŸ³ (å¹´è–ªç´„ 180è¬)</option>
                <option value="2500000">ç¿¡ç¿  (å¹´è–ªç´„ 250è¬)</option>
                <option value="5000000">é‘½çŸ³ (å¹´è–ªç´„ 500è¬)</option>
                <option value="7000000">EDC (å¹´è–ªç´„ 700è¬)</option>
                <option value="10000000">çš‡å†  (å¹´è–ªç´„ 1000è¬)</option>
                <option value="30000000">çš‡å† å¤§ä½¿ (å¹´è–ªç´„ 3000è¬)</option>
            </select>
            
            <div id="simulation-result" class="result-box d-none">
                </div>
        </div>
    </div>

    <div class="accordion" id="financeAccordion">
        
        <div class="accordion-item">
            <h2 class="accordion-header">
                <button class="accordion-button bg-light fw-bold text-success" type="button" data-bs-toggle="collapse" data-bs-target="#collapseIncome">
                    ğŸ’° æ”¶å…¥ä¾†æº (æ¯æœˆ)
                </button>
            </h2>
            <div id="collapseIncome" class="accordion-collapse collapse show" data-bs-parent="#financeAccordion">
                <div class="accordion-body">
                    <div class="mb-3">
                        <label class="form-label badge bg-secondary">ä¸»å‹•æ”¶å…¥</label>
                        <div class="input-group">
                            <span class="input-group-text">æœ¬æ¥­è–ªè³‡</span>
                            <input type="number" class="form-control save-input" id="active-salary" placeholder="0">
                        </div>
                    </div>
                    <hr>
                    <div class="mb-3">
                        <label class="form-label badge bg-success">è¢«å‹•æ”¶å…¥ (é—œéµ)</label>
                        <div class="input-group mb-2">
                            <span class="input-group-text">å®‰éº—æœˆæ”¶å…¥</span>
                            <input type="number" class="form-control save-input passive-source" id="passive-amway" placeholder="0">
                        </div>
                        <div class="input-group mb-2">
                            <span class="input-group-text">è‚¡ç¥¨/åŸºé‡‘é…æ¯</span>
                            <input type="number" class="form-control save-input passive-source" id="passive-stock" placeholder="0">
                        </div>
                         <div class="input-group">
                            <span class="input-group-text">æˆ¿ç§Ÿ/å…¶ä»–</span>
                            <input type="number" class="form-control save-input passive-source" id="passive-other" placeholder="0">
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="accordion-item">
            <h2 class="accordion-header">
                <button class="accordion-button collapsed bg-light fw-bold text-danger" type="button" data-bs-toggle="collapse" data-bs-target="#collapseExpense">
                    ğŸ’¸ ç¸½æ”¯å‡º (æ¯æœˆ)
                </button>
            </h2>
            <div id="collapseExpense" class="accordion-collapse collapse" data-bs-parent="#financeAccordion">
                <div class="accordion-body">
                    <p class="small text-muted">åŒ…å«ç”Ÿæ´»è²»ã€ä¿éšªã€è²¸æ¬¾æœˆä»˜é‡‘ç­‰æ‰€æœ‰æµå‡º</p>
                    <div class="input-group">
                        <span class="input-group-text">æ¯æœˆç¸½æ”¯å‡º</span>
                        <input type="number" class="form-control save-input" id="total-expense" placeholder="è¼¸å…¥ç¸½é¡å³å¯">
                    </div>
                </div>
            </div>
        </div>

        <div class="accordion-item">
            <h2 class="accordion-header">
                <button class="accordion-button collapsed bg-light fw-bold text-primary" type="button" data-bs-toggle="collapse" data-bs-target="#collapseAsset">
                    ğŸ’ ç¸½è³‡ç”¢ (ç¾å€¼)
                </button>
            </h2>
            <div id="collapseAsset" class="accordion-collapse collapse" data-bs-parent="#financeAccordion">
                <div class="accordion-body">
                    <div class="input-group mb-2">
                        <span class="input-group-text">ç¾é‡‘/å­˜æ¬¾</span>
                        <input type="number" class="form-control save-input asset-item" id="asset-cash" placeholder="0">
                    </div>
                    <div class="input-group mb-2">
                        <span class="input-group-text">è‚¡ç¥¨/ä¿å–®ç¾åƒ¹</span>
                        <input type="number" class="form-control save-input asset-item" id="asset-stock" placeholder="0">
                    </div>
                    <div class="input-group">
                        <span class="input-group-text">æˆ¿ç”¢å¸‚å€¼</span>
                        <input type="number" class="form-control save-input asset-item" id="asset-house" placeholder="0">
                    </div>
                </div>
            </div>
        </div>

        <div class="accordion-item">
            <h2 class="accordion-header">
                <button class="accordion-button collapsed bg-light fw-bold text-warning" type="button" data-bs-toggle="collapse" data-bs-target="#collapseLiab">
                    ğŸ’£ ç¸½è² å‚µ (é¤˜é¡)
                </button>
            </h2>
            <div id="collapseLiab" class="accordion-collapse collapse" data-bs-parent="#financeAccordion">
                <div class="accordion-body">
                    <div class="input-group mb-2">
                        <span class="input-group-text">æˆ¿è²¸é¤˜é¡</span>
                        <input type="number" class="form-control save-input liab-item" id="liab-house" placeholder="0">
                    </div>
                    <div class="input-group mb-2">
                        <span class="input-group-text">è»Šè²¸/ä¿¡è²¸</span>
                        <input type="number" class="form-control save-input liab-item" id="liab-loan" placeholder="0">
                    </div>
                    <div class="input-group">
                        <span class="input-group-text">å…¶ä»–è² å‚µ</span>
                        <input type="number" class="form-control save-input liab-item" id="liab-other" placeholder="0">
                    </div>
                </div>
            </div>
        </div>

    </div>

    <div class="text-center mt-4">
        <button class="btn btn-outline-secondary btn-sm" onclick="clearData()">ğŸ—‘ï¸ æ¸…é™¤æ‰€æœ‰ç´€éŒ„</button>
        <p class="text-muted mt-2" style="font-size: 0.8rem;">æ•¸æ“šåƒ…å„²å­˜æ–¼æ‚¨çš„æ­¤å°è£ç½®ï¼Œä¿éšœéš±ç§ã€‚</p>
    </div>

</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script>
    // åˆå§‹åŒ–
    document.addEventListener('DOMContentLoaded', () => {
        loadData();
        calculateAll();
    });

    const inputs = document.querySelectorAll('.save-input');
    const pinSelector = document.getElementById('pin-selector');
    const toggleYearMode = document.getElementById('yearModeToggle');
    let isYearMode = false;

    // ç›£è½æ‰€æœ‰è¼¸å…¥æ¡†è®Šå‹• -> è¨ˆç®— + å­˜æª”
    inputs.forEach(input => {
        input.addEventListener('input', () => {
            saveData();
            calculateAll();
        });
    });

    // ç›£è½è˜ä½é¸æ“‡
    pinSelector.addEventListener('change', calculateAll);

    // ç›£è½å¹´æ¨¡å¼åˆ‡æ›
    toggleYearMode.addEventListener('change', function() {
        isYearMode = this.checked;
        updateDisplayMode();
    });

    function updateDisplayMode() {
        // æ›´æ–°é¡¯ç¤ºæ–‡å­—
        const multiplier = isYearMode ? 12 : 1;
        
        // é€™è£¡æˆ‘å€‘ä¸æ”¹è®Šè¼¸å…¥æ¡†çš„å€¼ï¼Œåªæ”¹è®Šè¨ˆç®—é‚è¼¯çš„é¡¯ç¤º (æˆ–è€…ä½ å¯ä»¥é¸æ“‡æŠŠè¼¸å…¥æ¡†çš„å€¼ä¹Ÿx12ï¼Œä½†æ¯”è¼ƒè¤‡é›œ)
        // ç‚ºäº†ç°¡å–®ç›´è¦ºï¼Œæˆ‘å€‘ç´„å®šã€Œè¼¸å…¥æ¡†æ°¸é è¼¸å…¥æœˆé¡ã€ï¼Œä½†ã€Œé¡¯ç¤ºçµæœã€å¯ä»¥åˆ‡æ›å¹´/æœˆ
        calculateAll(); 
    }

    function calculateAll() {
        // 1. å–å¾—æ•¸å€¼ (é è¨­å¾è¼¸å…¥æ¡†æ‹¿åˆ°çš„éƒ½æ˜¯ã€Œæœˆã€)
        let activeSalary = Number(document.getElementById('active-salary').value) || 0;
        let passiveAmway = Number(document.getElementById('passive-amway').value) || 0;
        let passiveStock = Number(document.getElementById('passive-stock').value) || 0;
        let passiveOther = Number(document.getElementById('passive-other').value) || 0;
        let totalExpense = Number(document.getElementById('total-expense').value) || 0;

        // è³‡ç”¢èˆ‡è² å‚µ (å­˜é‡ï¼Œä¸åˆ†å¹´æœˆ)
        let totalAsset = 0;
        document.querySelectorAll('.asset-item').forEach(i => totalAsset += Number(i.value) || 0);
        
        let totalLiability = 0;
        document.querySelectorAll('.liab-item').forEach(i => totalLiability += Number(i.value) || 0);

        // æ¨¡æ“¬çš„è˜ä½æ”¶å…¥ (å¹´è–ª)
        let targetPinAnnualIncome = Number(pinSelector.value) || 0;

        // --- è¨ˆç®—é‚è¼¯ ---
        
        // å¦‚æœæ˜¯å¹´æ¨¡å¼ï¼Œæµå‹•è³‡é‡‘ x12
        let displayMultiplier = isYearMode ? 12 : 1;
        
        let currentPassiveMonthly = passiveAmway + passiveStock + passiveOther;
        let currentPassiveDisplay = currentPassiveMonthly * displayMultiplier;
        let expenseDisplay = totalExpense * displayMultiplier;

        // A. è²¡å¯Œè‡ªç”±åº¦ = è¢«å‹•æ”¶å…¥ / ç¸½æ”¯å‡º
        let freedomRate = 0;
        if (totalExpense > 0) {
            freedomRate = (currentPassiveMonthly / totalExpense) * 100;
        }
        
        // æ›´æ–° UI - è‡ªç”±åº¦
        document.getElementById('freedom-rate').textContent = freedomRate.toFixed(1) + "%";
        let freedomBar = document.getElementById('freedom-bar');
        freedomBar.style.width = Math.min(freedomRate, 100) + "%";
        if(freedomRate >= 100) {
            freedomBar.classList.remove('bg-success');
            freedomBar.classList.add('bg-warning'); // é‡‘è‰²ç‹€æ…‹
        } else {
            freedomBar.classList.remove('bg-warning');
            freedomBar.classList.add('bg-success');
        }

        // B. è³‡ç”¢è² å‚µæ¯” = ç¸½è² å‚µ / ç¸½è³‡ç”¢
        let debtRate = 0;
        if (totalAsset > 0) {
            debtRate = (totalLiability / totalAsset) * 100;
        }
        document.getElementById('debt-ratio').textContent = debtRate.toFixed(1) + "%";
        let debtBar = document.getElementById('debt-bar');
        debtBar.style.width = Math.min(debtRate, 100) + "%";
        // è­¦ç¤ºè‰²
        if(debtRate > 50) debtBar.className = "progress-bar bg-danger";
        else debtBar.className = "progress-bar bg-info";


        // C. å®‰éº—è˜ä½æ¨¡æ“¬
        let simBox = document.getElementById('simulation-result');
        if (targetPinAnnualIncome > 0) {
            simBox.classList.remove('d-none');
            
            // ç›®æ¨™è˜ä½çš„æœˆæ”¶å…¥
            let targetPinMonthly = targetPinAnnualIncome / 12;
            
            // åŠ ä¸ŠåŸæœ¬çš„éå®‰éº—è¢«å‹•æ”¶å…¥
            let nonAmwayPassive = passiveStock + passiveOther;
            let projectedTotalPassive = targetPinMonthly + nonAmwayPassive;
            
            let projectedFreedomRate = 0;
            if (totalExpense > 0) {
                projectedFreedomRate = (projectedTotalPassive / totalExpense) * 100;
            }

            let statusIcon = projectedFreedomRate >= 100 ? "ğŸ‰" : "ğŸ’ª";
            let statusText = projectedFreedomRate >= 100 ? "æ­å–œï¼é”æˆè²¡å¯Œè‡ªç”±ï¼" : "é‚„å·®ä¸€é»ï¼Œç¹¼çºŒåŠ æ²¹ï¼";
            let statusClass = projectedFreedomRate >= 100 ? "text-success" : "text-warning";

            // é¡¯ç¤ºæ–‡å­—
            let periodText = isYearMode ? "å¹´" : "æœˆ";
            let showIncome = isYearMode ? targetPinAnnualIncome : targetPinMonthly;
            let showProjectedPassive = isYearMode ? projectedTotalPassive * 12 : projectedTotalPassive;

            simBox.innerHTML = `
                <h5 class="${statusClass}">${statusIcon} ${statusText}</h5>
                <p class="mb-1">è‹¥é”æˆæ­¤è˜ä½ï¼Œæ‚¨çš„ç¸½è¢«å‹•æ”¶å…¥å°‡æå‡è‡³ï¼š</p>
                <h3 class="fw-bold text-dark">NT$ ${formatNumber(showProjectedPassive)} / ${periodText}</h3>
                <p class="mb-0 text-muted">é ä¼°è²¡å¯Œè‡ªç”±åº¦ï¼š<strong>${projectedFreedomRate.toFixed(1)}%</strong></p>
            `;
        } else {
            simBox.classList.add('d-none');
        }
    }

    // æ ¼å¼åŒ–æ•¸å­— (åƒåˆ†ä½)
    function formatNumber(num) {
        return num.toFixed(0).replace(/\B(?=(\d{3})+(?!\d))/g, ",");
    }

    // --- å„²å­˜èˆ‡è®€å– (LocalStorage) ---
    function saveData() {
        let data = {};
        inputs.forEach(input => {
            data[input.id] = input.value;
        });
        // ä¹Ÿè¦å­˜é¸ä¸­çš„è˜ä½
        data['pin-selector'] = pinSelector.value;
        
        localStorage.setItem('myFinanceData', JSON.stringify(data));
    }

    function loadData() {
        let stored = localStorage.getItem('myFinanceData');
        if (stored) {
            let data = JSON.parse(stored);
            for (let id in data) {
                let el = document.getElementById(id);
                if (el) el.value = data[id];
            }
        }
    }

    function clearData() {
        if(confirm('ç¢ºå®šè¦æ¸…é™¤æ‰€æœ‰ç´€éŒ„å—ï¼Ÿ(ç„¡æ³•å¾©åŸ)')) {
            localStorage.removeItem('myFinanceData');
            location.reload();
        }
    }
</script>

</body>
</html>
