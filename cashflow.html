<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>å¤§å¿ƒè²¡å¯Œé ˜èˆªç³»çµ± - Gavin</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --primary-bg: #f0f4f8;
            --card-bg: #ffffff;
            --main-blue: #2d5a9e;
            --amway-red: #ff5e62;
            --success-green: #27ae60;
            --text-dark: #2c3e50;
        }

        body {
            font-family: 'PingFang TC', 'Microsoft JhengHei', sans-serif;
            background-color: var(--primary-bg);
            color: var(--text-dark);
            margin: 0; padding: 10px;
            line-height: 1.6;
        }

        .container { max-width: 900px; margin: 0 auto; }

        header {
            text-align: center; padding: 20px 0;
            background: white; border-radius: 20px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
            margin-bottom: 20px;
        }

        h1 { margin: 0; color: var(--main-blue); font-size: 1.4rem; }

        /* --- é ‚éƒ¨æˆ°æƒ…å®¤ --- */
        .dashboard {
            display: grid; grid-template-columns: 1fr 1fr;
            gap: 12px; margin-bottom: 20px;
        }

        .stat-card {
            background: white; padding: 15px; border-radius: 18px;
            box-shadow: 0 8px 20px rgba(0,0,0,0.06);
            text-align: center; border-bottom: 4px solid transparent;
        }

        .stat-label { font-size: 0.8rem; color: #7f8c8d; font-weight: bold; }
        .stat-value { font-size: 1.6rem; font-weight: 800; margin: 5px 0; }

        /* å»ºè­°å€å¡Š */
        .advice-card {
            background: linear-gradient(135deg, #ffffff 0%, #fff5f5 100%);
            border: 2px solid var(--amway-red);
            border-radius: 20px; padding: 20px; margin-bottom: 20px;
            text-align: center; animation: slideUp 0.5s ease-out;
        }

        .advice-title { color: var(--amway-red); font-weight: 900; margin-bottom: 8px; }
        .freedom-bar-bg { background: #eee; height: 12px; border-radius: 6px; margin: 10px 0; overflow: hidden; }
        .freedom-bar-fill { height: 100%; background: var(--success-green); transition: width 0.6s ease; }

        /* --- è¼¸å…¥å€ --- */
        .section-title {
            font-size: 1rem; color: var(--main-blue);
            margin: 20px 0 10px 10px; font-weight: 800;
            display: flex; align-items: center; gap: 8px;
        }

        .card { background: white; border-radius: 20px; padding: 20px; margin-bottom: 15px; box-shadow: 0 2px 10px rgba(0,0,0,0.02); }
        .input-group { margin-bottom: 15px; position: relative; }
        label { display: block; font-size: 0.85rem; font-weight: 700; color: #555; margin-bottom: 5px; }
        input, select {
            width: 100%; padding: 12px; border: 1.5px solid #edf2f7; border-radius: 12px;
            font-size: 16px; box-sizing: border-box; background: #f8fafc;
        }

        .unit { position: absolute; right: 12px; top: 35px; font-size: 0.75rem; color: #999; }

        .save-area { text-align: center; margin: 20px 0; }
        .btn-save { background: var(--main-blue); color: white; border: none; padding: 12px 40px; border-radius: 25px; font-weight: bold; cursor: pointer; }

        @keyframes slideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>

<div class="container">
    <header>
        <h1>ğŸ’– å¤§å¿ƒå¤¢æƒ³è·¯å¾‘è¦åŠƒå™¨</h1>
        <div style="font-size: 0.8rem; color: #aaa; margin-top: 5px;">è£½ä½œè€…ï¼šæå˜‰å“² Gavin</div>
    </header>

    <div id="adviceSection" class="advice-card" style="display:none;">
        <div class="advice-title">ğŸ’¡ å°ˆå®¶å»ºè­°èˆ‡è©•ä¼°</div>
        <div id="freedomSummary" style="font-size: 1.1rem; font-weight: 800;"></div>
        
        <div class="freedom-bar-bg">
            <div id="freedomBar" class="freedom-bar-fill" style="width: 0%"></div>
        </div>
        <div id="freedomRatioText" style="font-size: 0.85rem; color: #666;">è²¡å¯Œè‡ªç”±åº¦ï¼š0%</div>
        
        <hr style="border: 0; border-top: 1px dashed #ddd; margin: 15px 0;">
        <div id="speedComparison" style="color: #444; font-size: 0.95rem;"></div>
    </div>

    <div class="dashboard">
        <div class="stat-card" style="border-bottom-color: var(--amway-red);">
            <div class="stat-label">æ¯æœˆç¸½æ”¯å‡º</div>
            <div class="stat-value" id="valTotalExp" style="color: var(--amway-red);">0</div>
            <div style="font-size: 0.7rem;">è¬å…ƒ / æœˆ</div>
        </div>
        <div class="stat-card" style="border-bottom-color: var(--success-green);">
            <div class="stat-label">æ¯æœˆè¢«å‹•ç¾é‡‘æµ</div>
            <div class="stat-value" id="valPassiveFlow" style="color: var(--success-green);">0</div>
            <div style="font-size: 0.7rem;">è¬å…ƒ / æœˆ</div>
        </div>
    </div>

    <div class="section-title">ğŸŒŸ 1. å¤¢æƒ³èˆ‡äººç”Ÿè¦åŠƒ</div>
    <div class="card">
        <div class="input-group">
            <label>ç›®å‰å¹´é½¡</label>
            <input type="number" id="inAge" value="30">
        </div>
        <div class="input-group">
            <label>å¤¢æƒ³äººç”Ÿç›®æ¨™ (è³‡ç”¢ç´¯ç©é¡)</label>
            <select id="inDreamGoal" onchange="syncGoal()">
                <option value="1500">æˆå®¶ç«‹æ¥­ (1500è¬)</option>
                <option value="3000" selected>è²¡å¯Œè‡ªç”± (3000è¬)</option>
                <option value="5000">äººç”Ÿå·”å³° (5000è¬)</option>
                <option value="10000">å¤§å¿ƒå‚³æ‰¿ (1å„„)</option>
                <option value="custom">è‡ªå®šç¾©é‡‘é¡</option>
            </select>
            <input type="number" id="inGoalValue" value="3000" style="margin-top:10px;">
            <span class="unit">è¬å…ƒ</span>
        </div>
        <div class="input-group">
            <label>æœŸå¾…æœªä¾†æ¯æœˆç”Ÿæ´»è²» (æƒ³è¦çš„äººç”Ÿ)</label>
            <input type="number" id="inDreamMonthly" value="20">
            <span class="unit">è¬å…ƒ/æœˆ</span>
        </div>
    </div>

    <div class="section-title">ğŸ’¸ 2. æ”¯å‡ºç¾é‡‘æµ (æœˆ)</div>
    <div class="card">
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
            <div class="input-group"><label>ä¿¡ç”¨è²¸æ¬¾</label><input type="number" id="exCredit" class="calc"></div>
            <div class="input-group"><label>æˆ¿å±‹è²¸æ¬¾</label><input type="number" id="exHouse" class="calc"></div>
            <div class="input-group"><label>æ±½è»Šè²¸æ¬¾</label><input type="number" id="exCar" class="calc"></div>
            <div class="input-group"><label>å­¸åŠ©è²¸æ¬¾</label><input type="number" id="exStudy" class="calc"></div>
        </div>
        <div class="input-group"><label>ç”Ÿæ´»å¿…è¦æ”¯å‡ºèˆ‡å…¶ä»–</label><input type="number" id="exLife" class="calc"></div>
    </div>

    <div class="section-title">ğŸ’° 3. è³‡ç”¢ç¾é‡‘æµ (å¹´)</div>
    <div class="card">
        <div class="input-group">
            <label>æœ¬è·/å‰¯æ¥­å¹´æ”¶å…¥</label>
            <input type="number" id="inActive" class="calc">
            <span class="unit">è¬å…ƒ/å¹´</span>
        </div>
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
            <div class="input-group">
                <label>è‚¡ç¥¨ç¸½é¡</label>
                <input type="number" id="inStock" class="calc">
                <div style="font-size:0.65rem; color:#888;">è‡ªå‹•ä»¥ 5% è¨ˆç®—ç¾é‡‘æµ</div>
            </div>
            <div class="input-group">
                <label>åŸºé‡‘ç¸½é¡</label>
                <input type="number" id="inFund" class="calc">
                <div style="font-size:0.65rem; color:#888;">è‡ªå‹•ä»¥ 5% è¨ˆç®—ç¾é‡‘æµ</div>
            </div>
        </div>
        <div class="input-group">
            <label>ç›®å‰å®‰éº—å¹´æ”¶å…¥</label>
            <input type="number" id="inAmway" class="calc">
            <span class="unit">è¬å…ƒ/å¹´</span>
        </div>
    </div>

    <div class="save-area">
        <button class="btn-save" onclick="saveData()">ğŸ’¾ å„²å­˜æˆ‘çš„è¦åŠƒ</button>
    </div>

    <div style="height: 250px; margin-top: 20px;">
        <canvas id="mainChart"></canvas>
    </div>

    <div style="text-align:center; margin: 30px 0; color:#aaa; font-size:0.75rem;">
        é€šè†¨ç‡é è¨­ç‚º 4% | è³‡ç”¢æˆé•·é è¨­ç‚º 5% <br>
        æ‚¨çš„éš±ç§å®‰å…¨ï¼Œæ•¸æ“šåƒ…å­˜æ–¼æœ¬åœ°è£ç½®ã€‚
    </div>
</div>

<script>
    const amwayLevels = [
        { name: 'ç™½é‡‘', inc: 100 }, { name: 'ç¿¡ç¿ ', inc: 250 }, { name: 'é‘½çŸ³', inc: 500 }, 
        { name: 'EDC', inc: 700 }, { name: 'çš‡å† ', inc: 1000 }, { name: 'çš‡å† å¤§ä½¿', inc: 3000 }
    ];

    window.onload = function() {
        loadData();
        const inputs = document.querySelectorAll('input, select');
        inputs.forEach(i => i.addEventListener('input', updateUI));
        updateUI();
    };

    function syncGoal() {
        const sel = document.getElementById('inDreamGoal').value;
        if(sel !== 'custom') document.getElementById('inGoalValue').value = sel;
    }

    function updateUI() {
        const age = parseFloat(document.getElementById('inAge').value) || 30;
        const goal = parseFloat(document.getElementById('inGoalValue').value) || 0;
        const dreamMonthly = parseFloat(document.getElementById('inDreamMonthly').value) || 0;
        
        // æ”¯å‡ºè¨ˆç®—
        const mExp = (parseFloat(document.getElementById('exCredit').value) || 0) +
                     (parseFloat(document.getElementById('exHouse').value) || 0) +
                     (parseFloat(document.getElementById('exCar').value) || 0) +
                     (parseFloat(document.getElementById('exStudy').value) || 0) +
                     (parseFloat(document.getElementById('exLife').value) || 0);
        document.getElementById('valTotalExp').textContent = mExp.toFixed(1);

        // ç¾é‡‘æµè¨ˆç®— (5%)
        const stockAssets = parseFloat(document.getElementById('inStock').value) || 0;
        const fundAssets = parseFloat(document.getElementById('inFund').value) || 0;
        const amwayInc = parseFloat(document.getElementById('inAmway').value) || 0;
        
        const annualPassive = (stockAssets + fundAssets) * 0.05 + amwayInc;
        const monthlyPassive = annualPassive / 12;
        document.getElementById('valPassiveFlow').textContent = monthlyPassive.toFixed(1);

        // è²¡å¯Œè‡ªç”±åº¦
        const ratio = mExp > 0 ? (monthlyPassive / mExp * 100) : 0;
        document.getElementById('freedomBar').style.width = Math.min(ratio, 100) + "%";
        document.getElementById('freedomRatioText').textContent = `è²¡å¯Œè‡ªç”±åº¦ï¼š${ratio.toFixed(1)}%`;

        // æ ¸å¿ƒå»ºè­°é‚è¼¯
        const activeInc = parseFloat(document.getElementById('inActive').value) || 0;
        const netSavingBase = (activeInc + annualPassive) * 0.85 - (mExp * 12); // ä¼°ç¨…
        const yearsBase = calculateYears(stockAssets + fundAssets, netSavingBase, goal);

        // å®‰éº—å»ºè­° (ç›®æ¨™è¦†è“‹ dreamMonthly)
        const targetTotalNeed = Math.max(mExp, dreamMonthly) * 12;
        const bestLevel = amwayLevels.find(l => (l.inc + (stockAssets+fundAssets)*0.05) >= targetTotalNeed) || amwayLevels[amwayLevels.length-1];
        const netSavingAmway = (activeInc + annualPassive + bestLevel.inc * 0.8) * 0.85 - (mExp * 12);
        const yearsAmway = calculateYears(stockAssets + fundAssets, netSavingAmway, goal);

        document.getElementById('adviceSection').style.display = "block";
        const summary = document.getElementById('freedomSummary');
        if(ratio >= 100) {
            summary.textContent = "âœ… æ‚¨å·²é”æˆåˆæ­¥è²¡å¯Œè‡ªç”±ï¼";
            summary.style.color = "var(--success-green)";
        } else {
            summary.textContent = "ğŸ¯ è²¡å¯Œè‡ªç”±ç›®æ¨™è¡åˆºä¸­";
            summary.style.color = "var(--text-dark)";
        }

        const saved = (yearsBase > 90 ? 100 : yearsBase) - yearsAmway;
        document.getElementById('speedComparison').innerHTML = 
            `å¦‚æœä¸æ”¹è®Šç¾ç‹€ï¼Œé”æˆå¤¢æƒ³ç´„éœ€ <b>${yearsBase > 90 ? 'è¶…é50' : yearsBase}</b> å¹´ã€‚<br>` +
            `è‹¥å•Ÿå‹•å¤§å¿ƒäº‹æ¥­ä¸¦é”æˆ <b>${bestLevel.name}</b>ï¼Œå¯ææ—© <b>${Math.max(0, saved)}</b> å¹´å®Œæˆå¤¢æƒ³ï¼`;

        renderChart(age, yearsBase, yearsAmway, goal);
    }

    function calculateYears(cur, sav, target) {
        if(sav <= 0 && cur < target) return 999;
        let a = cur; let y = 0;
        while(a < target && y < 100) { a = a * 1.05 + sav; y++; }
        return y;
    }

    let chart = null;
    function renderChart(age, yA, yB, goal) {
        const ctx = document.getElementById('mainChart').getContext('2d');
        if(chart) chart.destroy();
        const max = Math.min(Math.max(yA < 90 ? yA : 50, yB < 90 ? yB : 50) + 5, 50);
        const labels = []; const dA = []; const dB = [];
        for(let i=0; i<=max; i++) {
            labels.push(age + i);
            dA.push(yA > 90 ? 0 : Math.min(goal, (i/yA)*goal));
            dB.push(yB > 90 ? 0 : Math.min(goal, (i/yB)*goal));
        }
        chart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: labels,
                datasets: [
                    { label: 'ç¾ç‹€ç´¯ç©', data: dA, borderColor: '#ccc', borderWidth: 2, pointRadius: 0 },
                    { label: 'å¤§å¿ƒåŠ é€Ÿ', data: dB, borderColor: '#ff5e62', backgroundColor: 'rgba(255,94,98,0.1)', borderWidth: 4, fill: true, pointRadius: 0 }
                ]
            },
            options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { position: 'bottom' } }, scales: { y: { display: false } } }
        });
    }

    function saveData() {
        const data = {};
        document.querySelectorAll('input, select').forEach(i => data[i.id] = i.value);
        localStorage.setItem('gavinWealthV3', JSON.stringify(data));
        alert('âœ… æ‚¨çš„å¤¢æƒ³è·¯å¾‘å·²å­˜æª”ï¼');
    }

    function loadData() {
        const saved = localStorage.getItem('gavinWealthV3');
        if(saved) {
            const data = JSON.parse(saved);
            for(const k in data) { if(document.getElementById(k)) document.getElementById(k).value = data[k]; }
        }
    }
</script>

</body>
</html>
