<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>å¤§å¿ƒè²¡å¯Œé ˜èˆªç³»çµ± - Gavin</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --primary-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --accent-gradient: linear-gradient(135deg, #ff6b6b 0%, #ff8e8e 100%);
            --card-bg: #ffffff;
            --bg-color: #f8f9fd;
            --text-main: #2d3436;
            --text-sub: #636e72;
            --success: #00b894;
            --danger: #d63031;
        }

        body {
            font-family: 'PingFang TC', 'Microsoft JhengHei', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-main);
            margin: 0; padding: 15px;
            line-height: 1.6;
        }

        .container { max-width: 1100px; margin: 0 auto; }

        header {
            display: flex; justify-content: space-between; align-items: center;
            margin-bottom: 20px; padding: 15px 20px;
            background: #fff; border-radius: 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.05);
        }

        h1 { font-size: 1.3rem; margin: 0; background: var(--primary-gradient); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }

        /* é ‚éƒ¨ç¸½çµå„€è¡¨æ¿ */
        .dashboard {
            display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 15px; margin-bottom: 25px;
        }

        .metric-card {
            background: #fff; border-radius: 20px; padding: 20px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.05);
            position: relative; overflow: hidden;
            transition: transform 0.3s ease;
        }

        .metric-card:hover { transform: translateY(-5px); }

        .metric-title { font-size: 0.85rem; color: var(--text-sub); font-weight: bold; margin-bottom: 10px; }
        .metric-value { font-size: 2rem; font-weight: 800; margin-bottom: 5px; }
        .metric-footer { font-size: 0.8rem; border-top: 1px solid #f1f1f1; padding-top: 10px; margin-top: 10px; }

        /* æ ¸å¿ƒå»ºè­°å€ */
        .suggestion-card {
            background: var(--accent-gradient); color: #fff;
            border-radius: 20px; padding: 25px; text-align: center;
            margin-bottom: 25px; box-shadow: 0 15px 35px rgba(255, 107, 107, 0.3);
            animation: fadeIn 0.8s ease;
        }

        .speed-up-text { font-size: 1.8rem; font-weight: 900; margin: 10px 0; }

        /* è¼¸å…¥å€åŸŸ */
        .input-grid {
            display: grid; grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 20px;
        }

        .card { background: #fff; border-radius: 20px; padding: 25px; box-shadow: 0 4px 12px rgba(0,0,0,0.03); }
        h2 { font-size: 1.1rem; margin-top: 0; display: flex; align-items: center; gap: 8px; color: #4834d4; }
        h2::before { content: ''; width: 4px; height: 18px; background: #4834d4; border-radius: 2px; }

        .form-group { margin-bottom: 15px; position: relative; }
        label { display: block; font-size: 0.85rem; font-weight: 700; color: #555; margin-bottom: 5px; }
        
        input, select {
            width: 100%; padding: 12px; border: 2px solid #f1f3f5; border-radius: 12px;
            font-size: 16px; box-sizing: border-box; background: #f8f9fa; transition: 0.3s;
        }

        input:focus, select:focus { border-color: #6c5ce7; background: #fff; outline: none; }

        .unit { position: absolute; right: 12px; top: 35px; font-size: 0.75rem; color: #999; pointer-events: none; }

        .total-badge {
            background: #f1f2f6; padding: 10px; border-radius: 12px;
            font-size: 0.9rem; font-weight: bold; margin-top: 10px; text-align: right;
        }

        .chart-container { height: 300px; margin-top: 20px; }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; } }

        .save-btn {
            background: var(--success); color: #fff; border: none; padding: 10px 20px;
            border-radius: 15px; cursor: pointer; font-weight: 800; transition: 0.3s;
        }
        .save-btn:hover { filter: brightness(1.1); }
    </style>
</head>
<body>

<div class="container">
    <header>
        <h1>ğŸ’– å¤§å¿ƒè²¡å¯Œé ˜èˆªç³»çµ±</h1>
        <button class="save-btn" onclick="saveData()">ğŸ’¾ å„²å­˜é€²åº¦</button>
    </header>

    <div id="suggestionCard" class="suggestion-card" style="display:none;">
        <div style="font-weight: bold; opacity: 0.9;">âœ¨ é¡§å•æ™ºèƒ½åˆ†æ</div>
        <div id="levelSuggestion" style="font-size: 1.1rem; margin-top: 5px;"></div>
        <div class="speed-up-text">ğŸš€ æå‰ <span id="yearsFaster">--</span> å¹´å¯¦ç¾å¤¢æƒ³</div>
        <div id="passiveStatus" style="font-size: 0.9rem; background: rgba(0,0,0,0.1); padding: 5px 15px; border-radius: 20px; display: inline-block;"></div>
    </div>

    <div class="dashboard">
        <div class="metric-card" style="border-top: 5px solid var(--danger);">
            <div class="metric-title">âš ï¸ ç”Ÿå­˜é è­¦ (ä¸»å‹•æ”¶å…¥ä¸­æ–·)</div>
            <div class="metric-value" id="survivalYears" style="color: var(--danger);">--</div>
            <div class="metric-footer" id="survivalMsg">è«‹è¼¸å…¥ä¸‹æ–¹é–‹æ”¯è³‡æ–™</div>
        </div>
        <div class="metric-card" style="border-top: 5px solid #6c5ce7;">
            <div class="metric-title">ğŸ¯ å¤¢æƒ³é”æˆè¨ˆç•«</div>
            <div class="metric-value" id="currentGoalAge">-- <span style="font-size:1.2rem;">æ­²</span></div>
            <div class="metric-footer">é€šè†¨ç‡å·²é–å®šç‚º 4.0% ğŸš©</div>
        </div>
    </div>

    <div class="card" style="margin-bottom:20px;">
        <h2>ğŸ“Š è²¡å¯Œç´¯ç©å°æ¯”åœ–</h2>
        <div class="chart-container">
            <canvas id="wealthChart"></canvas>
        </div>
    </div>

    <div class="input-grid">
        <div class="card">
            <h2>1. å¤¢æƒ³æ¸…å–®</h2>
            <div class="form-group">
                <label>ç›®å‰å¹´é½¡</label>
                <input type="number" id="currentAge" value="30">
            </div>
            <div class="form-group">
                <label>é¸æ“‡å¤¢æƒ³ç›®æ¨™ (å¯ä¿®æ”¹é‡‘é¡)</label>
                <select id="dreamSelect" onchange="applyDreamPreset()">
                    <option value="1500">æˆå®¶ç«‹æ¥­ (é ç®— 1500è¬)</option>
                    <option value="3000" selected>è²¡å¯Œè‡ªä¸» (é ç®— 3000è¬)</option>
                    <option value="5000">ç’°éŠä¸–ç•Œ/èˆ’é©é€€ä¼‘ (é ç®— 5000è¬)</option>
                    <option value="10000">å‚³æ‰¿å¾Œä»£ (é ç®— 1å„„)</option>
                    <option value="custom">è‡ªå®šç¾©é‡‘é¡</option>
                </select>
            </div>
            <div class="form-group">
                <label>å¤¢æƒ³ç¸½è³‡ç”¢é¡</label>
                <input type="number" id="dreamGoalValue" value="3000">
                <span class="unit">è¬å…ƒ</span>
            </div>
            <div class="form-group">
                <label>æœŸæœ›æ¯æœˆæ”¶å…¥ (è²¡å¯Œè‡ªç”±å¾Œ)</label>
                <input type="number" id="dreamMonthlyIncome" value="20">
                <span class="unit">è¬å…ƒ/æœˆ</span>
            </div>
        </div>

        <div class="card">
            <h2>2. æœˆæ”¯å‡ºèˆ‡è² å‚µ</h2>
            <div class="form-group"><label>ä¿¡ç”¨è²¸æ¬¾</label><input type="number" id="expCredit" class="calc"><span class="unit">è¬å…ƒ/æœˆ</span></div>
            <div class="form-row" style="display:grid; grid-template-columns: 1fr 1fr; gap:10px;">
                <div class="form-group"><label>æˆ¿å±‹è²¸æ¬¾</label><input type="number" id="expHouse" class="calc"></div>
                <div class="form-group"><label>æ±½è»Šè²¸æ¬¾</label><input type="number" id="expCar" class="calc"></div>
            </div>
            <div class="form-row" style="display:grid; grid-template-columns: 1fr 1fr; gap:10px;">
                <div class="form-group"><label>åŠ©å­¸è²¸æ¬¾</label><input type="number" id="expStudy" class="calc"></div>
                <div class="form-group"><label>ç”Ÿæ´»å…¶ä»–</label><input type="number" id="expLife" class="calc"></div>
            </div>
            <div class="total-badge">ç¸½æœˆæ”¯å‡ºï¼š<span id="totalMonthlyExp" style="color:var(--danger);">0</span> è¬å…ƒ</div>
        </div>

        <div class="card">
            <h2>3. ç¾æœ‰å¹´æ”¶å…¥</h2>
            <div class="form-group"><label>ä¸»å‹•ç¸½å¹´è–ª (æœ¬è·+å‰¯æ¥­)</label><input type="number" id="activeInc" class="calc"><span class="unit">è¬å…ƒ/å¹´</span></div>
            <div class="form-row" style="display:grid; grid-template-columns: 1fr 1fr; gap:10px;">
                <div class="form-group"><label>è‚¡ç¥¨åŸºé‡‘é…æ¯</label><input type="number" id="passStock" class="calc"></div>
                <div class="form-group"><label>ç›®å‰å®‰éº—å¹´æ”¶</label><input type="number" id="passAmway" class="calc"></div>
            </div>
            <div class="form-group"><label>å…¶ä»–è¢«å‹•/æˆ¿ç§Ÿ</label><input type="number" id="passOther" class="calc"><span class="unit">è¬å…ƒ/å¹´</span></div>
            <div class="form-group"><label>ç›®å‰ç¸½è³‡ç”¢</label><input type="number" id="currentAssets" class="calc"><span class="unit">è¬å…ƒ</span></div>
            <div class="total-badge">ç¸½è¢«å‹•æ”¶å…¥ï¼š<span id="totalPassiveInc" style="color:var(--success);">0</span> è¬å…ƒ/å¹´</div>
        </div>
    </div>

    <div style="text-align:center; margin-top:30px; color:#aaa; font-size:0.75rem;">
        ğŸ”’ æ‰€æœ‰é‹ç®—çš†åœ¨æ‚¨çš„æ‰‹æ©Ÿæœ¬åœ°å®Œæˆ | æå˜‰å“² Gavin è£½ä½œ
    </div>
</div>

<script>
    const amwayLevels = [
        { name: 'ç™½é‡‘', income: 100 },
        { name: 'ç¿¡ç¿ ', income: 250 },
        { name: 'é‘½çŸ³', income: 500 },
        { name: 'åŸ·è¡Œå°ˆæ‰EDC', income: 700 },
        { name: 'çš‡å† ', income: 1000 },
        { name: 'çš‡å† å¤§ä½¿', income: 3000 }
    ];

    window.onload = function() {
        loadData();
        const inputs = document.querySelectorAll('input, select');
        inputs.forEach(input => input.addEventListener('input', runFullCalc));
        runFullCalc();
    };

    function applyDreamPreset() {
        const select = document.getElementById('dreamSelect');
        if (select.value !== 'custom') {
            document.getElementById('dreamGoalValue').value = select.value;
        }
        runFullCalc();
    }

    function runFullCalc() {
        // 1. åŸºæœ¬æ•¸å€¼
        const age = parseFloat(document.getElementById('currentAge').value) || 30;
        const goal = parseFloat(document.getElementById('dreamGoalValue').value) || 0;
        const dreamMonthly = parseFloat(document.getElementById('dreamMonthlyIncome').value) || 0;
        const assets = parseFloat(document.getElementById('currentAssets').value) || 0;
        const infl = 0.04; // é–å®š 4%

        // 2. æ”¯å‡ºåŠ ç¸½
        const mExp = (parseFloat(document.getElementById('expCredit').value) || 0) +
                     (parseFloat(document.getElementById('expHouse').value) || 0) +
                     (parseFloat(document.getElementById('expCar').value) || 0) +
                     (parseFloat(document.getElementById('expStudy').value) || 0) +
                     (parseFloat(document.getElementById('expLife').value) || 0);
        const annualExp = mExp * 12;
        document.getElementById('totalMonthlyExp').textContent = mExp.toFixed(1);

        // 3. æ”¶å…¥èˆ‡è¢«å‹•åŠ ç¸½
        const active = parseFloat(document.getElementById('activeInc').value) || 0;
        const passStock = parseFloat(document.getElementById('passStock').value) || 0;
        const passAmway = parseFloat(document.getElementById('passAmway').value) || 0;
        const passOther = parseFloat(document.getElementById('passOther').value) || 0;
        const totalPassive = passStock + passAmway + passOther;
        document.getElementById('totalPassiveInc').textContent = totalPassive.toFixed(1);

        // 4. ç”Ÿå­˜å¹´é™
        let runway = 0; let tempA = assets;
        if (mExp > 0) {
            while (tempA > 0 && runway < 100) {
                tempA -= (annualExp * Math.pow(1 + infl, runway));
                if (tempA >= 0) runway++; else break;
            }
        }
        const runwayEl = document.getElementById('survivalYears');
        runwayEl.textContent = mExp === 0 ? "âˆ" : runway.toFixed(1) + " å¹´";
        document.getElementById('survivalMsg').textContent = runway < 5 ? "âš ï¸ è²¡å‹™æ¥µåº¦å±éšª" : runway < 15 ? "ğŸ§ é¢¨éšªéœ€è­¦æƒ•" : "âœ… è³‡ç”¢å°šç©©å¥";

        // 5. ç¾ç‹€é ä¼°é”æˆæ™‚é–“
        const netSaving = (active + totalPassive) * 0.88 - annualExp;
        const yCurrent = calculateYears(assets, netSaving, goal, 0.05); // å‡è¨­è³‡ç”¢å ±é…¬ 5%
        document.getElementById('currentGoalAge').innerHTML = (yCurrent > 90 ? ">100" : (age + yCurrent)) + " <span style='font-size:1.2rem;'>æ­²</span>";

        // 6. æ™ºèƒ½å®‰éº—å»ºè­° (æ ¹æ“šæœŸæœ›æœˆæ”¶æˆ–è¦†è“‹æ”¯å‡º)
        const targetTarget = Math.max(annualExp, dreamMonthly * 12);
        let bestLevel = amwayLevels.find(l => l.income >= targetTarget) || amwayLevels[amwayLevels.length - 1];
        
        const netSavingAmway = (active + totalPassive + (bestLevel.income * 0.85)) * 0.88 - annualExp;
        const yAmway = calculateYears(assets, netSavingAmway, goal, 0.05);
        
        const sugCard = document.getElementById('suggestionCard');
        if (mExp > 0) {
            sugCard.style.display = "block";
            const saved = (yCurrent > 90 ? 100 : yCurrent) - yAmway;
            document.getElementById('yearsFaster').textContent = Math.max(0, saved);
            document.getElementById('levelSuggestion').innerHTML = `ğŸ’¡ å»ºè­°é”æˆï¼š<strong>å®‰éº— ${bestLevel.name}</strong> è˜ä½`;
            
            const pStatus = document.getElementById('passiveStatus');
            const ratio = (totalPassive / annualExp * 100).toFixed(0);
            pStatus.innerHTML = `è¢«å‹•æ”¶å…¥è¦†è“‹ç‡ï¼š${ratio}% ${ratio >= 100 ? 'âœ… å·²è‡ªç”±' : 'ğŸš€ åŠªåŠ›ä¸­'}`;
        }

        drawChart(age, yCurrent, yAmway, goal);
    }

    function calculateYears(cur, sav, target, rate) {
        if (sav <= 0 && cur < target) return 999;
        let a = cur; let y = 0;
        while (a < target && y < 100) { a = a * (1 + rate) + sav; y++; }
        return y;
    }

    let myChart = null;
    function drawChart(start, yA, yB, goal) {
        const ctx = document.getElementById('wealthChart').getContext('2d');
        if (myChart) myChart.destroy();
        const max = Math.min(Math.max(yA < 90 ? yA : 50, yB < 90 ? yB : 50) + 5, 50);
        const labels = []; const dA = []; const dB = [];
        for (let i = 0; i <= max; i++) {
            labels.push(start + i + "æ­²");
            dA.push(yA > 90 ? 0 : Math.min(goal, (i / yA) * goal));
            dB.push(yB > 90 ? 0 : Math.min(goal, (i / yB) * goal));
        }
        myChart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: labels,
                datasets: [
                    { label: 'ç¾ç‹€ç´¯ç©', data: dA, borderColor: '#ccc', borderWidth: 2, pointRadius: 0, tension: 0.3 },
                    { label: 'å®‰éº—åŠ é€Ÿ', data: dB, borderColor: '#ff6b6b', backgroundColor: 'rgba(255,107,107,0.1)', borderWidth: 4, fill: true, pointRadius: 0, tension: 0.3 }
                ]
            },
            options: {
                responsive: true, maintainAspectRatio: false,
                plugins: { legend: { position: 'bottom' } },
                scales: { x: { grid: { display: false } }, y: { display: false } }
            }
        });
    }

    function saveData() {
        const data = {};
        document.querySelectorAll('input, select').forEach(i => data[i.id] = i.value);
        localStorage.setItem('gavinWealthV2', JSON.stringify(data));
        alert('âœ… è²¡å‹™æ•¸æ“šå·²å„²å­˜ï¼');
    }

    function loadData() {
        const saved = localStorage.getItem('gavinWealthV2');
        if (saved) {
            const data = JSON.parse(saved);
            for (const key in data) { if(document.getElementById(key)) document.getElementById(key).value = data[key]; }
        }
    }
</script>

</body>
</html>
