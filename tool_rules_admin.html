<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>å…¨å·¥å…·ä¸­æ§å°</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    :root{
      --bd: rgba(15,23,42,.10);
      --glass: rgba(255,255,255,.82);
      --glass2: rgba(255,255,255,.70);
      --shadow: 0 18px 55px rgba(15,23,42,.10);
      --shadow2: 0 10px 26px rgba(15,23,42,.06);
    }
    body{
      background:
        radial-gradient(1200px 600px at 10% 0%, rgba(59,130,246,.18), transparent 55%),
        radial-gradient(950px 520px at 90% 12%, rgba(16,185,129,.16), transparent 55%),
        radial-gradient(1000px 650px at 50% 110%, rgba(245,158,11,.14), transparent 60%),
        #f8fafc;
    }
    .glass{ background:var(--glass); border:1px solid var(--bd); backdrop-filter: blur(12px); box-shadow: var(--shadow); }
    .glass2{ background:var(--glass2); border:1px solid var(--bd); backdrop-filter: blur(10px); box-shadow: var(--shadow2); }
    .btn{ border:1px solid var(--bd); background:#fff; }
    .btn:hover{ background:#f1f5f9; }
    .card{ background:rgba(255,255,255,.88); border:1px solid var(--bd); box-shadow: var(--shadow2); transition:.15s ease; }
    .card:hover{ transform: translateY(-2px); box-shadow: 0 16px 38px rgba(15,23,42,.10); background:rgba(255,255,255,.96); }
    .kbd{
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono","Courier New", monospace;
      border:1px solid var(--bd);
      background: rgba(255,255,255,.75);
      padding:.12rem .45rem;
      border-radius: .7rem;
      font-size: .82em;
    }
  </style>
</head>

<body class="min-h-screen">
  <div class="mx-auto max-w-6xl px-4 pt-5 pb-24">
    <!-- Header -->
    <div class="glass rounded-3xl px-5 py-4 flex items-center justify-between gap-3">
      <div class="flex items-center gap-3 min-w-0">
        <div class="h-12 w-12 rounded-2xl flex items-center justify-center shrink-0"
             style="background: linear-gradient(135deg, rgba(59,130,246,.20), rgba(16,185,129,.18)); border:1px solid var(--bd);">
          <span class="text-2xl">ğŸ§°</span>
        </div>
        <div class="min-w-0">
          <div class="text-lg font-extrabold truncate text-slate-900">å…¨å·¥å…·ä¸­æ§å°</div>
          <div class="text-sm truncate text-slate-600">
            çµ±ä¸€çª—å£ï¼š<span class="kbd" id="gwBadge">â€”</span>
          </div>
        </div>
      </div>

      <div class="flex items-center gap-2 shrink-0">
        <button class="btn text-sm px-4 py-2 rounded-2xl" onclick="UI.openHelp()">æ•™å­¸</button>
      </div>
    </div>

    <!-- Gateway -->
    <div class="mt-4 glass2 rounded-3xl p-5">
      <div class="text-base font-bold text-slate-900">Gatewayï¼ˆçµ±ä¸€å…¥å£ï¼‰</div>
      <div class="mt-1 text-sm text-slate-600">
        å·¥å…·å¯ä»¥åœ¨ä»»ä½•ä½ç½®ã€‚å¡«ã€Œå®Œæ•´ç¶²å€ã€æˆ–ã€Œç›¸å°è·¯å¾‘ã€éƒ½å¯ï¼›ç›¸å°è·¯å¾‘æœƒç”¨ Gateway çµ„æˆå®Œæ•´ç¶²å€ã€‚
      </div>

      <div class="mt-4 flex flex-col md:flex-row gap-2">
        <input id="gwInput" class="w-full rounded-2xl px-4 py-3 border bg-white/80"
               style="border-color:var(--bd)" placeholder="ä¾‹å¦‚ï¼šhttps://api.zxcv8096.workers.dev" />
        <button class="btn px-4 py-3 rounded-2xl text-sm font-semibold whitespace-nowrap" onclick="UI.saveGW()">å„²å­˜</button>
        <button class="btn px-4 py-3 rounded-2xl text-sm whitespace-nowrap" onclick="UI.resetGW()">é‡ç½®</button>
      </div>

      <div class="mt-2 text-xs text-slate-500">
        æœƒå­˜åˆ° <span class="kbd">localStorage.GW_BASE</span>ï¼Œé»å·¥å…·æœƒè‡ªå‹•å¸¶ <span class="kbd">?gw=</span>
      </div>
    </div>

    <!-- Tools header -->
    <div class="mt-5 flex flex-col md:flex-row md:items-center md:justify-between gap-3">
      <div>
        <div class="text-base font-bold text-slate-900">å·¥å…·åˆ—è¡¨</div>
        <div class="text-sm text-slate-600">åªä¿ç•™å¿…è¦åŠŸèƒ½ï¼šæ–°å¢ / ç·¨è¼¯ / åˆªé™¤ / æœå°‹ / é–‹å•Ÿ</div>
      </div>

      <div class="flex items-center gap-2">
        <input id="q" class="w-64 max-w-[60vw] rounded-2xl px-4 py-3 border bg-white/80"
               style="border-color:var(--bd)" placeholder="æœå°‹â€¦" oninput="UI.render()" />
        <button class="btn px-4 py-3 rounded-2xl text-sm" onclick="UI.clearSearch()">æ¸…é™¤</button>
        <button class="btn px-4 py-3 rounded-2xl text-sm font-semibold" onclick="UI.openEditor(null)">ï¼‹æ–°å¢</button>
      </div>
    </div>

    <!-- Grid -->
    <div id="grid" class="mt-4 grid sm:grid-cols-2 lg:grid-cols-3 gap-4"></div>

    <!-- Empty -->
    <div id="empty" class="hidden mt-6 glass2 rounded-3xl p-6 text-center">
      <div class="text-lg font-bold text-slate-900">ç›®å‰æ²’æœ‰å·¥å…·</div>
      <div class="mt-2 text-sm text-slate-600">é»ã€Œæ–°å¢ã€æŠŠå·¥å…·ç¶²å€åŠ é€²ä¾†</div>
    </div>
  </div>

  <!-- Help Modal (simple) -->
  <div id="help" class="hidden fixed inset-0 z-50" onclick="if(event.target===this)UI.closeHelp()">
    <div class="absolute inset-0 bg-black/40"></div>
    <div class="relative mx-auto max-w-xl px-4 py-10">
      <div class="glass rounded-3xl p-6">
        <div class="flex items-start justify-between gap-3">
          <div>
            <div class="text-lg font-extrabold text-slate-900">æ•™å­¸</div>
            <div class="mt-1 text-sm text-slate-600">
              é€™é æ˜¯ã€Œå…¨å·¥å…·å…¥å£ã€ã€‚ä½ åªè¦ç®¡ç† Gateway + å·¥å…·ç¶²å€ã€‚
            </div>
          </div>
          <button class="btn text-sm px-4 py-2 rounded-2xl" onclick="UI.closeHelp()">é—œé–‰</button>
        </div>

        <div class="mt-4 text-sm text-slate-700 space-y-2">
          <div class="glass2 rounded-2xl p-4">
            <div class="font-bold">â‘  è¨­å®š Gateway</div>
            <div class="mt-1 text-slate-600">å¡«ä½ çš„ Worker ç¶²åŸŸä¸¦å„²å­˜ï¼Œæ‰€æœ‰å·¥å…·å…±ç”¨ã€‚</div>
          </div>
          <div class="glass2 rounded-2xl p-4">
            <div class="font-bold">â‘¡ å·¥å…·å¯æ”¾ä»»ä½•ä½ç½®</div>
            <div class="mt-1 text-slate-600">
              å·¥å…·ç¶²å€å¯å¡«ï¼šå®Œæ•´ç¶²å€ï¼ˆhttps://â€¦ï¼‰æˆ–ç›¸å°è·¯å¾‘ï¼ˆ/path æˆ– pages/â€¦ï¼‰ã€‚ç›¸å°è·¯å¾‘æœƒç”¨ Gateway çµ„åˆã€‚
            </div>
          </div>
          <div class="glass2 rounded-2xl p-4">
            <div class="font-bold">â‘¢ å·¥å…·å¦‚ä½•æ‹¿åˆ° Gateway</div>
            <div class="mt-1 text-slate-600">é»å·¥å…·æœƒè‡ªå‹•å¸¶ ?gw=ï¼›ä¹Ÿå¯è®€ localStorage.GW_BASEã€‚</div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Editor Modal -->
  <div id="editor" class="hidden fixed inset-0 z-50" onclick="if(event.target===this)UI.closeEditor()">
    <div class="absolute inset-0 bg-black/40"></div>
    <div class="relative mx-auto max-w-2xl px-4 py-8">
      <div class="glass rounded-3xl overflow-hidden">
        <div class="px-5 py-4 border-b" style="border-color:var(--bd);">
          <div class="flex items-start justify-between gap-3">
            <div>
              <div class="text-lg font-extrabold text-slate-900" id="edTitle">æ–°å¢å·¥å…·</div>
              <div class="text-sm text-slate-600">åªå¡«å¿…è¦ï¼šåç¨± + ç¶²å€ï¼ˆå…¶ä»–å¯ç©ºï¼‰</div>
            </div>
            <button class="btn text-sm px-4 py-2 rounded-2xl" onclick="UI.closeEditor()">é—œé–‰</button>
          </div>
        </div>

        <div class="px-5 py-5 space-y-3">
          <div class="grid md:grid-cols-2 gap-3">
            <div class="glass2 rounded-2xl p-4">
              <div class="text-sm font-semibold text-slate-900">åç¨±ï¼ˆä¸­æ–‡ï¼‰</div>
              <input id="edName" class="mt-2 w-full rounded-2xl px-4 py-3 border bg-white/80"
                     style="border-color:var(--bd)" placeholder="ä¾‹å¦‚ï¼šè‡ªå‹•å›è¦†" />
            </div>
            <div class="glass2 rounded-2xl p-4">
              <div class="text-sm font-semibold text-slate-900">åœ–ç¤ºï¼ˆå¯ç©ºï¼‰</div>
              <input id="edIcon" class="mt-2 w-full rounded-2xl px-4 py-3 border bg-white/80"
                     style="border-color:var(--bd)" placeholder="ä¾‹å¦‚ï¼šğŸ¤–" />
            </div>
          </div>

          <div class="glass2 rounded-2xl p-4">
            <div class="text-sm font-semibold text-slate-900">å·¥å…·ç¶²å€ / è·¯å¾‘</div>
            <div class="mt-1 text-xs text-slate-600">
              æ”¯æ´ï¼šhttps://å®Œæ•´ç¶²å€ã€€æˆ– /pathã€€æˆ– pages/xxx.html
            </div>
            <input id="edUrl" class="mt-2 w-full rounded-2xl px-4 py-3 border bg-white/80"
                   style="border-color:var(--bd)" placeholder="ä¾‹å¦‚ï¼š/pages/tools/auto_reply.html" oninput="UI.updatePreview()" />
            <div class="mt-2 text-xs text-slate-600">
              é è¦½ï¼š<span class="font-mono break-all" id="edPreview">â€”</span>
            </div>
          </div>

          <div class="glass2 rounded-2xl p-4">
            <div class="text-sm font-semibold text-slate-900">èªªæ˜ï¼ˆå¯ç©ºï¼‰</div>
            <input id="edDesc" class="mt-2 w-full rounded-2xl px-4 py-3 border bg-white/80"
                   style="border-color:var(--bd)" placeholder="ä¾‹å¦‚ï¼šé—œéµå­— â†’ è¦å‰‡åº«å›è¦†" />
          </div>
        </div>

        <div class="px-5 py-4 border-t flex items-center justify-between gap-3" style="border-color:var(--bd);">
          <button class="btn px-4 py-2 rounded-2xl text-sm" id="edDelete" onclick="UI.deleteTool()">åˆªé™¤</button>
          <div class="flex items-center gap-2">
            <button class="btn px-4 py-2 rounded-2xl text-sm" onclick="UI.closeEditor()">å–æ¶ˆ</button>
            <button class="btn px-4 py-2 rounded-2xl text-sm font-semibold" onclick="UI.saveTool()">å„²å­˜</button>
          </div>
        </div>
      </div>
    </div>
  </div>

<script>
/* æ¥µç°¡ç©©å®šï¼šåªåš Gateway + å·¥å…·æ¸…å–®ã€‚æ‰€æœ‰æŒ‰éˆ•ç”¨ onclickï¼Œä¿è­‰æœƒå‹• */
const UI = (() => {
  const K_GW = "GW_BASE";
  const K_TOOLS = "TOOLS_LIST_MIN_V1";
  const DEFAULT_GW = "https://api.zxcv8096.workers.dev";

  let GW = normalizeGW(localStorage.getItem(K_GW)) || DEFAULT_GW;
  localStorage.setItem(K_GW, GW);

  let TOOLS = loadTools();
  let editingId = null;

  // ----- helpers -----
  const $ = (id)=>document.getElementById(id);
  const esc = (s)=>String(s||"").replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;").replaceAll("'","&#39;");

  function uid(){ return "t_" + Math.random().toString(36).slice(2,10) + "_" + Date.now().toString(36); }
  function normalizeGW(v){
    const s = String(v||"").trim();
    if(!s) return "";
    if(!/^https?:\/\//i.test(s)) return ("https://" + s.replace(/^\/+/,"")).replace(/\/+$/,"");
    return s.replace(/\/+$/,"");
  }
  function resolveToolUrl(input){
    const u = String(input||"").trim();
    if(!u) return "";
    if(/^https?:\/\//i.test(u)) return u;
    if(/^\/\//.test(u)) return "https:" + u;

    const base = GW.replace(/\/+$/,"");
    if(u.startsWith("/")) return base + u;
    return base + "/" + u.replace(/^\/+/,"");
  }
  function withGw(url){
    if(!url) return "";
    if(/[\?&]gw=/.test(url)) return url;
    const gw = encodeURIComponent(GW);
    return url + (url.includes("?") ? "&" : "?") + "gw=" + gw;
  }

  function loadTools(){
    try{
      const raw = localStorage.getItem(K_TOOLS);
      if(raw){
        const arr = JSON.parse(raw);
        if(Array.isArray(arr)) return arr;
      }
    }catch{}
    const seed = [
      { id: uid(), name:"å¿«é€Ÿå›è¦†", icon:"âš¡", url:"/pages/tools/quickreply.html", desc:"å»ºç«‹ / ç®¡ç† Quick Reply" },
      { id: uid(), name:"è‡ªå‹•å›è¦†", icon:"ğŸ¤–", url:"/pages/tools/auto_reply.html", desc:"é—œéµå­— â†’ è¦å‰‡åº«å›è¦†" },
    ];
    localStorage.setItem(K_TOOLS, JSON.stringify(seed));
    return seed;
  }
  function saveTools(){
    localStorage.setItem(K_TOOLS, JSON.stringify(TOOLS));
  }
  function findById(id){ return TOOLS.find(t=>t.id===id); }

  // ----- UI sync -----
  function sync(){
    $("gwBadge").textContent = GW;
    $("gwInput").value = GW;
    render();
  }

  // ----- render -----
  function render(){
    const query = ($("q").value||"").toLowerCase().trim();
    const list = TOOLS.filter(t=>{
      if(!query) return true;
      const hay = [t.name,t.desc,t.url].join(" ").toLowerCase();
      return hay.includes(query);
    });

    $("empty").classList.toggle("hidden", list.length!==0);

    $("grid").innerHTML = list.map(t=>{
      const target = withGw(resolveToolUrl(t.url));
      return `
        <div class="card rounded-3xl p-5 min-w-0">
          <div class="flex items-start justify-between gap-3">
            <div class="flex items-start gap-3 min-w-0">
              <div class="h-12 w-12 rounded-2xl flex items-center justify-center shrink-0"
                   style="background:linear-gradient(135deg, rgba(59,130,246,.14), rgba(16,185,129,.12)); border:1px solid rgba(15,23,42,.10);">
                <span class="text-2xl">${esc(t.icon||"ğŸ§©")}</span>
              </div>
              <div class="min-w-0">
                <div class="text-lg font-extrabold text-slate-900 truncate">${esc(t.name||"æœªå‘½å")}</div>
                <div class="text-sm text-slate-600 line-clamp-2 mt-1">${esc(t.desc||"â€”")}</div>
                <div class="mt-3 text-xs text-slate-500">
                  <span class="font-mono break-all">${esc(target)}</span>
                </div>
              </div>
            </div>

            <div class="flex flex-col gap-2 shrink-0">
              <button class="btn text-xs px-3 py-2 rounded-2xl" onclick="UI.openTool('${esc(t.id)}')">é–‹å•Ÿ</button>
              <button class="btn text-xs px-3 py-2 rounded-2xl" onclick="UI.openEditor('${esc(t.id)}')">ç·¨è¼¯</button>
            </div>
          </div>
        </div>
      `;
    }).join("");
  }

  // ----- actions -----
  function saveGW(){
    const v = normalizeGW($("gwInput").value);
    if(!v) return alert("Gateway ä¸èƒ½ç©ºç™½");
    GW = v;
    localStorage.setItem(K_GW, GW);
    sync();
  }
  function resetGW(){
    GW = DEFAULT_GW;
    localStorage.setItem(K_GW, GW);
    sync();
  }
  function clearSearch(){
    $("q").value = "";
    render();
  }

  function openHelp(){ $("help").classList.remove("hidden"); }
  function closeHelp(){ $("help").classList.add("hidden"); }

  function openTool(id){
    localStorage.setItem(K_GW, GW);
    const t = findById(id);
    if(!t) return;
    const dest = withGw(resolveToolUrl(t.url));
    location.href = dest;
  }

  function openEditor(idOrNull){
    editingId = idOrNull || null;
    const t = editingId ? findById(editingId) : null;

    $("edTitle").textContent = t ? "ç·¨è¼¯å·¥å…·" : "æ–°å¢å·¥å…·";
    $("edDelete").style.display = t ? "" : "none";

    $("edName").value = t?.name || "";
    $("edIcon").value = t?.icon || "";
    $("edUrl").value  = t?.url  || "";
    $("edDesc").value = t?.desc || "";

    updatePreview();
    $("editor").classList.remove("hidden");
    setTimeout(()=>$("edName").focus(), 0);
  }
  function closeEditor(){
    $("editor").classList.add("hidden");
    editingId = null;
  }
  function updatePreview(){
    const u = $("edUrl").value.trim();
    const resolved = resolveToolUrl(u);
    $("edPreview").textContent = resolved ? withGw(resolved) : "â€”";
  }

  function saveTool(){
    const name = $("edName").value.trim() || "æœªå‘½åå·¥å…·";
    const url  = $("edUrl").value.trim();
    if(!url) return alert("å·¥å…·ç¶²å€/è·¯å¾‘ä¸èƒ½ç©ºç™½");

    const obj = {
      id: editingId || uid(),
      name,
      icon: $("edIcon").value.trim() || "ğŸ§©",
      url,
      desc: $("edDesc").value.trim()
    };

    if(editingId){
      TOOLS = TOOLS.map(t=>t.id===editingId ? obj : t);
    }else{
      TOOLS = [obj, ...TOOLS];
    }

    saveTools();
    sync();
    closeEditor();
  }

  function deleteTool(){
    if(!editingId) return;
    if(!confirm("ç¢ºå®šåˆªé™¤ï¼Ÿ")) return;
    TOOLS = TOOLS.filter(t=>t.id!==editingId);
    saveTools();
    sync();
    closeEditor();
  }

  // init
  function init(){ sync(); }

  return {
    init, render,
    saveGW, resetGW,
    clearSearch,
    openHelp, closeHelp,
    openTool,
    openEditor, closeEditor,
    updatePreview,
    saveTool, deleteTool
  };
})();
UI.init();
</script>
</body>
</html>
