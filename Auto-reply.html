<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GAVIN AI COMMANDER V3.0 ğŸ’</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;600;900&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        diamond: { 100: '#e0f2fe', 500: '#0ea5e9', 900: '#0c4a6e' },
                        gold: { 400: '#fbbf24', 500: '#f59e0b', 600: '#d97706' },
                        dark: { 800: '#1e293b', 900: '#0f172a' }
                    },
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                        mono: ['JetBrains Mono', 'monospace'],
                    }
                }
            }
        }
    </script>
    <style>
        body { background-color: #0f172a; background-image: radial-gradient(circle at 50% 0%, #1e3a8a 0%, #0f172a 70%); min-height: 100vh; }
        .glass-panel { background: rgba(30, 41, 59, 0.7); backdrop-filter: blur(12px); border: 1px solid rgba(255,255,255,0.1); }
        .input-dark { @apply w-full bg-slate-800/50 border border-slate-700 rounded-lg px-4 py-3 text-sm text-white focus:ring-2 focus:ring-sky-500 outline-none transition; }
        .btn-gold { @apply bg-gradient-to-r from-yellow-500 to-amber-600 text-white font-bold py-3 px-6 rounded-lg shadow-lg shadow-amber-500/20 hover:scale-[1.02] transition active:scale-95; }
        .code-block { background: #0d1117; color: #c9d1d9; font-family: 'JetBrains Mono', monospace; }
        
        /* æ»¾å‹•æ¢ç¾åŒ– */
        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: #1e293b; }
        ::-webkit-scrollbar-thumb { background: #475569; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #64748b; }
    </style>
</head>
<body class="text-slate-200" onload="initData()">

    <nav class="border-b border-slate-800 bg-slate-900/80 backdrop-blur sticky top-0 z-50">
        <div class="container mx-auto px-6 py-4 flex justify-between items-center">
            <div class="flex items-center gap-3">
                <div class="w-10 h-10 bg-gradient-to-br from-sky-400 to-indigo-600 rounded-xl flex items-center justify-center text-white shadow-lg shadow-sky-500/20">
                    <i class="fa-solid fa-lion"></i>
                </div>
                <div>
                    <h1 class="font-black text-xl tracking-tight text-white">GAVIN FLOW <span class="text-sky-400">V3.0</span></h1>
                    <p class="text-[10px] text-slate-400 font-mono tracking-widest uppercase">Diamond Strategy System</p>
                </div>
            </div>
            <div class="hidden md:flex items-center gap-6 text-xs font-bold">
                <div class="flex items-center gap-2 text-yellow-500">
                    <i class="fa-solid fa-trophy"></i>
                    <span>2027 é‘½çŸ³ç›®æ¨™</span>
                </div>
                <div class="px-3 py-1 bg-slate-800 rounded-full border border-slate-700">
                    <span class="text-green-400">â— ç³»çµ±å°±ç·’</span>
                </div>
            </div>
        </div>
    </nav>

    <div class="container mx-auto p-4 md:p-8 max-w-7xl grid lg:grid-cols-12 gap-8">
        
        <div class="lg:col-span-4 space-y-6">
            
            <div class="glass-panel rounded-2xl p-6 relative overflow-hidden group">
                <div class="absolute top-0 right-0 p-3 opacity-10 group-hover:opacity-20 transition">
                    <i class="fa-solid fa-file-excel text-6xl text-green-500"></i>
                </div>
                <h3 class="text-green-400 font-bold mb-4 flex items-center gap-2">
                    <i class="fa-brands fa-google-drive"></i> è©¦ç®—è¡¨ç¶å®šæ•™å­¸
                </h3>
                <ol class="text-xs space-y-3 text-slate-300 list-decimal pl-4 leading-relaxed">
                    <li>å»ºç«‹ä¸€å€‹æ–°çš„ <b class="text-white">Google Sheet</b>ã€‚</li>
                    <li>ä¸Šæ–¹é¸å–®é»æ“Š <b class="text-white">æ“´å……åŠŸèƒ½ (Extensions)</b> > <b class="text-white">Apps Script</b>ã€‚</li>
                    <li>å°‡å³å´ç”Ÿæˆçš„ä»£ç¢¼ <b class="text-white">å…¨é¸è²¼ä¸Š</b> ä¸¦è¦†è“‹åŸæœ‰å…§å®¹ã€‚</li>
                    <li>ç¬¬ä¸€è¡Œä»£ç¢¼æœƒè‡ªå‹•æŠ“å–ç•¶å‰è©¦ç®—è¡¨ï¼Œ<b class="text-yellow-400">æ‰€æœ‰ AI å›è¦†ç´€éŒ„éƒ½æœƒå­˜å…¥ Sheet1</b>ã€‚</li>
                </ol>
            </div>

            <div class="glass-panel rounded-2xl p-6">
                <h3 class="text-sky-400 font-bold mb-4 flex items-center gap-2">
                    <i class="fa-solid fa-sliders"></i> å…¨å±€åƒæ•¸è¨­å®š
                </h3>
                
                <div class="space-y-4">
                    <div>
                        <label class="text-[10px] text-slate-400 uppercase font-bold tracking-wider">OpenAI / Gemini API Key (AI åŠŸèƒ½å¿…å¡«)</label>
                        <input id="apiKey" type="password" placeholder="sk-..." class="input-dark mt-1 border-l-4 border-l-purple-500">
                    </div>

                    <div>
                        <label class="text-[10px] text-slate-400 uppercase font-bold tracking-wider">Meta Page Access Token</label>
                        <input id="accessToken" type="password" placeholder="EAA..." class="input-dark mt-1">
                    </div>
                    
                    <div>
                        <label class="text-[10px] text-slate-400 uppercase font-bold tracking-wider">Webhook Verify Token</label>
                        <div class="flex gap-2 mt-1">
                            <input id="verifyToken" type="text" value="GAVIN_DIAMOND_2027" class="input-dark">
                            <button onclick="saveConfig()" class="bg-slate-700 hover:bg-slate-600 text-white px-3 rounded-lg text-xs"><i class="fa-solid fa-save"></i></button>
                        </div>
                    </div>
                </div>
            </div>

            <div class="bg-gradient-to-br from-purple-900/50 to-slate-900 rounded-2xl p-6 border border-purple-500/30">
                <h3 class="text-purple-400 font-bold mb-2 text-sm"><i class="fa-solid fa-robot"></i> ç…å­åº§æ•™ç·´ AI äººè¨­</h3>
                <p class="text-[10px] text-slate-400 mb-3">ç•¶å•Ÿç”¨ AI æ¨¡å¼æ™‚ï¼Œç³»çµ±å°‡ä½¿ç”¨æ­¤äººè¨­é€²è¡Œå›è¦†ã€‚</p>
                <textarea id="systemPrompt" rows="4" class="input-dark text-xs leading-relaxed" placeholder="ä½ æ˜¯ä¸€ä½å°ˆæ¥­ã€æº«æš–ä¸”æ¿€å‹µäººå¿ƒçš„å¥åº·æ•™ç·´ï¼Œåå« Gavinã€‚è«‹ç”¨ç¹é«”ä¸­æ–‡å›è¦†ï¼Œèªæ°£æ­£å‘ï¼Œçµå°¾å¸¶æœ‰è¡Œå‹•å‘¼ç±²...">ä½ æ˜¯ä¸€ä½å°ˆæ¥­ã€æœ‰åŒç†å¿ƒçš„å¥åº·äº‹æ¥­æ•™ç·´ Gavinã€‚è«‹ç”¨ç¹é«”ä¸­æ–‡å›è¦†ç”¨æˆ¶çš„ç•™è¨€ã€‚
èªæ°£ï¼šè‡ªä¿¡ã€åƒç…å­ä¸€æ¨£æº«æš–æœ‰åŠ›ã€å°ˆæ¥­ä½†ä¸é«˜å†·ã€‚
ç›®æ¨™ï¼šå¼•å°ç”¨æˆ¶å°å¥åº·æˆ–äº‹æ¥­æ„Ÿèˆˆè¶£ï¼Œä¸¦é¼“å‹µä»–å€‘é»æ“Šé€£çµæˆ–ç§è¨Šã€‚
é™åˆ¶ï¼šå›è¦†ä¸è¶…é 100 å­—ã€‚</textarea>
            </div>
        </div>

        <div class="lg:col-span-8 space-y-6">
            
            <div class="glass-panel rounded-2xl p-8 border-t-4 border-t-yellow-500 shadow-2xl">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-black text-white">æ–°å¢æˆ°ç•¥è¦å‰‡</h2>
                    <div class="flex items-center gap-2">
                        <span class="text-xs font-bold text-slate-400">å•Ÿç”¨ AI æ™ºèƒ½å›è¦†</span>
                        <label class="relative inline-flex items-center cursor-pointer">
                            <input type="checkbox" id="useAI" class="sr-only peer" onchange="toggleAIMode()">
                            <div class="w-11 h-6 bg-slate-700 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-purple-600"></div>
                        </label>
                    </div>
                </div>

                <div class="grid md:grid-cols-2 gap-6 mb-6">
                    <div class="space-y-4">
                        <div>
                            <label class="text-xs text-slate-400 font-bold">ğŸ¯ æŒ‡å®šæ–‡ç«  ID (å¯é¸ï¼Œç•™ç©ºå‰‡å…¨åŸŸè§¸ç™¼)</label>
                            <input id="postId" type="text" placeholder="ä¾‹å¦‚ï¼š1234567890_987654321" class="input-dark mt-1">
                        </div>
                        <div>
                            <label class="text-xs text-slate-400 font-bold">ğŸ”‘ è§¸ç™¼é—œéµå­—</label>
                            <input id="keyword" type="text" placeholder="ä¾‹å¦‚ï¼šæƒ³äº†è§£, +1" class="input-dark mt-1">
                        </div>
                        <div>
                            <label class="text-xs text-slate-400 font-bold">ğŸ“‚ åå–®åˆ†é¡</label>
                            <select id="category" class="input-dark mt-1">
                                <option value="Biz">ğŸ’ äº‹æ¥­åˆä½œ</option>
                                <option value="Product">ğŸ’‰ ç”¢å“è«®è©¢</option>
                                <option value="Other">ğŸ‘‹ ä¸€èˆ¬äº’å‹•</option>
                            </select>
                        </div>
                    </div>

                    <div class="relative">
                        <label id="replyLabel" class="text-xs text-slate-400 font-bold">ğŸ’¬ å›ºå®šå›è¦†å…§å®¹</label>
                        <textarea id="replyText" rows="6" class="input-dark mt-1" placeholder="å¡«å¯«å›ºå®šçš„å›è¦†æ–‡æ¡ˆ..."></textarea>
                        
                        <div id="aiOverlay" class="hidden absolute inset-0 bg-slate-900/90 backdrop-blur-sm rounded-lg flex flex-col items-center justify-center border border-purple-500/50 mt-6">
                            <i class="fa-solid fa-wand-magic-sparkles text-3xl text-purple-400 mb-2 animate-pulse"></i>
                            <p class="text-sm font-bold text-white">AI æ™ºèƒ½æ¨¡å¼å·²å•Ÿç”¨</p>
                            <p class="text-[10px] text-slate-400 mt-1">ç³»çµ±å°‡æ ¹æ“šå·¦å´ã€ŒAI äººè¨­ã€è‡ªå‹•ç”Ÿæˆå›è¦†</p>
                        </div>
                    </div>
                </div>

                <button onclick="addRule()" class="btn-gold w-full text-lg shadow-amber-500/20">
                    <i class="fa-solid fa-plus-circle mr-2"></i> åŠ å…¥æˆ°ç•¥éšŠåˆ—
                </button>
            </div>

            <div class="glass-panel rounded-2xl p-6 min-h-[150px]">
                <h3 class="text-slate-400 text-xs font-bold uppercase mb-4">ç›®å‰ç”Ÿæ•ˆè¦å‰‡</h3>
                <div id="rulesList" class="space-y-3">
                    <div class="text-center text-slate-600 py-4 text-xs">å°šç„¡è¦å‰‡ï¼Œè«‹ä¸Šæ–¹æ–°å¢ ğŸ‘†</div>
                </div>
            </div>

            <div class="bg-[#0d1117] rounded-2xl border border-slate-700 overflow-hidden relative">
                <div class="flex justify-between items-center bg-slate-800 px-4 py-2 border-b border-slate-700">
                    <span class="text-xs font-mono text-sky-400">Code.gs</span>
                    <button onclick="copyCode()" class="text-xs bg-sky-600 hover:bg-sky-500 text-white px-3 py-1 rounded transition">
                        <i class="fa-regular fa-copy"></i> è¤‡è£½ä»£ç¢¼
                    </button>
                </div>
                <pre id="outputCode" class="p-4 text-[10px] md:text-xs overflow-x-auto h-[300px] code-block leading-loose"></pre>
            </div>

        </div>
    </div>

    <script>
        let rules = [];
        let config = {
            apiKey: '',
            accessToken: '',
            verifyToken: 'GAVIN_DIAMOND_2027',
            systemPrompt: ''
        };

        function initData() {
            // å˜—è©¦è®€å– LocalStorage
            const saved = localStorage.getItem('gavin_v3_data');
            if (saved) {
                const data = JSON.parse(saved);
                rules = data.rules || [];
                config = data.config || config;
                
                // é‚„åŸ UI
                document.getElementById('apiKey').value = config.apiKey;
                document.getElementById('accessToken').value = config.accessToken;
                document.getElementById('verifyToken').value = config.verifyToken;
                document.getElementById('systemPrompt').value = config.systemPrompt || document.getElementById('systemPrompt').value;
                renderRulesList();
            }
            renderCode();
        }

        function toggleAIMode() {
            const isAI = document.getElementById('useAI').checked;
            const overlay = document.getElementById('aiOverlay');
            const label = document.getElementById('replyLabel');
            
            if (isAI) {
                overlay.classList.remove('hidden');
                label.innerText = "ğŸ¤– AI å°‡æ¥ç®¡å›è¦†";
            } else {
                overlay.classList.add('hidden');
                label.innerText = "ğŸ’¬ å›ºå®šå›è¦†å…§å®¹";
            }
        }

        function saveConfig() {
            config.apiKey = document.getElementById('apiKey').value;
            config.accessToken = document.getElementById('accessToken').value;
            config.verifyToken = document.getElementById('verifyToken').value;
            config.systemPrompt = document.getElementById('systemPrompt').value;
            saveToLocal();
            renderCode();
            alert('è¨­å®šå·²ä¿å­˜ï¼ä»£ç¢¼å·²æ›´æ–°ã€‚');
        }

        function addRule() {
            const isAI = document.getElementById('useAI').checked;
            
            const newRule = {
                id: Date.now(),
                postId: document.getElementById('postId').value.trim(),
                keyword: document.getElementById('keyword').value.trim(),
                category: document.getElementById('category').value,
                type: isAI ? 'AI' : 'STATIC',
                content: isAI ? 'AI Auto Gen' : document.getElementById('replyText').value
            };

            if (!newRule.keyword && !newRule.postId) {
                alert('è«‹è‡³å°‘å¡«å¯«ã€Œè§¸ç™¼é—œéµå­—ã€æˆ–ã€ŒæŒ‡å®šæ–‡ç«  IDã€ï¼');
                return;
            }

            rules.push(newRule);
            saveToLocal();
            renderRulesList();
            renderCode();
            
            // æ¸…ç©ºè¼¸å…¥
            document.getElementById('keyword').value = '';
            document.getElementById('replyText').value = '';
        }

        function removeRule(id) {
            rules = rules.filter(r => r.id !== id);
            saveToLocal();
            renderRulesList();
            renderCode();
        }

        function saveToLocal() {
            const data = { rules: rules, config: config };
            localStorage.setItem('gavin_v3_data', JSON.stringify(data));
        }

        function renderRulesList() {
            const container = document.getElementById('rulesList');
            if (rules.length === 0) {
                container.innerHTML = '<div class="text-center text-slate-600 py-4 text-xs">å°šç„¡è¦å‰‡ï¼Œè«‹ä¸Šæ–¹æ–°å¢ ğŸ‘†</div>';
                return;
            }

            container.innerHTML = rules.map(rule => `
                <div class="bg-slate-800/50 border border-slate-700 rounded-lg p-3 flex justify-between items-center group hover:border-sky-500 transition">
                    <div class="flex items-center gap-3">
                        <div class="w-8 h-8 rounded-full flex items-center justify-center ${rule.type === 'AI' ? 'bg-purple-900 text-purple-400' : 'bg-sky-900 text-sky-400'}">
                            <i class="fa-solid ${rule.type === 'AI' ? 'fa-robot' : 'fa-comment-dots'} text-xs"></i>
                        </div>
                        <div>
                            <div class="flex gap-2 items-center mb-1">
                                <span class="text-[10px] px-2 py-0.5 rounded bg-slate-700 text-slate-300 font-mono">${rule.category}</span>
                                ${rule.postId ? `<span class="text-[10px] text-yellow-500"><i class="fa-solid fa-thumbtack"></i> æŒ‡å®šæ–‡ç« </span>` : ''}
                            </div>
                            <p class="text-xs text-white font-bold">é—œéµå­—: ${rule.keyword || '(ç„¡/å…¨æ–‡ç« )'}</p>
                            <p class="text-[10px] text-slate-400 truncate max-w-[200px]">${rule.type === 'AI' ? 'âš¡ AI æ™ºèƒ½ç”Ÿæˆä¸­...' : rule.content}</p>
                        </div>
                    </div>
                    <button onclick="removeRule(${rule.id})" class="text-slate-600 hover:text-red-400 px-2 transition"><i class="fa-solid fa-trash"></i></button>
                </div>
            `).join('');
        }

        function renderCode() {
            const sysPromptSafe = config.systemPrompt.replace(/\n/g, "\\n").replace(/"/g, '\\"');
            
            const code = `/**
 * GAVIN AI COMMANDER V3.0 - é‘½çŸ³æˆ°ç•¥ä¸­æ§å°
 * * ä½¿ç”¨èªªæ˜ï¼š
 * 1. åœ¨ Google Sheet ä¸­é»æ“Š [æ“´å……åŠŸèƒ½] > [Apps Script]
 * 2. è²¼ä¸Šæ­¤ä»£ç¢¼ï¼Œä¸¦æŒ‰ [éƒ¨ç½²] > [æ–°å¢éƒ¨ç½²] > [Web æ‡‰ç”¨ç¨‹å¼]
 * 3. æ¬Šé™è¨­å®šç‚º [ä»»ä½•äºº]
 * 4. å°‡ç”Ÿæˆçš„ç¶²å€å¡«å…¥ Meta App çš„ Webhook è¨­å®š
 */

// ========== é…ç½®å€ ==========
const VERIFY_TOKEN = "${config.verifyToken}";
const PAGE_ACCESS_TOKEN = "${config.accessToken}";
const OPENAI_API_KEY = "${config.apiKey}"; // è‹¥ç‚º Gemini å¯è‡ªè¡Œä¿®æ”¹ callAI å‡½æ•¸
const SYSTEM_PROMPT = "${sysPromptSafe}";

// è¦å‰‡è³‡æ–™åº«
const RULES = ${JSON.stringify(rules, null, 2)};

function doGet(e) {
  // Webhook é©—è­‰æ¡æ‰‹
  let mode = e.parameter['hub.mode'];
  let token = e.parameter['hub.verify_token'];
  let challenge = e.parameter['hub.challenge'];
  if (mode && token) {
    if (mode === 'subscribe' && token === VERIFY_TOKEN) {
      return ContentService.createTextOutput(challenge);
    }
  }
  return ContentService.createTextOutput('Gavin AI System Online ğŸ’');
}

function doPost(e) {
  try {
    let sheet = SpreadsheetApp.getActiveSpreadsheet().getSheets()[0]; // è‡ªå‹•æŠ“å–ç¬¬ä¸€å€‹å·¥ä½œè¡¨
    let data = JSON.parse(e.postData.contents);

    if (data.entry && data.entry[0].changes) {
      let change = data.entry[0].changes[0].value;
      
      // ç¢ºä¿æ˜¯ç•™è¨€ (Comment) ä¸”ä¸æ˜¯è‡ªå·±ç™¼çš„
      if (change.item === "comment" && change.verb === "add" && change.from.id !== change.post_id.split('_')[0]) {
        
        let message = change.message;
        let senderName = change.from.name;
        let commentId = change.comment_id;
        let postId = change.post_id;
        
        // éæ­·è¦å‰‡
        RULES.forEach(rule => {
          // 1. æª¢æŸ¥æ–‡ç«  ID æ˜¯å¦åŒ¹é… (è‹¥è¦å‰‡ç„¡ ID å‰‡ç•¥éæ­¤æª¢æŸ¥)
          if (rule.postId && !postId.includes(rule.postId)) return;
          
          // 2. æª¢æŸ¥é—œéµå­—
          if (rule.keyword && !message.includes(rule.keyword)) return;

          let replyContent = "";

          // 3. åŸ·è¡Œå›è¦†é‚è¼¯
          if (rule.type === 'AI') {
            replyContent = callAI(message, senderName);
          } else {
            replyContent = rule.content;
          }

          // 4. ç™¼é€å›è¦†
          if (replyContent) {
            sendFbReply(commentId, replyContent);
            
            // 5. å¯«å…¥ Log åˆ° Google Sheet (ç¾åŒ–ç´€éŒ„)
            sheet.appendRow([
              new Date(),           // æ™‚é–“
              rule.category,        // åˆ†é¡
              senderName,           // å®¢æˆ¶å§“å
              message,              // å®¢æˆ¶ç•™è¨€
              replyContent,         // ç³»çµ±å›è¦†
              rule.type,            // å›è¦†é¡å‹
              "å·²åŸ·è¡Œ"               // ç‹€æ…‹
            ]);
          }
        });
      }
    }
    return ContentService.createTextOutput('OK');
  } catch (err) {
    // éŒ¯èª¤ç´€éŒ„
    SpreadsheetApp.getActiveSpreadsheet().getSheets()[0].appendRow([new Date(), "ERROR", err.toString()]);
    return ContentService.createTextOutput('Error');
  }
}

// FB API å›è¦†å‡½æ•¸
function sendFbReply(commentId, message) {
  let url = "https://graph.facebook.com/v18.0/" + commentId + "/comments";
  let payload = {
    "message": message,
    "access_token": PAGE_ACCESS_TOKEN
  };
  
  UrlFetchApp.fetch(url, {
    "method": "post",
    "payload": payload
  });
}

// AI ç”Ÿæˆå‡½æ•¸ (é è¨­ä½¿ç”¨ OpenAI æ ¼å¼ï¼Œå¯ç›¸å®¹å¤§éƒ¨åˆ†æ¨¡å‹)
function callAI(userMessage, userName) {
  if (!OPENAI_API_KEY) return "AI Key æœªè¨­å®šï¼Œè«‹æª¢æŸ¥ç³»çµ±ã€‚";

  // ç°¡å–®çš„é˜²å‘†ï¼šå¦‚æœæ²’æœ‰ Key å°±ä¸è·‘
  let url = "https://api.openai.com/v1/chat/completions"; 
  
  let prompt = SYSTEM_PROMPT + "\\n\\nç”¨æˆ¶åç¨±: " + userName + "\\nç”¨æˆ¶ç•™è¨€: " + userMessage;

  let payload = {
    "model": "gpt-3.5-turbo", // æˆ– gpt-4
    "messages": [
      {"role": "system", "content": SYSTEM_PROMPT},
      {"role": "user", "content": userMessage}
    ],
    "temperature": 0.7
  };

  let options = {
    "method": "post",
    "contentType": "application/json",
    "headers": { "Authorization": "Bearer " + OPENAI_API_KEY },
    "payload": JSON.stringify(payload),
    "muteHttpExceptions": true
  };

  try {
    let response = UrlFetchApp.fetch(url, options);
    let json = JSON.parse(response.getContentText());
    if (json.choices && json.choices.length > 0) {
      return json.choices[0].message.content.trim();
    } else {
      return "AI æ€è€ƒå—é˜»ï¼Œè«‹ç¨å¾Œå†è©¦ã€‚";
    }
  } catch (e) {
    return "AI é€£ç·šéŒ¯èª¤: " + e.message;
  }
}`;
            document.getElementById('outputCode').innerText = code;
        }

        function copyCode() {
            const code = document.getElementById('outputCode').innerText;
            navigator.clipboard.writeText(code).then(() => alert('ä»£ç¢¼å·²è¤‡è£½ï¼é€šå¾€é‘½çŸ³ä¹‹è·¯çš„é‘°åŒ™åˆ°æ‰‹ ğŸ’'));
        }
    </script>
</body>
</html>
