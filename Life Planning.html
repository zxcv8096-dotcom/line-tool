<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>å¤§å¿ƒå¤¢æƒ³é”æˆå™¨ (Structure) ğŸ’</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --primary: #4361ee;
            --secondary: #3f37c9;
            --success: #06d6a0;
            --danger: #ef476f;
            --warning: #ffd166;
            --dark: #2b2d42;
            --light: #f8f9fa;
            --bg: #f0f2f5;
        }

        body { background-color: var(--bg); font-family: "Microsoft JhengHei", sans-serif; padding-bottom: 120px; color: var(--dark); }
        .card { border: none; border-radius: 16px; box-shadow: 0 4px 15px rgba(0,0,0,0.03); margin-bottom: 20px; background: white; overflow: hidden; }
        
        .navbar { background: white; box-shadow: 0 2px 10px rgba(0,0,0,0.05); }
        .navbar-brand { color: var(--primary) !important; font-weight: 900; letter-spacing: 1px; }

        /* å„€è¡¨æ¿ (Dashboard) */
        .summary-card { background: linear-gradient(135deg, #fff 0%, #f3f6ff 100%); border-top: 5px solid var(--primary); }
        .summary-title { font-size: 1.1rem; font-weight: 800; color: var(--primary); margin-bottom: 15px; display: flex; align-items: center; }
        
        /* æ•¸æ“šæ ¼ */
        .stat-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        .stat-box { background: white; padding: 12px; border-radius: 12px; text-align: center; border: 1px solid #eee; box-shadow: 0 2px 5px rgba(0,0,0,0.01); }
        .stat-label { font-size: 0.75rem; color: #888; font-weight: bold; display: block; margin-bottom: 2px; }
        .stat-val { font-size: 1.2rem; font-weight: 900; color: var(--dark); }
        .val-green { color: var(--success); } .val-red { color: var(--danger); } .val-blue { color: var(--primary); }

        /* å¤¢æƒ³è©•ä¼°æ¢ */
        .dream-status-bar { margin-top: 15px; padding: 10px; border-radius: 8px; background: #eee; text-align: center; font-weight: bold; font-size: 0.9rem; }
        .status-ok { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .status-fail { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }

        /* è¼¸å…¥å€æ¨™é¡Œ */
        .section-header { 
            font-size: 1rem; font-weight: 800; color: #555; margin-bottom: 12px; padding: 8px 12px; 
            border-radius: 8px; background: #f8f9fa; border-left: 5px solid #ccc;
        }
        .hdr-inc { border-left-color: var(--success); }
        .hdr-exp { border-left-color: var(--danger); }
        .hdr-asset { border-left-color: var(--primary); }
        .hdr-debt { border-left-color: var(--warning); }
        .hdr-dream { border-left-color: #9b59b6; color: #666; background: #f3e5f5; }

        /* è¼¸å…¥å…ƒä»¶ */
        .input-group-text { background: #fff; border-right: none; font-weight: 600; font-size: 0.9rem; color: #666; }
        .form-control, .form-select { border-left: none; font-weight: 600; font-size: 0.95rem; }
        .form-control:focus { box-shadow: none; border-color: #ced4da; }
        .unit-badge { background: #e9ecef; color: #666; font-size: 0.8rem; display: flex; align-items: center; padding: 0 8px; font-weight: bold; border: 1px solid #ced4da; border-left: none; }
        
        .wan-input { text-align: right; }
        
        /* åˆ—è¡¨ */
        .dynamic-row { background: white; padding: 10px; border-radius: 10px; margin-bottom: 8px; border: 1px solid #eee; position: relative; }
        .btn-remove { position: absolute; top: 5px; right: 5px; color: #ccc; background: none; border: none; font-size: 1.1rem; }
        
        /* è˜ä½å»ºè­° */
        .pin-box { margin-top: 15px; background: white; border: 2px solid var(--primary); border-radius: 12px; padding: 15px; display: flex; align-items: center; box-shadow: 0 5px 15px rgba(67, 97, 238, 0.15); }
        .pin-icon { font-size: 2.5rem; margin-right: 15px; }
        
        .nav-pills .nav-link.active { background-color: var(--primary); }
        .nav-pills .nav-link { color: var(--dark); font-weight: bold; }
    </style>
</head>
<body>

<nav class="navbar sticky-top">
    <div class="container-fluid d-flex justify-content-between align-items-center">
        <span class="navbar-brand"><i class="fas fa-paper-plane me-2"></i>å¤§å¿ƒå¤¢æƒ³é”æˆå™¨</span>
        <button class="btn btn-sm btn-dark rounded-pill fw-bold" onclick="saveData()"><i class="fas fa-save me-1"></i> å­˜æª”</button>
    </div>
</nav>

<div class="container mt-3">

    <div class="card summary-card">
        <div class="card-body">
            <div class="summary-title">
                <span><i class="fas fa-flag-checkered me-2"></i>å¤¢æƒ³å¯è¡Œæ€§è©•ä¼°</span>
            </div>
            
            <div class="stat-grid">
                <div class="stat-box">
                    <span class="stat-label">æ¯æœˆè‡ªç”±ç¾é‡‘æµ</span>
                    <span class="stat-val" id="res-cashflow">0 è¬</span>
                </div>
                <div class="stat-box">
                    <span class="stat-label">ç›®å‰æ·¨è³‡ç”¢</span>
                    <span class="stat-val val-blue" id="res-networth">0 è¬</span>
                </div>
                <div class="stat-box">
                    <span class="stat-label">æœ¬æ¥­é”æˆå¹´é½¡</span>
                    <span class="stat-val" style="color:#aaa;" id="res-age-job">--</span>
                </div>
                <div class="stat-box" style="border:1px solid var(--success); background:#f0fff4;">
                    <span class="stat-label text-success">åŠ å®‰éº—é”æˆ</span>
                    <span class="stat-val val-green" id="res-age-amway">--</span>
                </div>
            </div>

            <div id="dream-status" class="dream-status-bar status-fail">
                è«‹è¼¸å…¥è³‡æ–™ä»¥é–‹å§‹è©•ä¼°
            </div>

            <div id="pin-suggestion" class="pin-box" style="display:none;">
                <div class="pin-icon">ğŸ’</div>
                <div>
                    <h6 class="m-0 fw-bold text-primary">å»ºè­°ç›®æ¨™ï¼š<span id="pin-name"></span></h6>
                    <small class="text-muted" id="pin-gap">å¡«è£œç¼ºå£ï¼Œè®“å¤¢æƒ³æˆçœŸï¼</small>
                </div>
            </div>
        </div>
    </div>

    <div class="card">
        <div class="card-body">
            <div class="section-header hdr-dream">1. è¨­å®šæ‚¨çš„å¤¢æƒ³</div>
            <div class="input-group mb-3">
                <span class="input-group-text border-0">ç›®å‰å¹´é½¡</span>
                <input type="number" id="current-age" class="form-control" placeholder="30" oninput="calculate()">
                <span class="unit-badge">æ­²</span>
            </div>
            
            <div class="d-flex justify-content-between align-items-center mb-2">
                <small class="fw-bold text-muted">å¤¢æƒ³æ¸…å–® (å–®ä½:è¬)</small>
                <button class="btn btn-sm btn-outline-primary rounded-pill py-0" onclick="addDream()">+ æ–°å¢</button>
            </div>
            <div id="dream-list"></div>
        </div>
    </div>

    <div class="card">
        <div class="card-body p-2">
            <ul class="nav nav-pills mb-3 nav-fill" id="pills-tab">
                <li class="nav-item"><a class="nav-link active" data-bs-toggle="pill" href="#tab-income">ğŸ’° æ”¶å…¥</a></li>
                <li class="nav-item"><a class="nav-link" data-bs-toggle="pill" href="#tab-exp">ğŸ’¸ æ”¯å‡º</a></li>
                <li class="nav-item"><a class="nav-link" data-bs-toggle="pill" href="#tab-asset">ğŸ’ è³‡ç”¢</a></li>
                <li class="nav-item"><a class="nav-link" data-bs-toggle="pill" href="#tab-debt">ğŸ’³ è² å‚µ</a></li>
            </ul>

            <div class="tab-content p-2">
                
                <div class="tab-pane fade show active" id="tab-income">
                    <div class="section-header hdr-inc">ä¸»å‹•æ”¶å…¥ (æœ¬æ¥­/å‹å‹™)</div>
                    <div class="input-group mb-2">
                        <span class="input-group-text">æœ¬æ¥­æœˆè–ª</span>
                        <input type="number" id="inc-active" class="form-control wan-input" placeholder="è¬" oninput="calculate()">
                        <span class="unit-badge">è¬/æœˆ</span>
                    </div>
                    
                    <div class="section-header hdr-inc mt-3" style="border-left-color: var(--success);">è¢«å‹•æ”¶å…¥ (ç³»çµ±/æŠ•è³‡)</div>
                    <div class="input-group mb-2">
                        <span class="input-group-text fw-bold text-primary">å®‰éº—æ”¶å…¥</span>
                        <input type="number" id="inc-amway" class="form-control wan-input" placeholder="è¬" oninput="calculate()">
                        <span class="unit-badge">è¬/æœˆ</span>
                    </div>
                    <div class="input-group mb-2">
                        <span class="input-group-text">è‚¡æ¯/æˆ¿ç§Ÿ</span>
                        <input type="number" id="inc-passive-other" class="form-control wan-input" placeholder="è¬" oninput="calculate()">
                        <span class="unit-badge">è¬/å¹´</span>
                    </div>
                </div>

                <div class="tab-pane fade" id="tab-exp">
                    <div class="section-header hdr-exp">ç”Ÿæ´»èˆ‡å¿…è¦æ”¯å‡º</div>
                    <div class="input-group mb-2">
                        <span class="input-group-text">ç”Ÿæ´»é–‹éŠ·</span>
                        <input type="number" id="exp-living" class="form-control wan-input" placeholder="è¬" oninput="calculate()">
                        <span class="unit-badge">è¬/æœˆ</span>
                    </div>
                    <div class="input-group mb-2">
                        <span class="input-group-text">ä¿éšªç¸½ç¹³</span>
                        <input type="number" id="exp-insurance" class="form-control wan-input" placeholder="è¬" oninput="calculate()">
                        <span class="unit-badge">è¬/å¹´</span>
                    </div>
                    <div class="input-group mb-2">
                        <span class="input-group-text">å…¶ä»–å¹´æ”¯</span>
                        <input type="number" id="exp-other" class="form-control wan-input" placeholder="ç¨…é‡‘/ç´…åŒ…" oninput="calculate()">
                        <span class="unit-badge">è¬/å¹´</span>
                    </div>
                </div>

                <div class="tab-pane fade" id="tab-asset">
                    <div class="section-header hdr-asset">ç¾æœ‰è³‡ç”¢ç›¤é» (ç¸½é¡)</div>
                    <div class="row g-2">
                        <div class="col-6"><input type="number" class="form-control form-control-sm asset-item" placeholder="å­˜æ¬¾(è¬)" oninput="calculate()"></div>
                        <div class="col-6"><input type="number" class="form-control form-control-sm asset-item" placeholder="è‚¡ç¥¨(è¬)" oninput="calculate()"></div>
                        <div class="col-6"><input type="number" class="form-control form-control-sm asset-item" placeholder="æˆ¿ç”¢(è¬)" oninput="calculate()"></div>
                        <div class="col-6"><input type="number" class="form-control form-control-sm asset-item" placeholder="æµ·å¤–(è¬)" oninput="calculate()"></div>
                    </div>
                    <div class="mt-2 text-end small text-primary fw-bold">ç¸½è³‡ç”¢ï¼š<span id="ui-total-asset">0</span> è¬</div>
                </div>

                <div class="tab-pane fade" id="tab-debt">
                    <div class="section-header hdr-debt">ç¾æœ‰è² å‚µ (ä¸å«å¤¢æƒ³)</div>
                    <div id="debt-list"></div>
                    <button class="btn btn-sm btn-outline-danger w-100 dashed mt-2" onclick="addDebt()">+ æ–°å¢è² å‚µ (æˆ¿è²¸/ä¿¡è²¸)</button>
                    <div class="mt-2 text-end small text-danger fw-bold">ç¸½è² å‚µï¼š<span id="ui-total-debt">0</span> è¬</div>
                </div>

            </div>
        </div>
    </div>

    <div class="text-center text-muted small pb-4 mt-3" style="opacity:0.6">Designed for Daxin Partners â€¢ Gavin</div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script>
    const RATES = { house: 0.022, car: 0.05, loan: 0.06 };
    const AMWAY_PINS = [{name:"ç™½é‡‘",income:100},{name:"è—å¯¶çŸ³",income:180},{name:"ç¿¡ç¿ ",income:250},{name:"é‘½çŸ³",income:500},{name:"çš‡å† ",income:1000}];

    document.addEventListener('DOMContentLoaded', () => {
        addDream(); // é è¨­ä¸€ç­†å¤¢æƒ³
        calculate();
    });

    // è¬èƒ½å–å€¼
    function val(id) { return Number(document.getElementById(id).value) || 0; }

    function calculate() {
        // --- 1. è²¡å‹™ç¾æ³ ---
        // æ”¶å…¥ (å¹´åŒ–)
        let activeInc = val('inc-active') * 12;
        let amwayInc = val('inc-amway') * 12;
        let passiveOther = val('inc-passive-other'); // å¹´ç¹³
        let totalIncome = activeInc + amwayInc + passiveOther;

        // æ”¯å‡º (å¹´åŒ–)
        let livingExp = val('exp-living') * 12;
        let insExp = val('exp-insurance');
        let otherExp = val('exp-other');
        
        // ç¾æœ‰è² å‚µ (è¨ˆç®—æœˆé‚„æ¬¾ & ç¸½æ¬ æ¬¾)
        let debtAnnualPay = 0;
        let debtTotal = 0;
        document.querySelectorAll('.debt-row').forEach(row => {
            let m = Number(row.querySelector('.debt-m').value) || 0;
            let total = Number(row.querySelector('.debt-total').value) || 0;
            debtAnnualPay += m * 12;
            debtTotal += total;
        });

        let baseExpense = livingExp + insExp + otherExp + debtAnnualPay;
        
        // è³‡ç”¢
        let totalAssets = 0;
        document.querySelectorAll('.asset-item').forEach(i => totalAssets += Number(i.value)||0);
        let netWorth = totalAssets - debtTotal;

        // --- 2. å¤¢æƒ³éœ€æ±‚è¨ˆç®— ---
        let dreamLoanAnnual = 0; // å¤¢æƒ³è½‰è²¸æ¬¾å¾Œçš„å¹´æ”¯å‡º
        let dreamFullTarget = 0; // éœ€å…¨æ¬¾çš„ç›®æ¨™
        let dreamDesc = "";

        document.querySelectorAll('.dream-row').forEach(row => {
            let type = row.querySelector('.dream-type').value;
            let cost = Number(row.querySelector('.dream-cost').value) || 0;
            
            if (cost > 0) {
                if(type === 'house' || type === 'car') {
                    // è½‰è²¸æ¬¾æ¨¡å¼ (æˆ¿30å¹´, è»Š7å¹´)
                    let y = (type==='house')?30:7;
                    let r = (type==='house')?RATES.house:RATES.car;
                    // ç°¡æ˜“å¹´ä»˜ = (æœ¬é‡‘/å¹´) + (æœ¬é‡‘*åˆ©ç‡)
                    let annual = (cost / y) + (cost * r);
                    dreamLoanAnnual += annual;
                    dreamDesc += `${type==='house'?'è²·æˆ¿':'è²·è»Š'} `;
                } else {
                    // å…¨æ¬¾æ¨¡å¼
                    dreamFullTarget += cost;
                    dreamDesc += "å…¨æ¬¾å¤¢æƒ³ ";
                }
            }
        });

        // --- 3. ç¶œåˆè©•ä¼° ---
        // ç¸½æ”¯å‡º = åŸºç¤æ”¯å‡º + å¤¢æƒ³æ–°å¢è²¸æ¬¾
        let finalExpense = baseExpense + dreamLoanAnnual;
        let annualCashFlow = totalIncome - finalExpense;
        let monthlyCashFlow = annualCashFlow / 12;

        // é¡¯ç¤ºæ•¸æ“š
        document.getElementById('res-cashflow').innerText = (monthlyCashFlow).toFixed(1) + " è¬";
        document.getElementById('res-cashflow').className = monthlyCashFlow >= 0 ? "stat-val val-green" : "stat-val val-red";
        document.getElementById('res-networth').innerText = netWorth.toLocaleString() + " è¬";
        
        document.getElementById('ui-total-asset').innerText = totalAssets;
        document.getElementById('ui-total-debt').innerText = debtTotal;

        // ç‹€æ…‹åˆ¤å®š
        let statusBox = document.getElementById('dream-status');
        if (dreamLoanAnnual === 0 && dreamFullTarget === 0) {
            statusBox.innerText = "å°šæœªè¨­å®šå¤¢æƒ³"; statusBox.className = "dream-status-bar";
        } else if (monthlyCashFlow < 0) {
            statusBox.innerText = "âŒ ç¾é‡‘æµä¸è¶³ï¼Œç„¡æ³•è² æ“”å¤¢æƒ³è²¸æ¬¾ï¼"; statusBox.className = "dream-status-bar status-fail";
        } else {
            statusBox.innerText = "âœ… ç¾é‡‘æµå¥åº·ï¼Œå¯è² æ“”å¤¢æƒ³ï¼"; statusBox.className = "dream-status-bar status-ok";
        }

        // --- 4. å¹´é½¡é æ¸¬ ---
        let currentAge = val('current-age') || 30;
        
        // æœ¬æ¥­çµé¤˜ = (ç¸½æ”¶ - å®‰éº—) - ç¸½æ”¯
        // è‹¥ç¾é‡‘æµå·²ç¶“æ˜¯è² çš„ï¼Œæˆ–æ˜¯å…¨æ¬¾ç›®æ¨™ > 0 ä½†çµé¤˜ <= 0ï¼Œå‰‡ç„¡æ³•é”æˆ
        let jobIncome = totalIncome - amwayInc;
        let jobSurplus = jobIncome - finalExpense;
        
        // è¨ˆç®—é”æˆå¹´é½¡ (Target: å…¨æ¬¾ç›®æ¨™ - æ·¨è³‡ç”¢)
        // è‹¥ç„¡å…¨æ¬¾ç›®æ¨™ï¼Œåªçœ‹ç¾é‡‘æµæ˜¯å¦è½‰æ­£
        let target = Math.max(0, dreamFullTarget - Math.max(0, netWorth));
        
        let yearsJob = 99;
        if (target === 0) {
            yearsJob = (jobSurplus >= 0) ? 0 : 99;
        } else {
            yearsJob = (jobSurplus > 0) ? Math.ceil(target / jobSurplus) : 99;
        }

        let yearsAmway = 99;
        if (target === 0) {
            yearsAmway = (annualCashFlow >= 0) ? 0 : 99;
        } else {
            yearsAmway = (annualCashFlow > 0) ? Math.ceil(target / annualCashFlow) : 99;
        }

        updateAge('res-age-job', yearsJob, currentAge);
        updateAge('res-age-amway', yearsAmway, currentAge);

        // --- 5. ç¼ºå£èˆ‡å»ºè­° ---
        // ç¼ºå£ = è² ç¾é‡‘æµ (è£œèµ¤å­—) OR ç‚ºäº†åŠ é€Ÿå…¨æ¬¾ (å‡è¨­æƒ³5å¹´é”æˆ)
        let gap = 0;
        if (annualCashFlow < 0) gap = Math.abs(annualCashFlow);
        else if (yearsAmway > 5 && target > 0) gap = (target / 5) - annualCashFlow;

        let pinBox = document.getElementById('pin-suggestion');
        if (gap > 0) {
            pinBox.style.display = 'flex';
            let pin = AMWAY_PINS.find(p => p.income >= gap) || AMWAY_PINS[AMWAY_PINS.length-1];
            document.getElementById('pin-name').innerText = pin.name;
            document.getElementById('pin-gap').innerText = `éœ€è£œè¶³å¹´æ”¶ç¼ºå£ ${gap.toFixed(1)} è¬`;
        } else {
            pinBox.style.display = 'none';
        }
    }

    function updateAge(id, y, age) {
        let el = document.getElementById(id);
        if (y === 0) el.innerText = "ç«‹å³é”æˆ";
        else if (y > 60) el.innerText = "é™é™ç„¡æœŸ";
        else el.innerText = `${age + y} æ­²`;
    }

    function addDream() {
        let div = document.createElement('div'); div.className = 'dynamic-row dream-item dream-row';
        div.innerHTML = `
            <button class="btn-remove" onclick="this.parentElement.remove();calculate()">&times;</button>
            <div class="row g-2">
                <div class="col-5">
                    <select class="form-select form-select-sm dream-type" onchange="calculate()">
                        <option value="house">ğŸ  è²·æˆ¿(è²¸)</option>
                        <option value="car">ğŸš— è²·è»Š(è²¸)</option>
                        <option value="other">âœ¨ å…¶ä»–(å…¨æ¬¾)</option>
                    </select>
                </div>
                <div class="col-7"><input type="number" class="form-control form-control-sm dream-cost" placeholder="ç¸½åƒ¹(è¬)" oninput="calculate()"></div>
            </div>`;
        document.getElementById('dream-list').appendChild(div);
    }

    function addDebt() {
        let div = document.createElement('div'); div.className = 'dynamic-row loan-item debt-row';
        div.innerHTML = `
            <button class="btn-remove" onclick="this.parentElement.remove();calculate()">&times;</button>
            <div class="row g-2">
                <div class="col-12 mb-1"><input type="text" class="form-control form-control-sm" placeholder="é …ç›®åç¨± (å¦‚ä¿¡è²¸)"></div>
                <div class="col-6"><input type="number" class="form-control form-control-sm debt-m" placeholder="æœˆé‚„(è¬)" oninput="calculate()"></div>
                <div class="col-6"><input type="number" class="form-control form-control-sm debt-total" placeholder="ç¸½æ¬ (è¬)" oninput="calculate()"></div>
            </div>`;
        document.getElementById('debt-list').appendChild(div);
    }

    function saveData() { alert('âœ… ç´€éŒ„å·²æš«å­˜'); }
</script>
</body>
</html>
