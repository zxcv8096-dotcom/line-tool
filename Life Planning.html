<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>å¤§å¿ƒå¤¥ä¼´å¤¢æƒ³é”æˆå™¨ ğŸ¦„</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        /* --- å¤¢æƒ³æ¥µå…‰ä¸»é¡Œ (Dream Aurora) --- */
        :root {
            --bg-gradient: linear-gradient(135deg, #fdfbfb 0%, #ebedee 100%);
            --card-bg: rgba(255, 255, 255, 0.95);
            --primary: #6c5ce7;
            --secondary: #a29bfe;
            --accent: #fd79a8;
            --text-main: #2d3436;
            --success: #00b894;
            --danger: #d63031;
        }

        body { 
            background: #e0c3fc; 
            background: linear-gradient(to right, #8ec5fc, #e0c3fc); 
            font-family: "Microsoft JhengHei", sans-serif; 
            padding-bottom: 120px; 
            color: var(--text-main); 
        }

        .navbar { background: white; box-shadow: 0 4px 20px rgba(0,0,0,0.05); }
        .navbar-brand { font-weight: 900; color: var(--primary) !important; letter-spacing: 1px; }

        .card { 
            border: none; border-radius: 20px; box-shadow: 0 10px 30px rgba(108, 92, 231, 0.1); 
            margin-bottom: 20px; background: var(--card-bg); backdrop-filter: blur(10px); overflow: hidden; 
        }

        /* 1. ä¸»è§’ï¼šç¸½çµå¡ç‰‡ (ç½®é ‚) */
        .summary-card { border-top: 6px solid var(--primary); }
        .summary-title { font-size: 1.1rem; font-weight: 800; color: var(--primary); margin-bottom: 15px; display: flex; align-items: center; }
        
        .tax-row { display: flex; justify-content: space-between; align-items: center; padding: 6px 0; border-bottom: 1px dashed #eee; font-size: 0.9rem; }
        .tax-val { font-weight: 800; color: var(--text-main); }
        
        /* é”æˆå¹´é½¡å°æ¯”å€ */
        .age-comparison { display: flex; gap: 10px; margin-top: 20px; }
        .age-box { flex: 1; padding: 15px 5px; border-radius: 12px; text-align: center; background: #fff; border: 1px solid #eee; box-shadow: 0 4px 10px rgba(0,0,0,0.05); }
        .age-box.highlight { background: linear-gradient(135deg, #fff0f5 0%, #fff 100%); border: 2px solid var(--accent); transform: scale(1.02); }
        .age-label { font-size: 0.8rem; color: #888; font-weight: bold; margin-bottom: 5px; display: block; }
        .age-value { font-size: 1.3rem; font-weight: 900; color: var(--text-main); }
        .age-value.win { color: var(--accent); }

        /* è˜ä½å»ºè­° */
        .pin-suggestion { 
            margin-top: 15px; padding: 15px; border-radius: 12px; 
            background: linear-gradient(to right, var(--primary), var(--secondary)); 
            color: white; display: flex; align-items: center; 
            box-shadow: 0 5px 15px rgba(108, 92, 231, 0.3); 
        }
        .pin-icon { font-size: 3rem; margin-right: 15px; filter: drop-shadow(0 2px 4px rgba(0,0,0,0.3)); }
        .pin-text h5 { margin: 0; font-weight: 900; font-size: 1.3rem; }
        .pin-text p { margin: 0; font-size: 0.9rem; opacity: 0.9; }

        /* è¼¸å…¥å€æ¨™é¡Œ */
        .section-header { font-size: 1rem; font-weight: 800; color: #555; margin-bottom: 15px; padding-left: 10px; border-left: 5px solid #ddd; }
        .header-dream { border-color: var(--accent); }
        .header-income { border-color: var(--success); }
        .header-debt { border-color: var(--danger); }
        .header-asset { border-color: var(--primary); }

        /* UI å…ƒä»¶ */
        .input-group-text { background: #f8f9fa; border: 1px solid #ced4da; font-weight: 600; font-size: 0.9rem; }
        .form-control { border: 1px solid #ced4da; font-weight: 600; }
        .form-control:focus { border-color: var(--primary); box-shadow: none; }
        .unit-select { max-width: 70px; background: #fff; border: 1px solid #ced4da; font-weight: bold; color: #555; text-align: center; }
        
        /* è¬å–®ä½æç¤º */
        .wan-badge { 
            position: absolute; right: 40px; top: 50%; transform: translateY(-50%); 
            font-size: 0.75rem; color: #aaa; pointer-events: none; font-weight: bold; background: rgba(255,255,255,0.8); padding: 0 4px; 
        }

        /* å‹•æ…‹åˆ—è¡¨ */
        .dynamic-row { background: white; padding: 15px; border-radius: 12px; margin-bottom: 10px; border: 1px solid #f0f0f0; border-left-width: 5px; position: relative; box-shadow: 0 2px 5px rgba(0,0,0,0.02); }
        .dream-item { border-left-color: var(--accent); }
        .loan-item { border-left-color: var(--danger); }
        .btn-remove { position: absolute; top: 5px; right: 5px; color: #ccc; background: none; border: none; font-size: 1.2rem; }
        
        .loan-hint { font-size: 0.75rem; display: block; text-align: right; margin-top: 5px; font-weight: bold; color: var(--danger); }
        .full-pay-hint { font-size: 0.75rem; display: block; text-align: right; margin-top: 5px; font-weight: bold; color: var(--warning); }

        /* æº«é¦¨èªéŒ„ */
        .warm-quote { text-align: center; font-size: 0.9rem; color: #666; margin-top: 20px; font-style: italic; font-weight: bold; }
    </style>
</head>
<body>

<datalist id="list-monthly"><option value="3"><option value="5"><option value="8"><option value="10"><option value="15"></datalist>
<datalist id="list-assets"><option value="100"><option value="500"><option value="1000"><option value="2000"></datalist>

<nav class="navbar sticky-top">
    <div class="container-fluid d-flex justify-content-between align-items-center">
        <span class="navbar-brand"><i class="fas fa-meteor me-2"></i>å¤§å¿ƒå¤¢æƒ³é”æˆå™¨</span>
        <button class="btn btn-sm btn-dark rounded-pill fw-bold" onclick="saveData()"><i class="fas fa-save me-1"></i> ç´€éŒ„</button>
    </div>
</nav>

<div class="container mt-3">

    <div class="card summary-card">
        <div class="card-body">
            <div class="summary-title"><i class="fas fa-chart-pie"></i> è²¡å‹™èˆ‡ç¨…å‹™ç¸½çµ (å¹´é ä¼°)</div>
            
            <div class="tax-row">
                <span>åœ‹å…§å¹´æ‰€å¾— (è–ªè³‡+å®‰éº—+è‚¡æ¯+ç§Ÿé‡‘)</span>
                <span class="tax-val" id="sum-domestic">0 è¬</span>
            </div>
            <div class="tax-row">
                <span>é ä¼°åœ‹å…§æ‰€å¾—ç¨… (ç´„)</span>
                <span class="tax-val" style="color:var(--danger)" id="sum-tax-dom">0</span>
            </div>
            <div class="tax-row">
                <span>æµ·å¤–å¹´æ‰€å¾—</span>
                <span class="tax-val" id="sum-overseas">0 è¬</span>
            </div>
            <div class="tax-row">
                <span>é ä¼°æµ·å¤–ç¨… (åŸºæœ¬æ‰€å¾— > 750è¬)</span>
                <span class="tax-val" style="color:var(--danger)" id="sum-tax-ovs">0 (å…ç¨…)</span>
            </div>

            <div class="age-comparison">
                <div class="age-box">
                    <span class="age-label"><i class="fas fa-turtle me-1"></i>æœ¬æ¥­é”æˆå¹´é½¡</span>
                    <span class="age-value" id="age-job">--</span>
                </div>
                <div class="age-box highlight">
                    <span class="age-label"><i class="fas fa-rocket me-1"></i>åŠ ä¸Šå®‰éº—é”æˆ</span>
                    <span class="age-value win" id="age-amway">--</span>
                </div>
            </div>

            <div class="pin-suggestion" id="pin-box" style="display:none;">
                <div class="pin-icon" id="pin-icon">ğŸ’</div>
                <div class="pin-text">
                    <h5 id="pin-title">å»ºè­°ç›®æ¨™ï¼šé‘½çŸ³</h5>
                    <p id="pin-desc">è£œè¶³ç¼ºå£ï¼Œè®“å¤¢æƒ³ææ—© 10 å¹´å¯¦ç¾ï¼</p>
                </div>
            </div>
        </div>
    </div>

    <div class="card">
        <div class="card-body">
            <div class="section-header header-dream">1. è¨­å®š & å¤¢æƒ³ (è¼¸å…¥å–®ä½ï¼šè¬)</div>
            
            <div class="row g-2 mb-3">
                <div class="col-12">
                    <div class="input-group">
                        <span class="input-group-text">ç›®å‰å¹´é½¡</span>
                        <input type="number" id="current-age" class="form-control" placeholder="30" oninput="calculate()">
                        <span class="input-group-text">æ­²</span>
                    </div>
                </div>
            </div>

            <div class="d-flex justify-content-between align-items-center mb-2">
                <span class="small fw-bold text-muted">æˆ‘çš„å¤¢æƒ³æ¸…å–®</span>
                <button class="btn btn-sm btn-outline-primary rounded-pill" onclick="addDreamRow()">+ æ–°å¢</button>
            </div>
            <div id="dream-container"></div>
            
            <div class="alert alert-light small text-muted mt-2 mb-0 border-0" style="background:#f8f9fa;">
                <i class="fas fa-magic me-1 text-warning"></i> 
                ç³»çµ±è‡ªå‹•é‹ç®—ï¼š<b>è²·æˆ¿/è»Š</b>è½‰ç‚ºæœˆæ”¯å‡º(å½±éŸ¿è‡ªç”±åº¦)ï¼›<b>å…¨æ¬¾</b>å‰‡è¨ˆç®—é”æˆæ™‚é–“ã€‚
            </div>
        </div>
    </div>

    <div class="card">
        <div class="card-body">
            <div class="section-header header-income">2. æ”¶å…¥å¡«å¯« (è¼¸å…¥å–®ä½ï¼šè¬)</div>
            
            <div class="input-group mb-2">
                <span class="input-group-text">æœ¬æ¥­è–ªè³‡</span>
                <input type="number" id="inc-active" class="form-control wan-input" placeholder="ä¾‹å¦‚ 5" oninput="calculate()">
                <div class="wan-badge">0è¬</div>
                <select class="form-select unit-select" id="unit-active" onchange="calculate()"><option value="month">æœˆ</option><option value="year">å¹´</option></select>
            </div>

            <div class="input-group mb-2">
                <span class="input-group-text fw-bold" style="color:var(--primary)">å®‰éº—æ”¶å…¥</span>
                <input type="number" id="inc-amway" class="form-control wan-input" placeholder="ä¾‹å¦‚ 10" oninput="calculate()">
                <div class="wan-badge">0è¬</div>
                <select class="form-select unit-select" id="unit-amway" onchange="calculate()"><option value="month">æœˆ</option><option value="year">å¹´</option></select>
            </div>

            <div class="row g-2">
                <div class="col-6">
                    <div class="input-group input-group-sm">
                        <span class="input-group-text">åœ‹å…§è‚¡æ¯</span>
                        <input type="number" id="inc-stock" class="form-control" placeholder="å¹´é ˜(è¬)" oninput="calculate()">
                    </div>
                </div>
                <div class="col-6">
                    <div class="input-group input-group-sm">
                        <span class="input-group-text">æˆ¿ç§Ÿ</span>
                        <input type="number" id="inc-rent" class="form-control" placeholder="æœˆæ”¶(è¬)" oninput="calculate()">
                    </div>
                </div>
                <div class="col-12">
                    <div class="input-group input-group-sm">
                        <span class="input-group-text">æµ·å¤–é…æ¯</span>
                        <input type="number" id="inc-ovs" class="form-control" placeholder="å¹´é ˜é‡‘é¡" oninput="calculate()">
                        <select class="form-select unit-select" id="unit-ovs" onchange="calculate()">
                            <option value="wan">è¬(å°)</option>
                            <option value="usd">ç¾é‡‘</option>
                        </select>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="card">
        <div class="card-body">
            <div class="section-header header-debt">3. æ”¯å‡ºèˆ‡è² å‚µ (è¼¸å…¥å–®ä½ï¼šè¬)</div>
            
            <label class="small text-muted fw-bold">ç¾æœ‰è² å‚µ (ä¸å«å¤¢æƒ³)</label>
            <div id="loan-container"></div>
            <button class="btn btn-sm btn-outline-danger w-100 mb-3 dashed" onclick="addLoanRow()">+ æ–°å¢è² å‚µ (ä¿¡è²¸/å­¸è²¸)</button>

            <label class="small text-muted fw-bold">ä¿éšª / ç”Ÿæ´»é–‹éŠ·</label>
            <div class="input-group mb-2">
                <span class="input-group-text">ç”Ÿæ´»æœˆé–‹éŠ·</span>
                <input type="number" id="exp-living" class="form-control wan-input" placeholder="è¬" oninput="calculate()">
                <div class="wan-badge">0è¬</div>
            </div>
            
            <div class="input-group mb-2">
                <span class="input-group-text">ä¿éšªç¸½ç¹³</span>
                <input type="number" id="exp-ins" class="form-control" placeholder="é‡‘é¡(è¬)" oninput="calculate()">
                <select class="form-select unit-select" id="unit-ins" onchange="calculate()">
                    <option value="year">å¹´ç¹³</option>
                    <option value="month">æœˆç¹³</option>
                </select>
            </div>
        </div>
    </div>

    <div class="accordion mb-4" id="assetAcc">
        <div class="accordion-item border-0" style="background:transparent;">
            <h2 class="accordion-header">
                <button class="accordion-button collapsed rounded-3 shadow-sm fw-bold header-asset" type="button" data-bs-toggle="collapse" data-bs-target="#collapseAsset" style="background:white; border-left: 5px solid var(--primary);">
                    ğŸ’ 4. ç¾æœ‰è³‡ç”¢ (è¼¸å…¥çœŸå¯¦é‡‘é¡)
                </button>
            </h2>
            <div id="collapseAsset" class="accordion-collapse collapse" data-bs-parent="#assetAcc">
                <div class="accordion-body bg-white rounded-bottom-3 shadow-sm">
                    <div class="row g-2">
                        <div class="col-6"><input type="number" class="form-control form-control-sm asset-item" placeholder="å­˜æ¬¾(è¬)" oninput="calculate()"></div>
                        <div class="col-6"><input type="number" class="form-control form-control-sm asset-item" placeholder="è‚¡ç¥¨(è¬)" oninput="calculate()"></div>
                        <div class="col-6"><input type="number" class="form-control form-control-sm asset-item" placeholder="åŸºé‡‘(è¬)" oninput="calculate()"></div>
                        <div class="col-6"><input type="number" class="form-control form-control-sm asset-item" placeholder="æˆ¿ç”¢(è¬)" oninput="calculate()"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="quote-area" class="warm-quote"></div>
    <div class="text-center text-muted small pb-4 mt-2" style="opacity:0.5; font-size:0.7rem;">Designed for Daxin Partners â€¢ Gavin</div>

</div>

<script>
    // åƒæ•¸è¨­å®š (è¬)
    const RATES = { house: 0.022, car: 0.05 }; 
    const USD_RATE = 32.5;
    const AMWAY_PINS = [
        { name: "ç™½é‡‘ (Platinum)", income: 100, icon: "ğŸ¥ˆ" },
        { name: "è—å¯¶çŸ³ (Sapphire)", income: 180, icon: "ğŸ”¹" },
        { name: "ç¿¡ç¿  (Emerald)", income: 250, icon: "ğŸ’š" },
        { name: "é‘½çŸ³ (Diamond)", income: 500, icon: "ğŸ’" },
        { name: "åŸ·è¡Œå°ˆæ‰ (EDC)", income: 700, icon: "ğŸ¢" },
        { name: "çš‡å†  (Crown)", income: 1000, icon: "ğŸ‘‘" },
        { name: "çš‡å† å¤§ä½¿ (CA)", income: 3000, icon: "ğŸŒ" }
    ];
    const QUOTES = [
        "å¤¢æƒ³ä¸æ˜¯ç”¨æƒ³çš„ï¼Œæ˜¯ç”¨ç¾é‡‘æµå †å‡ºä¾†çš„ï¼ğŸŒ±",
        "å …æŒæ˜¯é€šå¾€çš‡å† å”¯ä¸€çš„è·¯ï¼ğŸ’ª",
        "èŠ±è‹¥ç››é–‹ï¼Œè´è¶è‡ªä¾†ï¼ğŸŒ»",
        "æ‰“é€ ç¾é‡‘æµï¼Œè®“æœªä¾†æ›´è‡ªç”±ï¼ğŸ’§"
    ];

    document.addEventListener('DOMContentLoaded', () => {
        document.getElementById('quote-area').innerText = QUOTES[Math.floor(Math.random() * QUOTES.length)];
        addDreamRow(); // é è¨­ä¸€è¡Œå¤¢æƒ³
        
        // è¬å–®ä½ç›£è½
        document.body.addEventListener('input', function(e) {
            if(e.target.classList.contains('wan-input')) {
                let v = parseFloat(e.target.value);
                let tag = e.target.nextElementSibling;
                if(tag && tag.classList.contains('wan-badge')) {
                    tag.innerText = (isNaN(v) ? 0 : v) + "è¬";
                }
            }
        });
        calculate();
    });

    // æ ¸å¿ƒè¨ˆç®—
    function calculate() {
        // 1. æ”¶å…¥ (è½‰å¹´ï¼Œå–®ä½ï¼šè¬)
        let active = getVal('inc-active') * (getUnit('unit-active')=='month'?12:1);
        let amway = getVal('inc-amway') * (getUnit('unit-amway')=='month'?12:1);
        let stock = getVal('inc-stock'); 
        let rent = getVal('inc-rent') * 12;
        
        let ovsVal = getVal('inc-ovs');
        let ovsUnit = document.getElementById('unit-overseas').value;
        let overseas = (ovsUnit === 'usd') ? (ovsVal * USD_RATE / 10000) : ovsVal; 

        let annualDomestic = active + amway + stock + rent;
        let annualTotalInc = annualDomestic + overseas;

        // 2. æ”¯å‡º (è½‰å¹´ï¼Œå–®ä½ï¼šè¬)
        
        // A. ç¾æœ‰è² å‚µ (ä¿¡è²¸ç­‰)
        let debtAnnual = 0;
        document.querySelectorAll('.loan-row').forEach(row => {
            let m = Number(row.querySelector('.loan-m').value)||0;
            let unit = row.querySelector('.loan-u').value;
            debtAnnual += (unit === 'month') ? m * 12 : m;
        });

        // B. ä¿éšª
        let insVal = getVal('exp-ins');
        let insAnnual = (getUnit('unit-ins') === 'month') ? insVal * 12 : insVal;

        // C. ç”Ÿæ´»
        let livingAnnual = getVal('exp-living') * 12;

        // D. å¤¢æƒ³è™•ç† (è‡ªå‹•åˆ†æµ)
        let dreamLoanAnnual = 0; // è½‰è²¸æ¬¾çš„å¹´æ”¯å‡º (å½±éŸ¿ç¾é‡‘æµ)
        let dreamFullTarget = 0;  // éœ€å…¨æ¬¾çš„ç›®æ¨™ (å½±éŸ¿é”æˆæ™‚é–“)
        
        document.querySelectorAll('.dream-row').forEach(row => {
            let cost = Number(row.querySelector('.dream-cost').value)||0;
            let type = row.querySelector('.dream-cat').value;
            let hint = row.querySelector('.dream-hint');
            
            // è‡ªå‹•åˆ¤æ–·
            let isLoan = false;
            let years = 0;
            if(type === 'house') { isLoan = true; years = 30; }
            else if(type === 'car') { isLoan = true; years = 7; }
            
            if(isLoan && cost > 0) {
                let rate = (type === 'house') ? RATES.house : RATES.car;
                // ç°¡æ˜“æœ¬æ¯æ”¤é‚„å¹´ä»˜ï¼šç¸½åƒ¹ * (1+ç¸½åˆ©æ¯) / å¹´æ•¸
                // é€™è£¡ç”¨æ›´ç°¡å–®çš„ä¼°ç®—ï¼š(æœ¬é‡‘/å¹´) + (æœ¬é‡‘*åˆ©ç‡)
                let annualPay = (cost / years) + (cost * rate);
                dreamLoanAnnual += annualPay;
                hint.innerText = `è½‰è²¸æ¬¾ ${years}å¹´ï¼Œæœˆä»˜ç´„ ${(annualPay/12).toFixed(1)} è¬`;
                hint.className = "dream-hint loan-hint";
            } else if (cost > 0) {
                dreamFullTarget += cost;
                hint.innerText = `éœ€å­˜å…¨æ¬¾ ${cost} è¬`;
                hint.className = "dream-hint full-pay-hint";
            } else {
                hint.innerText = "";
            }
        });

        let totalAnnualExp = debtAnnual + insAnnual + livingAnnual + dreamLoanAnnual;
        let annualSurplus = annualTotalInc - totalAnnualExp; // å¹´ç¾é‡‘æµ (å«å¤¢æƒ³è²¸æ¬¾)

        // 3. è³‡ç”¢
        let currentAssets = 0;
        document.querySelectorAll('.asset-item').forEach(i => currentAssets += Number(i.value)||0);

        // 4. ç¨…å‹™è©¦ç®—
        let taxable = Math.max(0, annualDomestic - 42.3); 
        let taxDom = 0;
        if(taxable<=59) taxDom=taxable*0.05;
        else if(taxable<=133) taxDom=taxable*0.12-4.13;
        else if(taxable<=266) taxDom=taxable*0.20-14.77;
        else taxDom=taxable*0.30-41.37;

        let taxOvs = 0;
        let basicInc = annualDomestic + overseas;
        if(basicInc > 750 && overseas > 100) taxOvs = (basicInc - 750) * 0.20;

        // UI æ›´æ–° - ç¸½çµå¡
        document.getElementById('sum-domestic').innerText = annualDomestic.toFixed(1) + " è¬";
        document.getElementById('sum-overseas').innerText = overseas.toFixed(1) + " è¬";
        document.getElementById('sum-tax-dom').innerText = Math.floor(taxDom*10000).toLocaleString();
        document.getElementById('sum-tax-ovs').innerText = taxOvs>0 ? Math.floor(taxOvs*10000).toLocaleString() : "0 (å…ç¨…)";

        // 5. é”æˆå¹´é½¡é æ¸¬ (æ¼”ç®—æ³•)
        let age = Number(document.getElementById('current-age').value) || 30;
        
        // A. æœ¬æ¥­é”æˆå¹´é½¡
        // å‡è¨­åªé æœ¬æ¥­çµé¤˜ (æ‰£é™¤å®‰éº—)
        let jobSurplus = (annualTotalInc - amway) - totalAnnualExp; 
        
        // é”æˆå®šç¾©ï¼š
        // 1. è‹¥æœ‰å…¨æ¬¾å¤¢æƒ³ï¼Œçœ‹ä½•æ™‚å­˜åˆ° (Target - Assets) / Surplus
        // 2. è‹¥ç„¡å…¨æ¬¾å¤¢æƒ³(åªæœ‰è²¸æ¬¾å¤¢æƒ³)ï¼Œçœ‹ç¾é‡‘æµæ˜¯å¦ç‚ºæ­£ã€‚è‹¥æ­£ï¼Œå‰‡"ç«‹å³é”æˆ"(èƒ½è² æ“”å°±æ˜¯é”æˆ)ã€‚è‹¥è² ï¼Œå‰‡"é™é™ç„¡æœŸ"ã€‚
        
        let yearsJob = 99;
        if (dreamFullTarget > 0) {
            if (jobSurplus > 0) yearsJob = Math.ceil((dreamFullTarget - currentAssets) / jobSurplus);
        } else {
            yearsJob = jobSurplus >= 0 ? 0 : 99; 
        }

        // B. åŠ ä¸Šå®‰éº—é”æˆå¹´é½¡
        let totalSurplus = annualSurplus;
        let yearsAmway = 99;
        if (dreamFullTarget > 0) {
            if (totalSurplus > 0) yearsAmway = Math.ceil((dreamFullTarget - currentAssets) / totalSurplus);
        } else {
            yearsAmway = totalSurplus >= 0 ? 0 : 99;
        }

        // å¦‚æœæ˜¯è²¸æ¬¾å¤¢æƒ³å°è‡´ç¾é‡‘æµç‚ºè² ï¼Œå®‰éº—çš„ç›®æ¨™å°±æ˜¯è£œè¶³é€™å€‹è² å€¼
        // æ­¤æ™‚"é”æˆ"æ„å‘³è‘—å®‰éº—æ”¶å…¥è£œè¶³äº†ç¼ºå£
        
        // å»ºè­°è˜ä½é‚è¼¯ï¼š
        // ç¼ºå£ = è² ç¾é‡‘æµ (è²¸æ¬¾å¤ªé‡) OR ç‚ºäº†åŠ é€Ÿå…¨æ¬¾å¤¢æƒ³ (å‡è¨­æƒ³5å¹´å…§é”æˆ)
        let gap = 0;
        if (totalSurplus < 0) {
            gap = Math.abs(totalSurplus); // è£œèµ¤å­—
        } else if (yearsAmway > 10 && dreamFullTarget > 0) {
            gap = (dreamFullTarget / 5) - totalSurplus; // åŠ é€Ÿåˆ°5å¹´å…§
        }

        updateAgeUI('age-job', yearsJob, age);
        updateAgeUI('age-amway', yearsAmway, age, gap > 0); // å¦‚æœé‚„æœ‰ç¼ºå£ï¼Œé¡¯ç¤ºéœ€åŠªåŠ›

        // 6. è˜ä½å»ºè­°å¡
        let pinBox = document.getElementById('pin-box');
        if (gap > 0) {
            pinBox.style.display = 'flex';
            let targetPin = AMWAY_PINS.find(p => p.income >= gap);
            if (!targetPin) targetPin = AMWAY_PINS[AMWAY_PINS.length-1];
            
            document.getElementById('pin-title').innerText = `å»ºè­°ç›®æ¨™ï¼š${targetPin.name}`;
            document.getElementById('pin-desc').innerText = `å¡«è£œ ${gap.toFixed(1)}è¬/å¹´ ç¼ºå£ï¼Œè®“å¤¢æƒ³å¯¦ç¾ï¼`;
            document.getElementById('pin-icon').innerText = targetPin.icon;
            
            // å¦‚æœæœ‰äº†å»ºè­°è˜ä½ï¼Œé‡æ–°è¨ˆç®—"å®‰éº—é”æˆå¹´é½¡" (å‡è¨­é”æˆè˜ä½å¾Œ)
            if (dreamFullTarget > 0) {
                let newSurplus = totalSurplus + targetPin.income; // åŠ ä¸Šé æœŸå¢é•·
                let newYears = Math.ceil((dreamFullTarget - currentAssets) / newSurplus);
                document.getElementById('age-amway').innerText = `${age + newYears} æ­² (é”æˆ${targetPin.name}å¾Œ)`;
            } else {
                document.getElementById('age-amway').innerText = `é”æˆ ${targetPin.name} å³è‡ªç”±`;
            }

        } else if (totalSurplus > 0 && yearsAmway === 0) {
            pinBox.style.display = 'flex';
            document.getElementById('pin-title').innerText = `è²¡å‹™å¥åº·ï¼šç¾é‡‘æµç‚ºæ­£`;
            document.getElementById('pin-desc').innerText = `æ­å–œï¼æ‚¨çš„è¦åŠƒå·²èƒ½æ”¯æ’å¤¢æƒ³ã€‚`;
            document.getElementById('pin-icon').innerText = "ğŸ‰";
        } else {
            pinBox.style.display = 'none';
        }
    }

    function updateAgeUI(id, years, currentAge, hasGap) {
        let el = document.getElementById(id);
        if (years === 0 && !hasGap) el.innerText = "ç«‹å³é”æˆ";
        else if (years > 60 || hasGap) el.innerText = "é™é™ç„¡æœŸ / éœ€åŠªåŠ›";
        else el.innerText = `${currentAge + years} æ­²`;
    }

    function getVal(id) { return Number(document.getElementById(id).value) || 0; }
    function getUnit(id) { return document.getElementById(id).value; }

    function addDreamRow() {
        let div = document.createElement('div'); div.className = 'dynamic-row dream-row dream-item';
        div.innerHTML = `
            <button class="btn-remove" onclick="this.parentElement.remove();calculate()">&times;</button>
            <div class="row g-2 align-items-center">
                <div class="col-5">
                    <select class="form-select form-select-sm dream-cat" onchange="calculate()">
                        <option value="house">ğŸ  è²·æˆ¿</option>
                        <option value="car">ğŸš— è²·è»Š</option>
                        <option value="travel">âœˆï¸ æ—…éŠ</option>
                        <option value="learn">ğŸ“š é€²ä¿®</option>
                        <option value="biz">ğŸ’¼ å‰µæ¥­</option>
                        <option value="other">âœ¨ å…¶ä»–</option>
                    </select>
                </div>
                <div class="col-7">
                    <div class="input-group input-group-sm">
                        <input type="number" class="form-control dream-cost" placeholder="ç¸½åƒ¹(è¬)" oninput="calculate()">
                        <span class="input-group-text">è¬</span>
                    </div>
                </div>
                <div class="col-12 dream-hint loan-hint"></div>
            </div>`;
        document.getElementById('dream-container').appendChild(div);
    }

    function addLoanRow() {
        let div = document.createElement('div'); div.className = 'dynamic-row loan-row loan-item';
        div.innerHTML = `
            <button class="btn-remove" onclick="this.parentElement.remove();calculate()">&times;</button>
            <div class="row g-2">
                <div class="col-5">
                    <select class="form-select form-select-sm loan-cat">
                        <option>ä¿¡è²¸</option><option>è»Šè²¸</option><option>å­¸è²¸</option><option>å…¶ä»–</option>
                    </select>
                </div>
                <div class="col-4"><input type="number" class="form-control loan-m" placeholder="é‡‘é¡" oninput="calculate()"></div>
                <div class="col-3"><select class="form-select form-select-sm loan-u" onchange="calculate()"><option value="month">æœˆç¹³</option><option value="year">å¹´ç¹³</option></select></div>
            </div>`;
        document.getElementById('loan-container').appendChild(div);
    }

    function addInsRow() {
        let div = document.createElement('div'); div.className = 'dynamic-row ins-row ins-item';
        div.innerHTML = `
            <button class="btn-remove" onclick="this.parentElement.remove();calculate()">&times;</button>
            <div class="row g-2">
                <div class="col-6">
                    <div class="input-group input-group-sm">
                        <input type="number" class="form-control ins-amt" placeholder="ä¿è²»(è¬)" oninput="calculate()">
                    </div>
                </div>
                <div class="col-6">
                    <select class="form-select form-select-sm ins-type" onchange="calculate()">
                        <option value="year">å¹´ç¹³</option>
                        <option value="month">æœˆç¹³</option>
                    </select>
                </div>
            </div>`;
        document.getElementById('insurance-container').appendChild(div);
    }

    function saveData() { alert('âœ… å¤¢æƒ³è—åœ–å·²ä¿å­˜ï¼'); }
</script>
</body>
</html>
