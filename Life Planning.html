<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>å¤§å¿ƒå¤¢æƒ³é”æˆå™¨ (Dream Engine) ğŸ’</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        /* --- å¤¢æƒ³æ¥µå…‰ä¸»é¡Œ --- */
        :root {
            --primary: #6c5ce7;
            --secondary: #a29bfe;
            --accent: #fd79a8;
            --success: #00b894;
            --danger: #ff7675;
            --warning: #fdcb6e;
            --card-bg: rgba(255, 255, 255, 0.98);
            --bg-body: #dfe6e9;
        }

        body { 
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%); 
            font-family: "Microsoft JhengHei", sans-serif; 
            padding-bottom: 120px; 
            color: #2d3436; 
        }

        .navbar { background: white; box-shadow: 0 4px 20px rgba(0,0,0,0.05); }
        .navbar-brand { font-weight: 900; color: var(--primary) !important; letter-spacing: 1px; }

        .card { 
            border: none; border-radius: 20px; box-shadow: 0 10px 30px rgba(108, 92, 231, 0.1); 
            margin-bottom: 20px; background: var(--card-bg); overflow: hidden; 
        }

        /* 1. ä¸»è§’ï¼šç¸½çµå¡ç‰‡ (ç½®é ‚) */
        .summary-card { border-top: 6px solid var(--primary); }
        .summary-title { font-size: 1.1rem; font-weight: 800; color: var(--primary); margin-bottom: 15px; display: flex; align-items: center; justify-content: space-between; }
        
        .result-row { display: flex; justify-content: space-between; align-items: center; padding: 8px 0; border-bottom: 1px dashed #eee; font-size: 0.95rem; }
        .result-val { font-weight: 800; color: #2d3436; }
        
        /* é”æˆå¹´é½¡å°æ¯”å€ */
        .age-comparison { display: flex; gap: 10px; margin-top: 15px; }
        .age-box { flex: 1; padding: 15px 5px; border-radius: 12px; text-align: center; background: #fff; border: 1px solid #eee; box-shadow: 0 4px 10px rgba(0,0,0,0.05); position: relative; overflow: hidden; }
        .age-box.highlight { background: linear-gradient(135deg, #fff0f5 0%, #fff 100%); border: 2px solid var(--accent); transform: scale(1.02); z-index: 1; }
        .age-label { font-size: 0.8rem; color: #888; font-weight: bold; margin-bottom: 5px; display: block; }
        .age-value { font-size: 1.4rem; font-weight: 900; color: #2d3436; line-height: 1.2; }
        .age-value.win { color: var(--accent); }
        .age-desc { font-size: 0.75rem; color: #999; margin-top: 4px; display: block; }

        /* å¤¢æƒ³ç¼ºå£åˆ†æ (æ–°) */
        .gap-analysis { margin-top: 15px; padding: 12px; background: #fff3cd; border-radius: 10px; color: #856404; font-size: 0.9rem; border-left: 4px solid #ffc107; }
        .gap-highlight { font-weight: 900; color: #d35400; font-size: 1.1rem; }

        /* è˜ä½å»ºè­° */
        .pin-suggestion { 
            margin-top: 15px; padding: 15px; border-radius: 12px; 
            background: linear-gradient(to right, var(--primary), var(--secondary)); 
            color: white; display: flex; align-items: center; 
            box-shadow: 0 5px 15px rgba(108, 92, 231, 0.3); 
        }
        .pin-icon { font-size: 3rem; margin-right: 15px; filter: drop-shadow(0 2px 4px rgba(0,0,0,0.3)); }
        .pin-text h5 { margin: 0; font-weight: 900; font-size: 1.3rem; }
        .pin-text p { margin: 0; font-size: 0.85rem; opacity: 0.9; }

        /* è¼¸å…¥å€æ¨™é¡Œ */
        .section-header { font-size: 1rem; font-weight: 800; color: #555; margin-bottom: 15px; padding-left: 10px; border-left: 5px solid #ddd; }
        .header-dream { border-color: var(--accent); }
        .header-income { border-color: var(--success); }
        .header-debt { border-color: var(--danger); }
        .header-asset { border-color: var(--primary); }

        /* UI å…ƒä»¶ */
        .input-group-text { background: #f8f9fa; border: 1px solid #ced4da; font-weight: 600; font-size: 0.9rem; }
        .form-control, .form-select { border: 1px solid #ced4da; font-weight: 600; font-size: 0.95rem; }
        .form-control:focus, .form-select:focus { border-color: var(--primary); box-shadow: none; }
        .unit-select { max-width: 70px; background: #fff; border: 1px solid #ced4da; font-weight: bold; color: #555; text-align: center; font-size: 0.85rem; }
        
        .wan-badge { 
            position: absolute; right: 40px; top: 50%; transform: translateY(-50%); 
            font-size: 0.75rem; color: #aaa; pointer-events: none; font-weight: bold; background: rgba(255,255,255,0.8); padding: 0 4px; 
        }

        .dynamic-row { background: white; padding: 10px; border-radius: 12px; margin-bottom: 10px; border: 1px solid #f0f0f0; border-left-width: 5px; position: relative; box-shadow: 0 2px 5px rgba(0,0,0,0.02); }
        .dream-item { border-left-color: var(--accent); }
        .exp-item { border-left-color: var(--danger); }
        .asset-item-row { border-left-color: var(--primary); }
        .btn-remove { position: absolute; top: 8px; right: 8px; color: #ccc; background: none; border: none; font-size: 1.1rem; z-index: 10; }
        .btn-remove:hover { color: var(--danger); }
        
        .hint-text { font-size: 0.75rem; display: block; text-align: right; margin-top: 4px; font-weight: bold; }
        .hint-red { color: var(--danger); }
        .hint-orange { color: var(--warning); }
        
        .warm-quote { text-align: center; font-size: 0.9rem; color: #666; margin-top: 20px; font-style: italic; font-weight: bold; }
    </style>
</head>
<body>

<datalist id="list-monthly"><option value="3"><option value="5"><option value="8"><option value="10"><option value="15"></datalist>
<datalist id="list-assets"><option value="100"><option value="500"><option value="1000"><option value="2000"></datalist>

<nav class="navbar sticky-top">
    <div class="container-fluid d-flex justify-content-between align-items-center">
        <span class="navbar-brand"><i class="fas fa-meteor me-2"></i>å¤§å¿ƒå¤¢æƒ³é”æˆå™¨</span>
        <div class="d-flex">
            <button class="btn btn-sm btn-outline-primary fw-bold rounded-pill me-2" onclick="copyReport()"><i class="fas fa-copy"></i> è¨ºæ–·</button>
            <button class="btn btn-sm btn-dark rounded-pill fw-bold" onclick="saveData(true)"><i class="fas fa-save"></i> å­˜æª”</button>
        </div>
    </div>
</nav>

<div class="container mt-3">

    <div class="card summary-card">
        <div class="card-body">
            <div class="summary-title"><i class="fas fa-chart-pie me-2"></i> è²¡å‹™ç¸½çµ (å¹´é ä¼°)</div>
            
            <div class="result-row">
                <span>åœ‹å…§å¹´æ”¶å…¥ (è–ªè³‡+å®‰éº—+å…¶ä»–)</span>
                <span class="result-val" id="sum-domestic">0 è¬</span>
            </div>
            <div class="result-row">
                <span>æµ·å¤–å¹´æ”¶å…¥</span>
                <span class="result-val" id="sum-overseas">0 è¬</span>
            </div>
            <div class="result-row">
                <span>å¹´åº¦ç¸½æ”¯å‡º (å«ç”Ÿæ´»/è²¸æ¬¾/ä¿éšª)</span>
                <span class="result-val" style="color:var(--danger)" id="sum-expense">0 è¬</span>
            </div>
            <div class="result-row">
                <span>å¹´åº¦æ·¨çµé¤˜ (ç¾é‡‘æµ)</span>
                <span class="result-val" id="sum-surplus" style="font-size:1.1rem">0 è¬</span>
            </div>

            <div class="gap-analysis" id="gap-box" style="display:none;">
                <i class="fas fa-exclamation-circle me-1"></i> å¤¢æƒ³è­¦è¨Šï¼š<br>
                å¤¢æƒ³è²¸æ¬¾æœˆæ”¯å‡ºï¼š<span id="gap-dream-cost" class="fw-bold">0</span> è¬<br>
                ç›®å‰æœˆç¾é‡‘æµï¼š<span id="gap-current-flow" class="fw-bold">0</span> è¬<br>
                æ¯æœˆç¼ºå£ï¼š<span id="gap-amount" class="gap-highlight">0</span> è¬
            </div>

            <div class="age-comparison">
                <div class="age-box">
                    <span class="age-label"><i class="fas fa-turtle me-1"></i>æœ¬æ¥­é”æˆ</span>
                    <span class="age-value" id="age-job">--</span>
                    <span class="age-desc" id="age-job-desc">ä¾ç›®å‰é€²åº¦</span>
                </div>
                <div class="age-box highlight">
                    <span class="age-label"><i class="fas fa-rocket me-1"></i>åŠ ä¸Šå®‰éº—</span>
                    <span class="age-value win" id="age-amway">--</span>
                    <span class="age-desc" id="age-amway-desc">åŠ é€Ÿå¾Œ</span>
                </div>
            </div>

            <div class="pin-suggestion" id="pin-box" style="display:none;">
                <div class="pin-icon" id="pin-icon">ğŸ’</div>
                <div class="pin-text">
                    <h5 id="pin-title">å»ºè­°ç›®æ¨™ï¼šé‘½çŸ³</h5>
                    <p id="pin-desc">è£œè¶³ç¼ºå£ï¼Œè®“å¤¢æƒ³ææ—© 10 å¹´å¯¦ç¾ï¼</p>
                </div>
            </div>
        </div>
    </div>

    <div class="card">
        <div class="card-body">
            <div class="section-header header-dream">1. è¨­å®š & å¤¢æƒ³ (å–®ä½ï¼šè¬)</div>
            <div class="row g-2 mb-3">
                <div class="col-12">
                    <div class="input-group">
                        <span class="input-group-text">ç›®å‰å¹´é½¡</span>
                        <input type="number" id="current-age" class="form-control save-input" placeholder="ä¾‹å¦‚ 30" oninput="calculate()">
                        <span class="input-group-text">æ­²</span>
                    </div>
                </div>
            </div>
            <div class="d-flex justify-content-between align-items-center mb-2">
                <span class="small fw-bold text-muted">æˆ‘çš„å¤¢æƒ³æ¸…å–®</span>
                <button class="btn btn-sm btn-outline-primary rounded-pill" onclick="addDreamRow()">+ æ–°å¢</button>
            </div>
            <div id="dream-container"></div>
            <div class="alert alert-light small text-muted mt-2 mb-0 border-0" style="background:#f8f9fa;">
                <i class="fas fa-magic me-1 text-warning"></i> æˆ¿(30å¹´)/è»Š(7å¹´)è‡ªå‹•è½‰æœˆæ”¯å‡ºï¼›å…¨æ¬¾é …ç›®ç®—é”æˆå¹´æ•¸ã€‚
            </div>
        </div>
    </div>

    <div class="card">
        <div class="card-body">
            <div class="section-header header-income">2. æ”¶å…¥å¡«å¯« (å–®ä½ï¼šè¬)</div>
            <div class="input-group mb-2">
                <span class="input-group-text">æœ¬æ¥­è–ªè³‡</span>
                <input type="number" id="inc-active" class="form-control wan-input save-input" placeholder="ä¾‹å¦‚ 5" oninput="calculate()">
                <div class="wan-badge">0è¬</div>
                <select class="form-select unit-select save-input" id="unit-active" onchange="calculate()"><option value="month">æœˆ</option><option value="year">å¹´</option></select>
            </div>
            <div class="input-group mb-2">
                <span class="input-group-text fw-bold text-primary">å®‰éº—æ”¶å…¥</span>
                <input type="number" id="inc-amway" class="form-control wan-input save-input" placeholder="ä¾‹å¦‚ 10" oninput="calculate()">
                <div class="wan-badge">0è¬</div>
                <select class="form-select unit-select save-input" id="unit-amway" onchange="calculate()"><option value="month">æœˆ</option><option value="year">å¹´</option></select>
            </div>
            <div class="row g-2">
                <div class="col-6">
                    <div class="input-group input-group-sm"><span class="input-group-text">åœ‹å…§è‚¡æ¯</span><input type="number" id="inc-stock" class="form-control save-input" placeholder="é‡‘é¡" oninput="calculate()"><select class="form-select unit-select save-input" id="unit-stock" onchange="calculate()"><option value="year">å¹´</option><option value="month">æœˆ</option></select></div>
                </div>
                <div class="col-6">
                    <div class="input-group input-group-sm"><span class="input-group-text">æˆ¿ç§Ÿ</span><input type="number" id="inc-rent" class="form-control save-input" placeholder="é‡‘é¡" oninput="calculate()"><select class="form-select unit-select save-input" id="unit-rent" onchange="calculate()"><option value="month">æœˆ</option><option value="year">å¹´</option></select></div>
                </div>
                <div class="col-12">
                    <div class="input-group input-group-sm"><span class="input-group-text">æµ·å¤–é…æ¯</span><input type="number" id="inc-ovs" class="form-control save-input" placeholder="é‡‘é¡" oninput="calculate()"><select class="form-select unit-select save-input" id="unit-ovs" onchange="calculate()"><option value="year">å¹´</option><option value="month">æœˆ</option></select></div>
                </div>
            </div>
        </div>
    </div>

    <div class="card">
        <div class="card-body">
            <div class="section-header header-debt">3. æ”¯å‡ºèˆ‡è² å‚µ (å–®ä½ï¼šè¬)</div>
            <div class="d-flex justify-content-between align-items-center mb-2">
                <span class="small fw-bold text-muted">æ‰€æœ‰é–‹éŠ· (ä¿éšª/ç”Ÿæ´»/è²¸æ¬¾)</span>
                <button class="btn btn-sm btn-outline-danger rounded-pill" onclick="addExpRow()">+ æ–°å¢</button>
            </div>
            <div id="exp-container"></div>
            <div class="alert alert-light small text-muted mt-2 mb-0 border-0" style="background:#fff5f5;">
                <i class="fas fa-exclamation-circle me-1 text-danger"></i> 
                é¸ã€Œæœˆ/å¹´ã€= ç¾é‡‘æµæ”¯å‡ºï¼›é¸ã€Œç¸½é¡ã€= ç´”è² å‚µ(ä¸è¨ˆæœˆæ”¯å‡º)ã€‚
            </div>
        </div>
    </div>

    <div class="card">
        <div class="card-body">
            <div class="section-header header-asset">4. ç¸½è³‡ç”¢ç›¤é» (å–®ä½ï¼šè¬)</div>
            <div class="d-flex justify-content-between align-items-center mb-2">
                <span class="small fw-bold text-muted">ç¾æœ‰è³‡ç”¢åˆ—è¡¨</span>
                <button class="btn btn-sm btn-outline-primary rounded-pill" onclick="addAssetRow()">+ æ–°å¢</button>
            </div>
            <div id="asset-container"></div>
            <div class="mt-3 p-2 bg-light rounded text-center small fw-bold">
                ç¸½è³‡ç”¢ï¼š<span id="display-total-asset" class="text-primary">0</span> è¬ | 
                ç¸½è² å‚µï¼š<span id="display-total-debt" class="text-danger">0</span> è¬ |
                æ·¨è³‡ç”¢ï¼š<span id="display-net-worth" class="text-success">0</span> è¬
            </div>
        </div>
    </div>

    <div id="quote-area" class="warm-quote"></div>
    <div class="text-center text-muted small pb-4 mt-2" style="opacity:0.5; font-size:0.7rem;">Designed for Daxin Partners â€¢ Gavin</div>

</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script>
    // åƒæ•¸ï¼šæˆ¿è²¸åˆ©ç‡2.2%, è»Šè²¸5%, ä¿¡è²¸6%
    const RATES = { house: 0.022, car: 0.05, loan: 0.06 }; 
    // å®‰éº—æˆé•·æ›²ç·š (å¹´æ”¶ è¬)
    // å‡è¨­æˆé•·è·¯å¾‘ï¼šç¬¬1å¹´ç™½é‡‘, ç¬¬2å¹´ç¿¡ç¿ , ç¬¬3å¹´é‘½çŸ³, ç¬¬5å¹´çš‡å† , ç¬¬10å¹´CA
    const AMWAY_PATH = [
        { year: 1, name: "ç™½é‡‘", income: 100, icon: "ğŸ¥ˆ" },
        { year: 2, name: "ç¿¡ç¿ ", income: 250, icon: "ğŸ’š" },
        { year: 3, name: "é‘½çŸ³", income: 500, icon: "ğŸ’" },
        { year: 5, name: "çš‡å† ", income: 1000, icon: "ğŸ‘‘" },
        { year: 10, name: "çš‡å† å¤§ä½¿", income: 3000, icon: "ğŸŒ" }
    ];
    const QUOTES = ["å¤¢æƒ³æ˜¯ç”¨ç¾é‡‘æµå †å‡ºä¾†çš„ï¼ğŸŒ±", "å …æŒæ˜¯é€šå¾€çš‡å† å”¯ä¸€çš„è·¯ï¼ğŸ’ª", "æ‰“é€ ç¾é‡‘æµï¼Œè®“æœªä¾†æ›´è‡ªç”±ï¼ğŸ’§"];

    document.addEventListener('DOMContentLoaded', () => {
        document.getElementById('quote-area').innerText = QUOTES[Math.floor(Math.random() * QUOTES.length)];
        // é è¨­æ¬„ä½
        addDreamRow(); 
        addExpRow('ç”Ÿæ´»é–‹éŠ·', 'month'); 
        addAssetRow('å­˜æ¬¾', 'dom');
        
        // è¬å–®ä½ç›£è½
        document.body.addEventListener('input', function(e) {
            if(e.target.classList.contains('wan-input')) {
                let v = parseFloat(e.target.value);
                let tag = e.target.nextElementSibling;
                if(tag && tag.classList.contains('wan-badge')) {
                    tag.innerText = (isNaN(v) ? 0 : v) + "è¬";
                }
            }
            if(e.target.tagName === 'INPUT' || e.target.tagName === 'SELECT') calculate();
        });
        calculate();
    });

    // æ ¸å¿ƒè¨ˆç®—
    function calculate() {
        try {
            // --- 1. æ”¶å…¥ (å¹´åŒ–) ---
            let active = getVal('inc-active') * (getUnit('unit-active')=='month'?12:1);
            let amway = getVal('inc-amway') * (getUnit('unit-amway')=='month'?12:1);
            let stock = getVal('inc-stock') * (getUnit('unit-stock')=='month'?12:1);
            let rent = getVal('inc-rent') * (getUnit('unit-rent')=='month'?12:1);
            let overseas = getVal('inc-ovs') * (getUnit('unit-ovs')=='month'?12:1);

            let domesticIncome = active + amway + stock + rent;
            let totalIncome = domesticIncome + overseas;

            // --- 2. æ”¯å‡ºèˆ‡è² å‚µ (åˆ†é¡) ---
            let annualExpense = 0; // ç¾é‡‘æµæ”¯å‡º (å¹´)
            let totalDebt = 0;     // ç¸½è² å‚µ (è³‡ç”¢è² å‚µè¡¨)

            document.querySelectorAll('.exp-row').forEach(row => {
                let amt = Number(row.querySelector('.exp-amt').value) || 0;
                let freq = row.querySelector('.exp-freq').value; 
                if (freq === 'month') annualExpense += amt * 12;
                else if (freq === 'year') annualExpense += amt;
                else if (freq === 'total') totalDebt += amt;
            });

            // --- 3. å¤¢æƒ³è™•ç† (æœˆç¾é‡‘æµè² æ“” vs å…¨æ¬¾ç›®æ¨™) ---
            let dreamLoanAnnual = 0;
            let dreamFullTarget = 0;
            
            document.querySelectorAll('.dream-row').forEach(row => {
                let cost = Number(row.querySelector('.dream-cost').value)||0;
                let type = row.querySelector('.dream-cat').value;
                let hint = row.querySelector('.dream-hint');
                
                let isLoan = (type === 'house' || type === 'car' || type === 'custom_loan');
                let years = (type==='house')?30 : (type==='car')?7 : 5;
                
                if(isLoan && cost > 0) {
                    let rate = (type === 'house') ? RATES.house : RATES.car;
                    // ç°¡æ˜“æœ¬æ¯æ”¤é‚„å¹´ä»˜ï¼š(æœ¬é‡‘/å¹´) + (æœ¬é‡‘*åˆ©ç‡)
                    let annualPay = (cost / years) + (cost * rate); 
                    dreamLoanAnnual += annualPay;
                    hint.innerText = `è½‰è²¸æ¬¾æœˆä»˜ç´„ ${(annualPay/12).toFixed(1)} è¬`;
                    hint.className = "hint-text hint-red";
                } else if (cost > 0) {
                    dreamFullTarget += cost;
                    hint.innerText = "éœ€å­˜å…¨æ¬¾";
                    hint.className = "hint-text hint-orange";
                } else { hint.innerText = ""; }
            });

            let finalAnnualExp = annualExpense + dreamLoanAnnual;
            let annualSurplus = totalIncome - finalAnnualExp; // å¹´æ·¨çµé¤˜

            // --- 4. è³‡ç”¢ç›¤é» ---
            let assetTotal = 0;
            document.querySelectorAll('.asset-val').forEach(i => assetTotal += Number(i.value)||0);
            let netWorth = assetTotal - totalDebt;

            // --- UI Update åŸºç¤æ•¸æ“š ---
            document.getElementById('sum-domestic').innerText = domesticIncome.toFixed(1) + " è¬";
            document.getElementById('sum-overseas').innerText = overseas.toFixed(1) + " è¬";
            document.getElementById('sum-expense').innerText = finalAnnualExp.toFixed(1) + " è¬";
            let surplusEl = document.getElementById('sum-surplus');
            surplusEl.innerText = annualSurplus.toFixed(1) + " è¬";
            surplusEl.className = annualSurplus >= 0 ? "result-val result-highlight" : "result-val result-danger";

            document.getElementById('display-total-asset').innerText = assetTotal.toLocaleString();
            document.getElementById('display-total-debt').innerText = totalDebt.toLocaleString();
            document.getElementById('display-net-worth').innerText = netWorth.toLocaleString();

            // --- 5. ç¼ºå£åˆ†æ (å¤¢æƒ³çš„æœˆæ”¯å‡º vs ç¾æœ‰ç¾é‡‘æµ) ---
            // å¤¢æƒ³å¸¶ä¾†çš„æœˆè² æ“”
            let dreamMonthlyLoad = dreamLoanAnnual / 12;
            // æ‰£é™¤å¤¢æƒ³å‰çš„æœˆç¾é‡‘æµ = (ç¸½æ”¶å…¥ - åŸºç¤æ”¯å‡º) / 12
            let baseMonthlySurplus = (totalIncome - annualExpense) / 12;
            
            // ç¼ºå£ = å¤¢æƒ³æœˆè² æ“” - åŸºç¤æœˆçµé¤˜
            let monthlyGap = dreamMonthlyLoad - baseMonthlySurplus;
            
            let gapBox = document.getElementById('gap-box');
            if (monthlyGap > 0) {
                gapBox.style.display = 'block';
                document.getElementById('gap-dream-cost').innerText = dreamMonthlyLoad.toFixed(1);
                document.getElementById('gap-current-flow').innerText = baseMonthlySurplus.toFixed(1);
                document.getElementById('gap-amount').innerText = monthlyGap.toFixed(1);
            } else {
                gapBox.style.display = 'none';
            }

            // --- 6. é”æˆå¹´é½¡ç²¾ç®— (Engine) ---
            let age = Number(document.getElementById('current-age').value) || 30;
            
            // A. æœ¬æ¥­æ¨¡å¼ (å¹´çµé¤˜å›ºå®š)
            // ç›®æ¨™ï¼šå…¨æ¬¾å¤¢æƒ³ç¸½é¡ - æ·¨è³‡ç”¢ (è‹¥è² å‚µå¤§æ–¼è³‡ç”¢ï¼Œéœ€å…ˆé‚„å‚µ)
            let targetAmount = Math.max(0, dreamFullTarget - netWorth);
            let yearsJob = 999;

            // å¦‚æœæœ‰ç¾é‡‘æµç¼ºå£(è²¸æ¬¾ä»˜ä¸å‡ºä¾†)ï¼Œæœ¬æ¥­é”æˆå°±æ˜¯ä¸å¯èƒ½(999)
            if (monthlyGap > 0) {
                yearsJob = 999;
                document.getElementById('age-job').innerText = "è² ç¾é‡‘æµ";
                document.getElementById('age-job-desc').innerText = "ç„¡æ³•è² æ“”å¤¢æƒ³";
            } else if (targetAmount > 0) {
                // æœ‰å…¨æ¬¾ç›®æ¨™ï¼Œçœ‹å­˜éŒ¢é€Ÿåº¦
                if (annualSurplus > 0) {
                    yearsJob = Math.ceil(targetAmount / annualSurplus);
                    document.getElementById('age-job').innerText = `${age + yearsJob} æ­²`;
                    document.getElementById('age-job-desc').innerText = `éœ€ ${yearsJob} å¹´`;
                } else {
                    document.getElementById('age-job').innerText = "é™é™ç„¡æœŸ";
                    document.getElementById('age-job-desc').innerText = "çµé¤˜ä¸è¶³";
                }
            } else {
                // æ²’å…¨æ¬¾ç›®æ¨™ï¼Œç¾é‡‘æµåˆå¤ ä»˜è²¸æ¬¾ -> ç«‹å³é”æˆ
                yearsJob = 0;
                document.getElementById('age-job').innerText = "ç«‹å³é”æˆ";
                document.getElementById('age-job-desc').innerText = "ç¾é‡‘æµè¶³å¤ ";
            }

            // B. å®‰éº—åŠ é€Ÿæ¨¡å¼ (æ”¶å…¥éš¨å¹´ä»½å¢åŠ )
            // é‚è¼¯ï¼šæ¨¡æ“¬æœªä¾†æ¯ä¸€å¹´çš„è²¡å‹™ç‹€æ³
            // ç¬¬nå¹´å®‰éº—æ”¶å…¥ = æŸ¥è¡¨ AMWAY_PATH
            let yearsAmway = 0;
            let currentAccumulated = netWorth; // ç´¯è¨ˆè³‡ç”¢
            let found = false;
            
            // åŸºç¤éå®‰éº—å¹´æ”¶å…¥
            let baseNonAmwayIncome = totalIncome - amway; 
            
            for (let y = 1; y <= 30; y++) { // æ¨¡æ“¬æœªä¾†30å¹´
                // 1. æŸ¥æ‰¾ç•¶å¹´å®‰éº—é ä¼°æ”¶å…¥ (ç·šæ€§æ’å€¼æˆ–éšæ¢¯)
                let amwayProjected = getAmwayIncomeByYear(y);
                
                // 2. ç•¶å¹´ç¸½æ”¶å…¥ = æœ¬æ¥­ + å®‰éº—é ä¼°
                let yearTotalInc = baseNonAmwayIncome + amwayProjected;
                
                // 3. ç•¶å¹´çµé¤˜ = ç¸½æ”¶å…¥ - ç¸½æ”¯å‡º
                let yearSurplus = yearTotalInc - finalAnnualExp;
                
                // 4. åˆ¤æ–·æ˜¯å¦é”æˆ
                // æ¢ä»¶ä¸€ï¼šç¾é‡‘æµå¿…é ˆè½‰æ­£ (å¤ ä»˜è²¸æ¬¾)
                if (yearSurplus >= 0) {
                    // æ¢ä»¶äºŒï¼šè‹¥æœ‰å…¨æ¬¾ç›®æ¨™ï¼Œç´¯è¨ˆè³‡ç”¢å¿…é ˆå¤ 
                    if (dreamFullTarget > 0) {
                        currentAccumulated += yearSurplus;
                        if (currentAccumulated >= dreamFullTarget) {
                            yearsAmway = y;
                            found = true;
                            break;
                        }
                    } else {
                        // æ²’å…¨æ¬¾ç›®æ¨™ï¼Œåªè¦ç¾é‡‘æµè½‰æ­£å°±ç®—é”æˆ
                        yearsAmway = y;
                        found = true;
                        break;
                    }
                }
            }

            if (found) {
                document.getElementById('age-amway').innerText = `${age + yearsAmway} æ­²`;
                // æ‰¾å‡ºå°æ‡‰è˜ä½
                let pin = getPinByYear(yearsAmway);
                document.getElementById('age-amway-desc').innerText = `ç´„ ${yearsAmway} å¹´ (${pin})`;
            } else {
                document.getElementById('age-amway').innerText = "> 30 å¹´";
                document.getElementById('age-amway-desc').innerText = "éœ€æ›´é•·è¦åŠƒ";
            }

            // --- 7. è˜ä½å»ºè­° ---
            // å»ºè­°é‚è¼¯ï¼šæ‰¾å‡ºèƒ½å¡«è£œã€Œæ¯æœˆç¼ºå£ã€çš„æœ€å°è˜ä½
            // å¹´ç¼ºå£ = æœˆç¼ºå£ * 12
            let annualGap = monthlyGap * 12;
            // è‹¥ç„¡ç¾é‡‘æµç¼ºå£ï¼Œä½†æƒ³åŠ é€Ÿå…¨æ¬¾ (ä¾‹å¦‚æƒ³5å¹´å…§è²·åˆ°)
            if (annualGap <= 0 && dreamFullTarget > 0) {
                // å‡è¨­æƒ³ 5 å¹´å­˜åˆ°
                let neededSurplus = (dreamFullTarget - netWorth) / 5;
                if (neededSurplus > annualSurplus) {
                    annualGap = neededSurplus - annualSurplus;
                }
            }

            let pinBox = document.getElementById('pin-box');
            if (annualGap > 0) {
                pinBox.style.display = 'flex';
                // æ‰¾é©åˆçš„è˜ä½
                let targetPin = AMWAY_PATH.find(p => p.income >= annualGap) || AMWAY_PATH[AMWAY_PATH.length-1];
                
                document.getElementById('pin-title').innerText = `å»ºè­°ç›®æ¨™ï¼š${targetPin.name}`;
                document.getElementById('pin-desc').innerText = `å¡«è£œ ${annualGap.toFixed(1)}è¬/å¹´ ç¼ºå£ï¼Œè®“å¤¢æƒ³å¯¦ç¾ï¼`;
                document.getElementById('pin-icon').innerText = targetPin.icon;
            } else {
                pinBox.style.display = 'none';
            }

        } catch (e) { console.log(e); }
    }

    // è¼”åŠ©ï¼šæ ¹æ“šå¹´åˆ†å–å¾—å®‰éº—é ä¼°æ”¶å…¥ (éšæ¢¯å¼)
    function getAmwayIncomeByYear(year) {
        // æ‰¾ <= year çš„æœ€å¤§å¹´ä»½è¨­å®š
        let setting = AMWAY_PATH.filter(p => p.year <= year).pop();
        return setting ? setting.income : 0;
    }
    
    function getPinByYear(year) {
        let setting = AMWAY_PATH.filter(p => p.year <= year).pop();
        return setting ? setting.name : "èµ·æ­¥";
    }

    function getVal(id) { let el = document.getElementById(id); return el ? (Number(el.value) || 0) : 0; }
    function getUnit(id) { let el = document.getElementById(id); return el ? el.value : 'month'; }

    function addDreamRow() {
        let div = document.createElement('div'); div.className = 'dynamic-row dream-row dream-item';
        div.innerHTML = `
            <button class="btn-remove" onclick="this.parentElement.remove();calculate()">&times;</button>
            <div class="row g-2 align-items-center">
                <div class="col-5">
                    <select class="form-select form-select-sm dream-cat save-input" onchange="calculate()">
                        <option value="house">ğŸ  è²·æˆ¿</option>
                        <option value="car">ğŸš— è²·è»Š</option>
                        <option value="travel">âœˆï¸ æ—…éŠ(å…¨æ¬¾)</option>
                        <option value="learn">ğŸ“š é€²ä¿®(å…¨æ¬¾)</option>
                        <option value="biz">ğŸ’¼ å‰µæ¥­(å…¨æ¬¾)</option>
                        <option value="custom_loan">ğŸ’³ å…¶ä»–(è²¸æ¬¾)</option>
                    </select>
                </div>
                <div class="col-7">
                    <div class="input-group input-group-sm">
                        <input type="number" class="form-control dream-cost save-input" placeholder="ç¸½åƒ¹(è¬)" oninput="calculate()">
                    </div>
                </div>
                <div class="col-12 dream-hint"></div>
            </div>`;
        document.getElementById('dream-container').appendChild(div);
    }

    function addExpRow(defaultName = '', defaultFreq = 'month') {
        let div = document.createElement('div'); div.className = 'dynamic-row exp-row exp-item';
        let types = ['ç”Ÿæ´»é–‹éŠ·','æˆ¿è²¸','è»Šè²¸','ä¿¡è²¸','ä¿éšª','æˆ¿ç§Ÿ','å…¶ä»–'];
        let options = types.map(t => `<option ${t===defaultName?'selected':''}>${t}</option>`).join('');
        
        div.innerHTML = `
            <button class="btn-remove" onclick="this.parentElement.remove();calculate()">&times;</button>
            <div class="row g-2 align-items-center">
                <div class="col-5">
                    <select class="form-select form-select-sm exp-type save-input">${options}</select>
                    <input type="text" class="form-control form-control-sm mt-1" placeholder="å‚™è¨»">
                </div>
                <div class="col-4">
                    <input type="number" class="form-control form-control-sm exp-amt save-input" placeholder="é‡‘é¡(è¬)" oninput="calculate()">
                </div>
                <div class="col-3">
                    <select class="form-select form-select-sm exp-freq save-input" onchange="calculate()">
                        <option value="month" ${defaultFreq==='month'?'selected':''}>æœˆç¹³</option>
                        <option value="year" ${defaultFreq==='year'?'selected':''}>å¹´ç¹³</option>
                        <option value="total" ${defaultFreq==='total'?'selected':''}>ç¸½é¡</option>
                    </select>
                </div>
            </div>`;
        document.getElementById('exp-container').appendChild(div);
    }

    function addAssetRow(name = '', type = 'dom') {
        let div = document.createElement('div'); div.className = 'dynamic-row asset-item-row';
        let options = type === 'dom' ? 
            `<option value="dom" selected>ğŸ‡¹ğŸ‡¼ åœ‹å…§</option><option value="ovs">ğŸŒ æµ·å¤–</option>` : 
            `<option value="dom">ğŸ‡¹ğŸ‡¼ åœ‹å…§</option><option value="ovs" selected>ğŸŒ æµ·å¤–</option>`;
            
        div.innerHTML = `
            <button class="btn-remove" onclick="this.parentElement.remove();calculate()">&times;</button>
            <div class="row g-2">
                <div class="col-4">
                    <select class="form-select form-select-sm asset-loc save-input" onchange="calculate()">${options}</select>
                </div>
                <div class="col-4"><input type="text" class="form-control form-control-sm" placeholder="é …ç›®" value="${name}"></div>
                <div class="col-4"><input type="number" class="form-control form-control-sm asset-val save-input" placeholder="é‡‘é¡(è¬)" oninput="calculate()"></div>
            </div>`;
        document.getElementById('asset-container').appendChild(div);
    }

    function saveData(alertUser=false) { if(alertUser) alert('âœ… ç´€éŒ„å·²ä¿å­˜'); }
    function copyReport() {
        let txt = `ã€å¤§å¿ƒè²¡å‹™è¨ºæ–·ã€‘\nğŸ¢ æœ¬æ¥­é”æˆï¼š${document.getElementById('age-job').innerText}\nğŸš€ åŠ å®‰éº—é”æˆï¼š${document.getElementById('age-amway').innerText} (${document.getElementById('age-amway-desc').innerText})\nğŸ’ å»ºè­°ï¼š${document.getElementById('pin-title').innerText}`;
        navigator.clipboard.writeText(txt).then(()=>alert('ğŸ“‹ è¤‡è£½æˆåŠŸ'));
    }
</script>
</body>
</html>
