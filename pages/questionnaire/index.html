<!doctype html>
<html lang="zh-TW">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>GavinTeam 問卷中控台</title>
<script src="https://cdn.tailwindcss.com"></script>
<style>
body{font-family:system-ui,"Microsoft JhengHei";}
.card{border:1px solid #e5e7eb;border-radius:20px;padding:20px;background:#fff;}
</style>
</head>
<body class="bg-slate-100 p-8">

<div class="max-w-4xl mx-auto space-y-6">

<h1 class="text-2xl font-bold">GavinTeam 問卷中控台</h1>

<div class="card">
<button onclick="addQuestion()" class="bg-blue-600 text-white px-4 py-2 rounded">
新增題目
</button>

<button onclick="saveRules()" class="bg-green-600 text-white px-4 py-2 rounded ml-2">
儲存到 Cloudflare
</button>

<button onclick="loadRules()" class="bg-gray-700 text-white px-4 py-2 rounded ml-2">
讀取目前規則
</button>
</div>

<div id="questions" class="space-y-6"></div>

</div>

<script>

const WORKER_BASE = "https://你的worker網址"; // 改成你的

let rules = [];

function addQuestion() {
  rules.push({
    id: "q" + Date.now(),
    title: "請輸入題目",
    options: [
      { text: "選項1", score: 0 },
      { text: "選項2", score: 1 },
      { text: "選項3", score: 2 },
      { text: "選項4", score: 3 }
    ]
  });
  render();
}

function render() {
  const container = document.getElementById("questions");
  container.innerHTML = "";

  rules.forEach((q, i) => {

    let html = `
    <div class="card">
      <div class="flex justify-between items-center">
        <h2 class="font-bold">第 ${i+1} 題</h2>
        <button onclick="deleteQuestion(${i})" class="text-red-600">刪除</button>
      </div>

      <input class="w-full border p-2 mt-2"
        value="${q.title}"
        onchange="updateTitle(${i}, this.value)"
      />

      <div class="mt-4 space-y-2">
    `;

    q.options.forEach((opt, j) => {
      html += `
      <div class="flex gap-2">
        <input class="flex-1 border p-2"
          value="${opt.text}"
          onchange="updateOption(${i},${j},this.value)"
        />
        <input type="number"
          class="w-20 border p-2"
          value="${opt.score}"
          onchange="updateScore(${i},${j},this.value)"
        />
      </div>
      `;
    });

    html += `</div></div>`;
    container.innerHTML += html;
  });
}

function updateTitle(i,val){ rules[i].title = val; }
function updateOption(i,j,val){ rules[i].options[j].text = val; }
function updateScore(i,j,val){ rules[i].options[j].score = parseInt(val); }
function deleteQuestion(i){ rules.splice(i,1); render(); }

async function saveRules() {
  await fetch(WORKER_BASE + "/api/save-rules", {
    method:"POST",
    headers:{ "Content-Type":"application/json" },
    body: JSON.stringify(rules)
  });
  alert("已儲存！");
}

async function loadRules() {
  const res = await fetch(WORKER_BASE + "/api/get-rules");
  rules = await res.json();
  render();
}

render();

</script>

</body>
</html>
