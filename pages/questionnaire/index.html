<!doctype html>
<html lang="zh-Hant">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>生活型態營養問卷</title>

<style>
body{
  margin:0;
  background:#f1f5f9;
  font-family:"Microsoft JhengHei",system-ui;
  display:flex;
  justify-content:center;
  padding:20px;
}
.card{
  width:520px;
  max-width:100%;
  background:#fff;
  border-radius:18px;
  box-shadow:0 10px 30px rgba(0,0,0,.08);
  overflow:hidden;
}
.hero{
  height:160px;
  background:linear-gradient(135deg,#eef2ff,#f8fafc);
  display:flex;
  align-items:center;
  justify-content:center;
  font-weight:900;
  font-size:28px;
  color:#1e3a8a;
}
.body{padding:20px}
.q{font-size:20px;font-weight:900;margin-bottom:10px}
.meta{color:#64748b;font-size:14px;margin-bottom:14px}
.btn{
  width:100%;
  padding:16px;
  border:none;
  border-top:1px solid #e5e7eb;
  font-size:18px;
  font-weight:800;
  background:#fff;
  color:#1d4ed8;
  cursor:pointer;
}
.result{white-space:pre-wrap;line-height:1.8;font-size:15px}
.link{
  display:block;
  margin-top:12px;
  padding:14px;
  text-align:center;
  background:#0f172a;
  color:#fff;
  border-radius:12px;
  text-decoration:none;
  font-weight:900;
}
</style>
</head>

<body>
<div class="card">
<div class="hero">營養問卷</div>
<div class="body" id="app"></div>
</div>

<script>
const START_KEYWORD="生活營養";

const LINKS={
 vitA:"https://填A",
 vitB:"https://填B",
 vitC:"https://填C",
 vitD:"https://填D",
 vitE:"https://填E",
 ca_mg:"https://填鈣",
 iron:"https://填鐵",
 fiber:"https://填纖維",
 trace:"https://填微量",
 protein:"https://填蛋白"
};

const Q=[
{id:"q1",type:"yn",t:"我經常只有兩餐"},
{id:"q2",type:"yn",t:"我每天攝取的蔬菜和水果少於5份"},
{id:"q3",type:"yn",t:"我每天攝取的米飯或麵條少於1.5碗"},
{id:"q4",type:"yn",t:"我每天喝的乳製品少於1.5杯"},
{id:"q5",type:"yn",t:"我每天飲用咖啡或茶（至少兩杯）"},
{id:"q6",type:"yn",t:"我每天攝取的蛋白質少於5份"},
{id:"q7",type:"yn",t:"我經常食用高溫油炸食物"},
{id:"q8",type:"yn",t:"我有吸菸習慣"},
{id:"q9",type:"yn",t:"我常節食減肥"},
{id:"q10",type:"sex",t:"性別"},
{id:"q11",type:"age",t:"年齡"}
];

const score={vitA:0,vitB:0,vitC:0,vitD:0,vitE:0,ca_mg:0,iron:0,fiber:0,trace:0,protein:0};
const ans={};

function add(o){for(let k in o){score[k]+=o[k];}}

function buildRules(){
return{
yn:{
q1:{vitB:1,protein:1,trace:1},
q2:{vitA:1,vitC:2,fiber:2,trace:1},
q3:{vitB:2},
q4:{ca_mg:3,vitD:2},
q5:{ca_mg:1,vitB:1},
q6:{protein:3,iron:1,vitB:1},
q7:{vitC:1,vitE:2},
q8:{vitC:3,vitE:1},
q9:{protein:2,iron:2,vitB:2,trace:1}
},
sex:{男:{},女:{iron:1}},
age:{
"18以下":{protein:1},
"19-39":{vitB:1},
"40以上":{ca_mg:2,vitD:2}
},
sy:[
{if:["q4","q5"],add:{ca_mg:2}},
{if:["q6","q9"],add:{protein:2}},
{if:["q2","q7"],add:{vitC:1,vitE:1}},
{if:["q2","q8"],add:{vitC:1}},
{if:["q1","q9"],add:{vitB:1}}
]
}}
const rules=buildRules();

let i=0;
const app=document.getElementById("app");

function ask(){
const q=Q[i];
let btn="";
if(q.type==="yn"){
btn=`<button class=btn data=v>是</button>
<button class=btn data=n>不是</button>`;
}
if(q.type==="sex"){
btn=`<button class=btn data=v>男</button>
<button class=btn data=v>女</button>`;
}
if(q.type==="age"){
btn=`<button class=btn data=v>18以下</button>
<button class=btn data=v>19-39</button>
<button class=btn data=v>40以上</button>`;
}
app.innerHTML=`<div class=q>${q.t}</div><div class=meta>${i+1}/11</div>${btn}`;

document.querySelectorAll(".btn").forEach(b=>{
b.onclick=()=>{
let v=b.textContent;
ans[q.id]=v;

if(q.type==="yn"&&v==="是") add(rules.yn[q.id]);
if(q.type==="sex") add(rules.sex[v]||{});
if(q.type==="age") add(rules.age[v]||{});

i++;
if(i>=Q.length) calc();
else ask();
};
});
}

function calc(){
rules.sy.forEach(r=>{
if(r.if.every(id=>ans[id]==="是")) add(r.add);
});

let arr=Object.entries(score).sort((a,b)=>b[1]-a[1]);
let need=arr.filter(v=>v[1]>=4);

if(!need.length){
app.innerHTML=`<div class=result>
結果分析

目前整體飲食狀態穩定
沒有明顯需要優先補充的營養方向

建議維持目前飲食習慣即可
</div>`;
return;
}

let text="結果分析\n\n建議優先補充：\n";
need.forEach(v=> text+="• "+v[0]+"\n");

let links="";
need.forEach(v=>{
if(LINKS[v[0]])
links+=`<a class=link href="${LINKS[v[0]]}" target=_blank>查看 ${v[0]} 建議</a>`;
});

app.innerHTML=`<div class=result>${text}</div>${links}`;
}

const p=new URLSearchParams(location.search);
if(p.get("k")===START_KEYWORD) ask();
else app.innerHTML="請從LINE輸入「生活營養」啟動";
</script>
</body>
</html>
