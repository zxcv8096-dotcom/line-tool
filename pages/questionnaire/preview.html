<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>問卷預覽</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-slate-100 min-h-screen flex items-center justify-center">
  <div class="bg-white w-full max-w-xl rounded-xl shadow p-6 space-y-4">

    <h1 id="title" class="text-xl font-extrabold text-center"></h1>

    <div id="question" class="text-lg font-bold text-slate-800"></div>

    <div id="options" class="space-y-3"></div>

    <div id="done" class="hidden text-center text-emerald-700 font-bold">
      問卷完成 ✅
    </div>
  </div>

<script>
const $ = id => document.getElementById(id);
const API = localStorage.getItem("survey_api");
const params = new URLSearchParams(location.search);
const key = params.get("key");

let survey = null;
let current = null;

async function loadSurvey() {
  const res = await fetch(API + "/loadAny", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({
      namespace: "DB",
      keyword: "AI_SURVEY:Q:" + key
    })
  });
  const j = await res.json();
  survey = j.payload;
  $("title").textContent = survey.title;
  go(survey.start);
}

function go(nodeId) {
  const node = survey.nodes[nodeId];
  if (!node) return finish();

  current = nodeId;
  $("question").textContent = node.q;
  $("options").innerHTML = "";

  node.options.forEach(o => {
    const btn = document.createElement("button");
    btn.className =
      "w-full px-4 py-3 rounded-lg border text-left hover:bg-slate-50";
    btn.textContent = o.t;
    btn.onclick = () => {
      if (o.next) go(o.next);
      else finish();
    };
    $("options").appendChild(btn);
  });
}

function finish() {
  $("question").textContent = "";
  $("options").innerHTML = "";
  $("done").classList.remove("hidden");
}

loadSurvey();
</script>
  <script src="/assets/js/api.js"></script>
</body>
</html>
