<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>LINE OA è‡ªè£½åŠŸèƒ½å¯¦é©—å®¤ï¼ˆç¸½è¦½ï¼‹æ§ç®¡ï¼‰</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body { font-family: "Microsoft JhengHei", sans-serif; background: #f0f2f5; }
    .card { background: white; border-radius: 18px; box-shadow: 0 10px 30px rgba(0,0,0,.08); }
    .toolCard{
      text-align:left; background:#f8fafc; border:1px solid #e2e8f0;
      border-radius:16px; padding:14px; transition:.15s;
    }
    .toolCard:hover{ transform: translateY(-2px); box-shadow: 0 10px 30px rgba(0,0,0,.08); }
    .badge { font-size: 11px; padding: 3px 10px; border-radius: 999px; border: 1px solid; font-weight: 900; }
    .badge-db { background:#eff6ff; color:#1d4ed8; border-color:#dbeafe; }
    .badge-replies { background:#fffbeb; color:#b45309; border-color:#fef3c7; }
    .badge-active { background:#ecfdf5; color:#047857; border-color:#a7f3d0; }
    .badge-testing { background:#fff7ed; color:#c2410c; border-color:#fed7aa; }
    .badge-deprecated { background:#f1f5f9; color:#475569; border-color:#e2e8f0; text-decoration: line-through; }
    .badge-unknown { background:#fafafa; color:#525252; border-color:#e5e5e5; }
    .btn { font-weight: 900; border-radius: 14px; padding: 10px 14px; }
    .btnDark { background:#0f172a; color:#fff; }
    .btnDark:hover { background:#000; }
    .btnGreen { background:#059669; color:#fff; }
    .btnGreen:hover { background:#047857; }
    .btnRed { background:#e11d48; color:#fff; }
    .btnRed:hover { background:#be123c; }
    .btnGhost { background:#fff; border:1px solid #e2e8f0; }
    .btnGhost:hover { background:#f1f5f9; }
    .mono { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; }
    .small { font-size: 12px; }
  </style>
</head>

<body class="min-h-screen p-4 text-slate-800">
  <div class="max-w-5xl mx-auto space-y-4">

    <!-- Header -->
    <div class="card p-6">
      <div class="flex items-start justify-between gap-4">
        <div>
          <div class="text-5xl">ğŸ§ª</div>
          <h1 class="text-2xl font-extrabold mt-2">LINE OA è‡ªè£½åŠŸèƒ½å¯¦é©—å®¤ï¼ˆç¸½è¦½ï¼‹æ§ç®¡ï¼‰</h1>
          <p class="text-sm text-slate-500 mt-1">
            å¯ä¾ã€ŒåŠŸèƒ½ / ç‹€æ…‹ã€ç¯©é¸ä½ åšéçš„æ‰€æœ‰è³‡æ–™ï¼›æ”¯æ´é è¦½ã€åˆªé™¤ã€å¿«é€Ÿè·³å›å·¥å…·é ã€‚
          </p>
        </div>
        <div class="text-right">
          <a href="index.html" class="btn btnDark inline-block">å›é¦–é </a>
        </div>
      </div>

      <!-- Worker URL -->
      <div class="mt-4 bg-slate-100 rounded-xl p-4">
        <label class="block text-xs font-bold text-slate-600 mb-1">Worker ç¶²å€ï¼ˆå¿…å¡«ï¼‰</label>
        <div class="flex flex-col sm:flex-row gap-2">
          <input id="workerUrl" placeholder="https://api.xxx.workers.dev"
                 class="flex-1 border rounded-xl p-2 text-sm bg-white"
                 oninput="saveWorkerUrl(this.value)">
          <button class="btn btnGreen" onclick="reloadAll()">è¼‰å…¥æ‰€æœ‰è³‡æ–™</button>
          <button class="btn btnGhost" onclick="ping()">æ¸¬è©¦é€£ç·š</button>
        </div>
        <div class="mt-2 text-[12px] text-slate-600">
          å»ºè­° Worker æ”¯æ´ï¼š<span class="mono">/listMeta /loadAny /deleteAny</span>ï¼ˆé€™é æ‰èƒ½å®Œæ•´åˆ†é¡ï¼†æ§ç®¡ï¼‰ã€‚
        </div>
      </div>

      <div id="status" class="mt-3 text-sm text-slate-600"></div>
    </div>

    <!-- Tools -->
    <div class="card p-6">
      <h2 class="font-extrabold text-lg mb-3">å›ºå®šå·¥å…·å…¥å£</h2>
      <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3">

        <button class="toolCard" onclick="go('liff_popup_imagemap.html')">
          <div class="text-3xl">ğŸ“±</div>
          <div class="font-bold mt-1">æ‰‹æ©Ÿé è¦½å¼•æµåœ–ï¼ˆLIFF å½ˆçª—ï¼‰</div>
          <div class="text-xs text-slate-500">æŠ½å±œé è¦½ / ç•«æ¡†ä¸é™ / ä¸Šå‚³åˆ° R2</div>
        </button>

        <button class="toolCard" onclick="go('tool_imagemap.html')">
          <div class="text-3xl">ğŸ—ºï¸</div>
          <div class="font-bold mt-1">å¼•æµåœ–å·¥å…·</div>
          <div class="text-xs text-slate-500">å¤§åœ–é»æ“Šã€å¤šåœ–å›è¦†</div>
        </button>

        <button class="toolCard" onclick="go('tool_carousel.html')">
          <div class="text-3xl">ğŸ </div>
          <div class="font-bold mt-1">æ»‘å‹•å¡ç‰‡</div>
          <div class="text-xs text-slate-500">å¤šåœ–è¼ªæ’­</div>
        </button>

        <button class="toolCard" onclick="go('tool_flow.html')">
          <div class="text-3xl">ğŸ”€</div>
          <div class="font-bold mt-1">è¦‹è­‰æµç¨‹</div>
          <div class="text-xs text-slate-500">é€£çºŒè·³è½‰</div>
        </button>

        <button class="toolCard ring-2 ring-rose-200" onclick="go('tool_quickreply.html')">
          <div class="text-3xl">ğŸ”´</div>
          <div class="font-bold mt-1">ç´…è‰²æ¡†æ¡† Quick Reply</div>
          <div class="text-xs text-slate-500">æ–‡å­— + åº•éƒ¨æµ®å‹•æŒ‰éˆ•</div>
        </button>

      </div>

      <div class="text-[12px] text-slate-500 mt-3">
        å·¥å…·é æ˜¯ GitHub Pagesï¼›è³‡æ–™éƒ½åœ¨ Worker KV â†’ åŒä¸€å€‹ Worker URL å°±èƒ½è·¨è¨­å‚™åŒæ­¥ã€‚
      </div>
    </div>

    <!-- Explorer -->
    <div class="card p-6 space-y-3">
      <div class="flex flex-col sm:flex-row sm:items-center justify-between gap-3">
        <div>
          <h2 class="font-extrabold text-lg">è³‡æ–™ç¸½è¦½ï¼ˆå¯ç¯©é¸ï¼‰</h2>
          <div class="text-xs text-slate-500">
            å»ºè­°ç”¨ã€ŒåŠŸèƒ½ã€å…ˆç¸®å°ï¼Œå†ç”¨ã€Œç‹€æ…‹ã€/ã€Œé—œéµå­—ã€æŸ¥ã€‚
          </div>
        </div>
        <div class="flex gap-2 flex-wrap">
          <button class="btn btnGhost" onclick="resetFilters()">é‡ç½®ç¯©é¸</button>
          <button class="btn btnGhost" onclick="reloadAll()">é‡æ–°æ•´ç†</button>
        </div>
      </div>

      <!-- Filters -->
      <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-5 gap-2">
        <input id="search" placeholder="æœå°‹ keywordï¼ˆä¾‹å¦‚ï¼šé¸å–® / ç”¢å“ / å¡ç‰‡ï¼‰"
               class="border rounded-xl p-2 text-sm"
               oninput="renderList()">

        <select id="nsFilter" class="border rounded-xl p-2 text-sm" onchange="renderList()">
          <option value="ALL">å…¨éƒ¨ namespace</option>
          <option value="DB">DBï¼ˆBOT_DATAï¼‰</option>
          <option value="REPLIES">REPLIESï¼ˆrepliesï¼‰</option>
        </select>

        <select id="featureFilter" class="border rounded-xl p-2 text-sm" onchange="renderList()">
          <option value="ALL">å…¨éƒ¨åŠŸèƒ½</option>
          <option value="quickreply">ğŸ”´ quickreply</option>
          <option value="imagemap">ğŸ—ºï¸ imagemap</option>
          <option value="carousel">ğŸ  carousel</option>
          <option value="flow">ğŸ”€ flow</option>
          <option value="liff_preview">ğŸ“± liff_preview</option>
          <option value="other">ğŸ§© other</option>
          <option value="unknown">â“ unknown</option>
        </select>

        <select id="statusFilter" class="border rounded-xl p-2 text-sm" onchange="renderList()">
          <option value="ALL">å…¨éƒ¨ç‹€æ…‹</option>
          <option value="active">âœ… active</option>
          <option value="testing">ğŸ§ª testing</option>
          <option value="deprecated">ğŸ—‘ï¸ deprecated</option>
          <option value="unknown">â“ unknown</option>
        </select>

        <label class="flex items-center gap-2 bg-slate-50 border rounded-xl p-2 text-sm">
          <input id="hideDeprecated" type="checkbox" class="scale-110" onchange="renderList()">
          <span class="font-bold text-slate-600">éš±è— deprecated</span>
        </label>
      </div>

      <div id="stats" class="text-[12px] text-slate-500"></div>
      <div id="list" class="space-y-2"></div>

      <div class="text-[12px] text-slate-500">
        è‹¥ä½ å¸Œæœ›ã€Œæ›´ç²¾æº–çš„åŠŸèƒ½åˆ†é¡ã€ï¼šè«‹è®“ä½ çš„å·¥å…·åœ¨å„²å­˜æ™‚å¯«å…¥
        <span class="mono">payload.meta.feature / payload.meta.status</span>ï¼Œ
        æˆ–ç”± Worker åœ¨ /save æ™‚è‡ªå‹•è£œ metaï¼ˆä½ ä¹‹å‰è¦çš„åšæ³•ï¼‰ã€‚
      </div>
    </div>

    <div class="text-center text-[12px] text-slate-400">
      Powered by GitHub Pages + Cloudflare Workers (KV/R2)
    </div>
  </div>

  <!-- Modal -->
  <div id="modal" class="fixed inset-0 bg-black/50 hidden items-center justify-center p-4">
    <div class="bg-white w-full max-w-3xl rounded-2xl shadow-xl overflow-hidden">
      <div class="bg-slate-900 text-white p-4 flex items-center justify-between">
        <div class="font-bold" id="modalTitle">å…§å®¹é è¦½</div>
        <button class="opacity-80 hover:opacity-100" onclick="closeModal()">âœ•</button>
      </div>
      <div class="p-4 space-y-3">
        <div class="flex flex-wrap gap-2 items-center">
          <span id="modalNs" class="badge badge-db">DB</span>
          <span id="modalFeature" class="badge badge-unknown">feature: unknown</span>
          <span id="modalStatus" class="badge badge-unknown">status: unknown</span>
          <span id="modalUpdated" class="text-[12px] text-slate-500"></span>
        </div>
        <pre id="modalBody" class="text-xs bg-slate-50 border rounded-xl p-3 overflow-auto max-h-[60vh] mono"></pre>
      </div>
    </div>
  </div>

<script>
  const WORKER_KEY = 'line_worker_url';
  let ITEMS = []; // {namespace,key,feature,status,updatedAt,note}

  window.onload = () => {
    const saved = localStorage.getItem(WORKER_KEY);
    if (saved) document.getElementById('workerUrl').value = saved;
    setStatus('è«‹å…ˆè¼¸å…¥ Worker URLï¼ŒæŒ‰ã€Œè¼‰å…¥æ‰€æœ‰è³‡æ–™ã€ã€‚', 'info');
  };

  function setStatus(msg, type='info') {
    const el = document.getElementById('status');
    const cls = type==='ok' ? 'text-emerald-700' : type==='err' ? 'text-rose-700' : 'text-slate-600';
    el.className = `mt-3 text-sm ${cls}`;
    el.textContent = msg;
  }

  function saveWorkerUrl(v){ localStorage.setItem(WORKER_KEY, (v||'').trim()); }

  function getWorker(){
    let w = (document.getElementById('workerUrl').value || '').trim();
    w = w.replace(/\/+$/, '');
    if(!w){
      alert('è«‹å…ˆè¼¸å…¥ Worker ç¶²å€');
      document.getElementById('workerUrl').focus();
      return null;
    }
    saveWorkerUrl(w);
    return w;
  }

  function go(page){
    const w = getWorker();
    if(!w) return;
    window.location.href = page;
  }

  async function postJSON(fullUrl, data){
    const res = await fetch(fullUrl, {
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body: JSON.stringify(data || {})
    });
    const out = await res.json().catch(()=>null);
    return {res, out};
  }

  async function ping(){
    const w = getWorker();
    if(!w) return;
    try{
      const res = await fetch(w + '/health', { method:'GET' });
      if(res.ok){
        setStatus('é€£ç·šæˆåŠŸï¼š/health OK', 'ok');
      } else {
        setStatus('é€£ç·šå¤±æ•—ï¼š/health ä¸æ˜¯ 200ï¼ˆè«‹ç¢ºèª Workerï¼‰', 'err');
      }
    }catch(e){
      setStatus('é€£ç·šå¤±æ•—ï¼š' + (e.message || e), 'err');
    }
  }

  function resetFilters(){
    document.getElementById('search').value = '';
    document.getElementById('nsFilter').value = 'ALL';
    document.getElementById('featureFilter').value = 'ALL';
    document.getElementById('statusFilter').value = 'ALL';
    document.getElementById('hideDeprecated').checked = false;
    renderList();
  }

  async function reloadAll(){
    const w = getWorker();
    if(!w) return;

    setStatus('è¼‰å…¥ä¸­â€¦', 'info');
    ITEMS = [];
    document.getElementById('list').innerHTML = '<div class="text-slate-400 text-sm">è¼‰å…¥ä¸­...</div>';

    // 1) å„ªå…ˆç”¨ /listMetaï¼ˆå¯ç›´æ¥åˆ†é¡ï¼‰
    try{
      const r = await postJSON(w + '/listMeta', {});
      if(r.res.ok && r.out && r.out.ok && Array.isArray(r.out.items)){
        ITEMS = r.out.items.map(x => ({
          namespace: String(x.namespace || 'DB').toUpperCase(),
          key: String(x.key || ''),
          feature: String(x.feature || 'unknown'),
          status: String(x.status || 'unknown'),
          updatedAt: Number(x.updatedAt || 0) || 0,
          note: String(x.note || '')
        })).filter(x => x.key);

        setStatus(`è¼‰å…¥æˆåŠŸï¼šå…± ${ITEMS.length} ç­†ï¼ˆ/listMetaï¼‰`, 'ok');
        renderList();
        return;
      }
    }catch(e){
      // continue fallback
    }

    // 2) fallbackï¼š/listAllï¼ˆåªèƒ½æ‹¿ keyï¼ŒåŠŸèƒ½æœªçŸ¥ï¼‰
    try{
      const r = await postJSON(w + '/listAll', {});
      if(r.res.ok && r.out && r.out.ok){
        const db = Array.isArray(r.out.db) ? r.out.db : [];
        const rep = Array.isArray(r.out.replies) ? r.out.replies : [];
        ITEMS = [
          ...db.map(k => ({namespace:'DB', key:String(k), feature:'unknown', status:'unknown', updatedAt:0, note:''})),
          ...rep.map(k => ({namespace:'REPLIES', key:String(k), feature:'unknown', status:'unknown', updatedAt:0, note:''}))
        ].filter(x => x.key);

        setStatus(`è¼‰å…¥æˆåŠŸï¼šå…± ${ITEMS.length} ç­†ï¼ˆ/listAll fallbackï¼›åŠŸèƒ½=unknownï¼‰`, 'ok');
        renderList();
        return;
      }
    }catch(e){
      // continue fallback
    }

    // 3) fallbackï¼šèˆŠç‰ˆåªæœ‰ /listï¼ˆDBï¼‰
    try{
      const r = await postJSON(w + '/list', {});
      const keywords = (r.out && r.out.keywords) ? r.out.keywords : [];
      ITEMS = keywords.map(k => ({namespace:'DB', key:String(k), feature:'unknown', status:'unknown', updatedAt:0, note:''}));

      setStatus(`è¼‰å…¥æˆåŠŸï¼šDB ${ITEMS.length} ç­†ï¼ˆèˆŠç‰ˆ /listï¼›åŠŸèƒ½=unknownï¼‰`, 'ok');
      renderList();
      return;
    }catch(e){
      setStatus('è¼‰å…¥å¤±æ•—ï¼šè«‹ç¢ºèª Worker URLã€ä»¥åŠ Worker æœ‰é–‹ CORSã€‚', 'err');
      document.getElementById('list').innerHTML =
        '<div class="text-rose-600 text-sm">è¼‰å…¥å¤±æ•—ï¼š' + escapeHtml(e.message || e) + '</div>';
    }
  }

  function renderList(){
    const q = (document.getElementById('search').value || '').trim().toLowerCase();
    const ns = document.getElementById('nsFilter').value;
    const feat = document.getElementById('featureFilter').value;
    const st = document.getElementById('statusFilter').value;
    const hideDep = document.getElementById('hideDeprecated').checked;

    let rows = ITEMS.slice();

    if(ns !== 'ALL') rows = rows.filter(x => x.namespace === ns);
    if(feat !== 'ALL') rows = rows.filter(x => x.feature === feat);
    if(st !== 'ALL') rows = rows.filter(x => x.status === st);
    if(hideDep) rows = rows.filter(x => x.status !== 'deprecated');
    if(q) rows = rows.filter(x =>
      x.key.toLowerCase().includes(q) ||
      (x.note || '').toLowerCase().includes(q) ||
      (x.feature || '').toLowerCase().includes(q)
    );

    const total = ITEMS.length;
    document.getElementById('stats').textContent = `å…± ${total} ç­†ï¼ˆç›®å‰é¡¯ç¤º ${rows.length} ç­†ï¼‰`;

    const list = document.getElementById('list');
    list.innerHTML = '';

    if(!rows.length){
      list.innerHTML = '<div class="text-slate-400 text-sm">æ²’æœ‰è³‡æ–™</div>';
      return;
    }

    // æ’åºï¼šactive > testing > unknown > deprecatedï¼Œæ¥è‘— featureï¼Œå† key
    const rank = { active:0, testing:1, unknown:2, deprecated:3 };
    rows.sort((a,b)=>{
      const ra = rank[a.status] ?? 9;
      const rb = rank[b.status] ?? 9;
      if(ra !== rb) return ra - rb;
      const fa = (a.feature||'unknown');
      const fb = (b.feature||'unknown');
      if(fa !== fb) return fa.localeCompare(fb, 'zh-Hant');
      return (a.key||'').localeCompare((b.key||''), 'zh-Hant');
    });

    rows.forEach(x=>{
      const nsBadge = x.namespace === 'DB'
        ? `<span class="badge badge-db">DB</span>`
        : `<span class="badge badge-replies">REPLIES</span>`;

      const stBadge = statusBadge(x.status);
      const featBadge = `<span class="badge badge-unknown">feature: ${escapeHtml(x.feature || 'unknown')}</span>`;

      const updated = x.updatedAt ? `æ›´æ–°ï¼š${fmtTime(x.updatedAt)}` : '';

      list.innerHTML += `
        <div class="flex flex-col gap-2 border rounded-2xl p-3 bg-slate-50">
          <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2">
            <div class="min-w-0">
              <div class="flex flex-wrap items-center gap-2">
                ${nsBadge}
                ${stBadge}
                ${featBadge}
                <div class="font-black truncate">${escapeHtml(x.key)}</div>
              </div>
              <div class="text-[12px] text-slate-500 mt-1">
                ${escapeHtml(x.note || '')}
                ${updated ? ` <span class="ml-2">${updated}</span>` : ''}
              </div>
            </div>
            <div class="flex flex-wrap gap-2">
              <button class="btn btnGhost small" onclick="previewKey('${x.namespace}','${escapeJs(x.key)}')">é è¦½</button>
              <button class="btn btnRed small" onclick="deleteKey('${x.namespace}','${escapeJs(x.key)}')">åˆªé™¤</button>
            </div>
          </div>
        </div>
      `;
    });
  }

  function statusBadge(status){
    const s = (status || 'unknown');
    if(s === 'active') return `<span class="badge badge-active">âœ… active</span>`;
    if(s === 'testing') return `<span class="badge badge-testing">ğŸ§ª testing</span>`;
    if(s === 'deprecated') return `<span class="badge badge-deprecated">ğŸ—‘ï¸ deprecated</span>`;
    return `<span class="badge badge-unknown">â“ unknown</span>`;
  }

  function fmtTime(ts){
    try{
      const d = new Date(ts);
      const y = d.getFullYear();
      const m = String(d.getMonth()+1).padStart(2,'0');
      const da = String(d.getDate()).padStart(2,'0');
      const hh = String(d.getHours()).padStart(2,'0');
      const mm = String(d.getMinutes()).padStart(2,'0');
      return `${y}-${m}-${da} ${hh}:${mm}`;
    }catch{
      return '';
    }
  }

  async function previewKey(ns, key){
    const w = getWorker();
    if(!w) return;

    // å…ˆå¾ ITEMS æ‰¾ meta é¡¯ç¤º
    const row = ITEMS.find(x => x.namespace === ns && x.key === key);
    const feature = row?.feature || 'unknown';
    const status = row?.status || 'unknown';
    const updatedAt = row?.updatedAt || 0;

    // å„ªå…ˆï¼š/loadAny
    try{
      const r = await postJSON(w + '/loadAny', { namespace: ns, keyword: key });
      if(r.res.ok && r.out && r.out.ok){
        const payload = r.out.payload;
        const text = typeof payload === 'string' ? payload : JSON.stringify(payload, null, 2);
        showModal(ns, feature, status, key, updatedAt, text);
        return;
      } else {
        const err = r.out && r.out.error ? r.out.error : 'è®€å–å¤±æ•—';
        alert(err);
        return;
      }
    }catch(e){
      // fallback
    }

    // fallbackï¼šèˆŠ /loadï¼ˆåªæ”¯æ´ DBï¼‰
    if(ns !== 'DB'){
      alert('ä½ çš„ Worker å°šæœªæ”¯æ´ /loadAnyï¼ˆREPLIES ç„¡æ³•è®€å–ï¼‰ã€‚è«‹æ›´æ–° Workerã€‚');
      return;
    }
    try{
      const r = await postJSON(w + '/load', { keyword: key });
      if(r.res.ok && r.out){
        showModal(ns, feature, status, key, updatedAt, JSON.stringify(r.out, null, 2));
        return;
      }
    }catch(e){}

    alert('è®€å–å¤±æ•—ï¼šè«‹æ›´æ–° Worker æ”¯æ´ /loadAny');
  }

  async function deleteKey(ns, key){
    const w = getWorker();
    if(!w) return;

    if(!confirm(`ç¢ºå®šåˆªé™¤ï¼Ÿ\n${ns} / ${key}\nåˆªäº†å°±ä¸èƒ½å¾©åŸ`)) return;

    try{
      const r = await postJSON(w + '/deleteAny', { namespace: ns, keyword: key });
      if(r.res.ok && r.out && r.out.ok){
        ITEMS = ITEMS.filter(x => !(x.namespace===ns && x.key===key));
        renderList();
        alert('å·²åˆªé™¤');
        return;
      } else {
        const err = r.out && r.out.error ? r.out.error : 'åˆªé™¤å¤±æ•—';
        alert(err);
        return;
      }
    }catch(e){
      alert('åˆªé™¤å¤±æ•—ï¼šä½ çš„ Worker å¯èƒ½é‚„æ²’æ”¯æ´ /deleteAny');
    }
  }

  function showModal(ns, feature, status, key, updatedAt, body){
    document.getElementById('modalTitle').textContent = key;

    const nsEl = document.getElementById('modalNs');
    if(ns === 'DB'){
      nsEl.textContent = 'DB';
      nsEl.className = 'badge badge-db';
    }else{
      nsEl.textContent = 'REPLIES';
      nsEl.className = 'badge badge-replies';
    }

    const featEl = document.getElementById('modalFeature');
    featEl.textContent = `feature: ${feature || 'unknown'}`;
    featEl.className = 'badge badge-unknown';

    const stEl = document.getElementById('modalStatus');
    stEl.className = 'badge ' + (
      status === 'active' ? 'badge-active' :
      status === 'testing' ? 'badge-testing' :
      status === 'deprecated' ? 'badge-deprecated' :
      'badge-unknown'
    );
    stEl.textContent = `status: ${status || 'unknown'}`;

    document.getElementById('modalUpdated').textContent = updatedAt ? `æ›´æ–°ï¼š${fmtTime(updatedAt)}` : '';

    document.getElementById('modalBody').textContent = body;

    const m = document.getElementById('modal');
    m.classList.remove('hidden');
    m.classList.add('flex');
  }

  function closeModal(){
    const m = document.getElementById('modal');
    m.classList.add('hidden');
    m.classList.remove('flex');
  }

  function escapeHtml(s){
    return String(s).replace(/[&<>"']/g, m => ({
      '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'
    }[m]));
  }
  function escapeJs(s){
    return String(s).replace(/\\/g,'\\\\').replace(/'/g,"\\'");
  }
</script>
</body>
</html>
